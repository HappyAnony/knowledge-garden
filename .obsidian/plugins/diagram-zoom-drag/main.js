/* Autogenerated by esbuild. Source code available in the pluginâ€™s repository: https://github.com/Ssentiago/image-zoom-drag */
"use strict";var R=require("obsidian");let Vs=class extends R.Component{observer=null;subscribers=new Map;constructor(){super(),this.load(),this.enable()}enable(){this.observer=new MutationObserver(async e=>{for(const n of e)await this.processMutation(n)}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0})}async processMutation(e){for(const[n,i]of this.subscribers)n(e)&&await i(e)}onunload(){super.onunload(),this.observer?.disconnect(),this.subscribers.clear()}subscribe(e,n){this.subscribers.set(e,n)}unsubscribe(e){this.subscribers.delete(e)}};function hi(t){return t.closest(".workspace-leaf-content")?.dataset.type==="markdown"}function Ut(t){if(!(t instanceof SVGElement))return!1;const e=t;if(e.closest("button")||e.closest(".edit-block-button")||e.classList.contains("svg-icon"))return!0;const n=e.getBoundingClientRect();if(n.width>0&&n.width<=32&&n.height>0&&n.height<=32)return!0;const i=e.parentElement;if(i){const o=i.getBoundingClientRect();if(o.width>0&&o.width<=32&&o.height>0&&o.height<=32)return!0}return!1}let Gs=class{constructor(e){this.leafIndex=e}enable(){this.leafIndex.plugin.registerMarkdownPostProcessor((e,n)=>{this.processPreviewImages(e,n),this.observePreviewChanges(e,n)}),this.startLivePreviewObserver()}disable(){this.mutationObserver?.disconnect()}processPreviewImages(e,n){this.findImages(e).forEach(i=>{const o=this.getPreviewSource({context:n,contextEl:e}),s=this.getImageOrigin(i,o),r={sourceData:o,element:i,origin:s,elementType:i instanceof HTMLImageElement?"img":"svg",mode:"preview"};this.finalizePreviewSource(r),this.leafIndex.pushImageContext(r)})}observePreviewChanges(e,n){const i=new MutationObserver(o=>{for(const s of this.filteredMutations(o))for(const r of this.getAddedImages(s.addedNodes)){const l=this.getPreviewSource({context:n,contextEl:e}),h=this.getImageOrigin(r,l),u={sourceData:l,element:r,origin:h,elementType:r instanceof HTMLImageElement?"img":"svg",mode:"preview"};this.finalizePreviewSource(u),this.leafIndex.pushImageContext(u)}});i.observe(e,{childList:!0,subtree:!0}),setTimeout(()=>{i.disconnect()},5e3)}startLivePreviewObserver(){this.leafIndex.activeLeafContext&&(this.mutationObserver=new MutationObserver(e=>{for(const n of this.filteredMutations(e))if(!(!(n.target instanceof Element)||!n.target.closest(".markdown-source-view")))for(const i of this.getAddedImages(n.addedNodes)){const o=this.getLivePreviewSource(i),s={origin:this.getImageOrigin(i,o),sourceData:o,element:i,elementType:i instanceof HTMLImageElement?"img":"svg",mode:"live-preview"};this.leafIndex.pushImageContext(s)}}),this.mutationObserver.observe(this.leafIndex.activeLeafContext.view.containerEl,{childList:!0,subtree:!0}))}*filteredMutations(e){for(const n of e)n.type==="childList"&&(yield n)}findImages(e){return Array.from(e.querySelectorAll("img, svg")).filter(n=>!Ut(n))}*getAddedImages(e){for(const n of Array.from(e)){if(!(n instanceof Element))continue;const i=n.matches("svg,img")&&n||n.querySelector("svg,img");!i||Ut(i)||i.matches(".cm-widgetBuffer")||(yield i)}}getPreviewSource(e){const n=e.context.getSectionInfo(e.contextEl);if(!n)return{source:"No source available",lineStart:0,lineEnd:0};if(n.lineEnd===n.lineStart)return{source:n.text,lineStart:n.lineStart,lineEnd:n.lineEnd};const{lineStart:i,lineEnd:o,text:s}=n,r=i,l=o;return{source:s.split(`
`).slice(r,l+1).join(`
`),lineStart:r,lineEnd:l}}getLivePreviewSource(e){const n=this.findElementWithLivePreviewWidget(e)?.cmView?.deco?.widget,i={source:"No source available",lineStart:0,lineEnd:0};return n===void 0?i:"title"in n&&"href"in n&&"start"in n&&"end"in n?{source:`![[${n.href}]]`,lineStart:n.start,lineEnd:n.end}:"url"in n&&"start"in n&&"end"in n?{source:`![${n.title||""}](${n.url})`,lineStart:n.start,lineEnd:n.end}:"code"in n&&"lineStart"in n&&"lineEnd"in n&&"lang"in n?{source:`\`\`\`${n.lang}
${n.code}
\`\`\``,lineStart:n.lineStart,lineEnd:n.lineEnd}:i}findElementWithLivePreviewWidget(e){if(e===void 0)return;let n=e;for(;n&&n!==document.body;){if(n?.cmView)return n;n=n?.parentElement}}getImageOrigin(e,n){return/^```[^\n]+?\n?[\s\S]+?\n?```$/.test(n.source)?"generated":"src"in e&&/^https?:\/\//.test(e.src)?"external":"local"}finalizePreviewSource(e){if(e.origin!=="generated"){const n="alt"in e.element?e.element.alt:"",i="src"in e.element?e.element.src:"",o={lineStart:0,lineEnd:0,source:`![${n}](${i})`};e.sourceData=o}}},Ws=class extends R.Component{constructor(e){super(),this.plugin=e,this.load(),this.setupObsidianEventHandlers()}data=new Map;setupObsidianEventHandlers(){this.plugin.app.workspace.on("layout-change",async()=>{await this.updateIndex()}),this.plugin.app.workspace.on("active-leaf-change",async()=>{await this.updateIndex()})}async updateIndex(){await this.cleanupActiveLeaf(),await this.initializeActiveLeaf(),await this.setupImageIndexer()}async setupImageIndexer(){if(!this.activeLeafContext?.id)return;const e=this.data.get(this.activeLeafContext.id);e&&(e.indexer||(e.indexer=new Gs(this),e.indexer?.enable()))}async onunload(){for(const e of this.data.keys())await this.cleanupLeafData(e)}async initializeActiveLeaf(){const e=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView);e&&(this.activeLeafContext={id:e.leaf.id,view:e},this.initializeLeafData(this.activeLeafContext))}async cleanupActiveLeaf(){this.activeLeafContext?.id&&this.plugin.app.workspace.getLeafById(this.activeLeafContext.id)===null&&(await this.cleanupLeafData(this.activeLeafContext.id),this.activeLeafContext=void 0)}initializeLeafData(e){this.data.get(e.id)||(this.data.set(e.id,{imageIndex:new Map,indexer:void 0}),this.plugin.logger.debug(`Initialized data for leaf width id: ${e.id}...`,{functionName:"initializeLeafData",lineNumber:96,columnNumber:2646,fileName:"src/core/services/leaf-index/leaf-index.ts"}))}async cleanupLeafData(e){if(!this.data.get(e)){this.plugin.logger.error("No data for leaf",{leafID:e,functionName:"cleanupLeafData",lineNumber:104,columnNumber:3061,fileName:"src/core/services/leaf-index/leaf-index.ts"});return}this.data.delete(e),this.plugin.logger.debug(`Data for leaf with id ${e} was cleaned successfully.`,{functionName:"cleanupLeafData",lineNumber:111,columnNumber:3383,fileName:"src/core/services/leaf-index/leaf-index.ts"})}finalizeElementContext(e){if(!(!e.element||!e.elementType||!e.origin||!e.mode||!e.sourceData))return e}pushImageContext(e){if(!this.activeLeafContext)return;const n=this.finalizeElementContext(e);if(!n){this.plugin.logger.warn("Invalid image context data, cannot push to index.",{functionName:"pushImageContext",lineNumber:137,columnNumber:4235,fileName:"src/core/services/leaf-index/leaf-index.ts"});return}const i=this.data.get(this.activeLeafContext.id);i&&(i.imageIndex.get(n.element)||(i.imageIndex.set(n.element,n),this.plugin.emitter.emit("leaf-index.image.added",n)))}},Ys=class{constructor(e){this.plugin=e}isFirstLaunch=!1;shouldShowTips=!1;async initialize(){this.isFirstLaunch=await this.getIsFirstLaunch(),this.shouldShowTips=this.getShouldShowTips()}async getIsFirstLaunch(){const e=await this.getPluginCtime(),n=this.plugin.app.loadLocalStorage("izd-ctime");return typeof n!="string"?(this.plugin.app.saveLocalStorage("izd-ctime",e),!0):n===e?!1:(this.plugin.app.saveLocalStorage("izd-ctime",e),!0)}getShouldShowTips(){if(typeof this.plugin.app.loadLocalStorage("izd-should-show-tips")=="string")return!1;const e=this.plugin.app.loadLocalStorage("izd-ctime");if(typeof e!="string")return!0;const n=R.moment(Number(e)),i=R.moment().diff(n,"weeks")>=1;return i&&this.markTipsViewed(),!i}markTipsViewed(){this.plugin.app.saveLocalStorage("izd-should-show-tips","viewed")}async getPluginCtime(){const e=this.plugin.manifest.dir;if(!e)throw new Error("Plugin directory not found in manifest");return((await this.plugin.app.vault.adapter.stat(e))?.ctime??0).toString()}};function ie(t,e){return t.replace(/\{\{(\w+)\}\}/g,(n,i)=>e[i]??`{{${i}}}`)}let f;async function Ks(){f=(await Promise.resolve().then(function(){return Fu})).t}const qs=Ks();class Zs{constructor(e){this.integratedMode=e}get leafID(){return this.leaf&&this.leaf.id}get active(){return this.leaf!==void 0&&this.view!==void 0&&this.view.file!==null}get inPreviewMode(){return this.view?.getState()?.mode==="preview"}get inLivePreviewMode(){const e=this.view?.getState();return!e?.source&&e?.mode==="source"}get nativeTouchEventsEnabled(){const e=this.integratedMode.state.data.get(this.leafID);if(e)return e.nativeTouchEventsEnabled}initialize(e){const n=this.integratedMode.plugin.app.workspace.getActiveViewOfType(R.MarkdownView);n&&(this.leaf=n.leaf,this.view=n,e(this.leafID))}cleanup(e){this.leaf&&this.integratedMode.plugin.app.workspace.getLeafById(this.leafID)===null&&(e(this.leafID),this.view=void 0,this.leaf=void 0)}getAvailableSize(){if(!this.active)return{width:0,height:0};const e=this.inPreviewMode?".markdown-preview-view":".markdown-source-view",n=this.view.contentEl.querySelector(e);if(!n)return{width:0,height:0};const i=n.querySelector(".markdown-preview-sizer, .cm-sizer"),o=i&&parseInt(window.getComputedStyle(i).marginLeft)||0;return{width:n.clientWidth*.9-o,height:n.clientHeight*.9}}}var Le=(t=>(t.Default=".izd-default",t.IMG_SVG="img,svg",t.Mermaid=".mermaid",t.Mehrmaid=".block-language-mehrmaid",t.PlantUML=".block-language-plantuml",t.Graphviz=".block-language-dot",t))(Le||{}),q=(t=>(t[t.NONE=1]="NONE",t[t.MOUSE=2]="MOUSE",t[t.FOCUS=4]="FOCUS",t[t.KEYPRESS=8]="KEYPRESS",t[t.FOLD=16]="FOLD",t[t.FORCE=32]="FORCE",t[t.SERVICE_HIDING=64]="SERVICE_HIDING",t))(q||{}),jt=(t=>(t.Interactive="interactive",t.NonInteractive="non-interactive",t))(jt||{}),vt=(t=>(t.Initialized="initialized",t.NotInitialized="not-initialized",t))(vt||{});class Xs{constructor(e){this.unit=e}moveElement(e,n,i){const o=this.unit.context.content;this.unit.dx+=e,this.unit.dy+=n,o.setCssStyles({transition:i?.animated?"transform 0.3s ease-out":"none",transform:`translate(${this.unit.dx}px, ${this.unit.dy}px) scale(${this.unit.scale})`}),i?.animated&&this.unit.registerDomEvent(o,"transitionend",()=>{o.setCssStyles({transition:"none"})},{once:!0})}zoomElement(e,n){const{content:i,container:o}=this.unit.context,s=o.getBoundingClientRect(),r=s.left+s.width/2,l=s.top+s.height/2,h=i.getBoundingClientRect(),u=h.left+h.width/2,p=h.top+h.height/2,c=(r-u)/this.unit.scale,v=(l-p)/this.unit.scale;this.unit.scale*=e,this.unit.scale=Math.max(.125,this.unit.scale),this.unit.dx=this.unit.dx-c*(e-1)*this.unit.scale/e,this.unit.dy=this.unit.dy-v*(e-1)*this.unit.scale/e,i.setCssStyles({transition:n?.animated?"transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)":"none",transform:`translate(${this.unit.dx}px, ${this.unit.dy}px) scale(${this.unit.scale})`}),n?.animated&&this.unit.registerDomEvent(i,"transitionend",()=>{i.setCssStyles({transition:"none"})},{once:!0})}resetZoomAndMove(e){this.fitToContainer(e)}fitToContainer(e){const{content:n,container:i}=this.unit.context,o=i.clientWidth,s=i.clientHeight,r=n.clientWidth,l=n.clientHeight;this.unit.scale=Math.min(o/r,s/l,1),this.unit.dx=(o-r*this.unit.scale)/2,this.unit.dy=(s-l*this.unit.scale)/2,n.setCssStyles({transition:e?.animated?"transform 0.3s cubic-bezier(0.42, 0, 0.58, 1)":"none",transform:`translate(${this.unit.dx}px, ${this.unit.dy}px) scale(${this.unit.scale})`,transformOrigin:"top left"}),e?.animated&&this.unit.registerDomEvent(n,"transitionend",()=>{n.setCssStyles({transition:"none"})},{once:!0})}async toggleFullscreen(){const e=this.unit.context.container;document.fullscreenElement?(e.removeClass("is-fullscreen"),await document.exitFullscreen()):(e.addClass("is-fullscreen"),await e.requestFullscreen({navigationUI:"auto"})),requestAnimationFrame(()=>{this.resetZoomAndMove()})}}function Fe(t,e,n){e&&R.setIcon(t,e),n&&R.setTooltip(t,n)}class xt extends R.Component{constructor(e){super(),this.controlPanel=e}setupPanelContents(){this.getButtonsConfig().forEach(e=>{const n=this.createButton(e.icon,e.action,e.title,e.id,e.gridArea);this.buttons.set(e.id,{element:n,listener:e.action}),e.dataAttributes&&Object.entries(e.dataAttributes).forEach(([i,o])=>{n.setAttribute(i,o)}),this.panel.appendChild(n)})}get unit(){return this.controlPanel.unit}initialize(){if(!this.enabled)return;const e=["izd-fold-panel","izd-tip-panel"];!this.controlPanel.canRender&&!e.includes(this.cssClass)||(this.panel=this.createPanelElement(),this.setupPanelContents(),this.visibilityInitialization())}createPanelElement(){const e=this.controlPanel.controlPanel.createEl("div");return e.addClass(this.cssClass),e.addClass("izd-panel"),e.addClass("visible"),e.setCssStyles(this.cssStyles),e}createButton(e,n,i,o,s){const r=document.createElement("button");return r.id=o,r.setCssStyles({background:"transparent",border:"none",color:"var(--text-muted)",cursor:"pointer",padding:"4px",borderRadius:"3px",display:"flex",justifyContent:"center",alignItems:"center",transition:"background-color 0.2s ease",gridArea:s??"unset"}),Fe(r,e,i),this.registerDomEvent(r,"click",n),this.registerDomEvent(r,"mouseenter",()=>{r.setCssStyles({color:"var(--interactive-accent)"})}),this.registerDomEvent(r,"mouseleave",()=>{r.setCssStyles({color:"var(--text-muted)"})}),r}visibilityInitialization(){const e=this.controlPanel.unit.plugin.settings.$.panels.global.triggering.mode,n=this.controlPanel.unit.context.container.dataset.folded==="true";let i=q.NONE;n&&(i|=q.FOLD),e==="focus"&&(i|=q.FOCUS),e==="hover"&&(i|=q.MOUSE),this.hide(i)}show(e){this.shouldRespondToTrigger(e)&&this.panel&&(this.panel.removeClass("hidden"),this.panel.addClass("visible"))}hide(e){this.shouldRespondToTrigger(e)&&this.panel&&(this.panel.removeClass("visible"),this.panel.addClass("hidden"))}isVisible(){return this.panel?.classList?.contains("visible")&&!this.panel.classList.contains("hidden")}shouldRespondToTrigger(e){return e===q.FORCE?!0:!!(this.supportedTriggers&e)}get supportedTriggers(){const e=this.unit.plugin.settings.$.panels.global.triggering;let n=q.FORCE|q.FOLD|q.SERVICE_HIDING;return e.mode==="hover"&&(n=n|q.MOUSE),e.mode==="focus"&&(n=n|q.FOCUS),n}onunload(){super.onunload()}}var xn=(t=>(t.Fold="fold",t))(xn||{}),Pe=(t=>(t.Up="up",t.Down="down",t.Left="left",t.Right="right",t.UpRight="upRight",t.UpLeft="upLeft",t.DownLeft="downLeft",t.DownRight="downRight",t))(Pe||{}),Re=(t=>(t.Hide="hide",t.Fullscreen="fullscreen",t.Touch="touch",t))(Re||{}),Dt=(t=>(t.In="in",t.Out="out",t.Reset="reset",t))(Dt||{}),ao=(t=>(t.Ribbon="ribbon",t))(ao||{});let Js=class extends xt{constructor(e){super(e),this.controlPanel=e,this.setupSubscriptions()}buttons=new Map;title={folded:f("g"),expanded:f("f")};get enabled(){return!0}get cssStyles(){return{position:"absolute",left:"50%",bottom:"0",transform:"translateX(-50%)",gridTemplateColumns:"1fr"}}get cssClass(){return"izd-fold-panel"}getButtonsConfig(){return this.unit.context.container.setAttribute("data-folded",this.unit.plugin.settings.$.units.folding.foldByDefault.toString()),[{icon:"",action:()=>{this.unit.context.container.dataset.folded==="true"?this.unfold():this.fold()},title:"",id:xn.Fold}]}fold(){this.unit.context.container.setAttribute("data-folded","true"),this.unit.applyLayout(),this.controlPanel.hide(q.FOLD)}unfold(){this.unit.context.container.setAttribute("data-folded","false"),this.unit.applyLayout(),this.controlPanel.show(q.FOLD)}get supportedTriggers(){return super.supportedTriggers&~q.FOLD&~q.SERVICE_HIDING&~q.FOCUS&~q.MOUSE}setupSubscriptions(){const e=n=>n.target===this.unit.context.container&&n.type==="attributes"&&n.attributeName==="data-folded";this.register(()=>this.unit.plugin.domWatcher.unsubscribe(e)),this.unit.plugin.domWatcher.subscribe(e,n=>{if(!(n.target instanceof HTMLElement))return;const i=n.target.dataset.folded==="true",o=this.buttons.get(xn.Fold);o&&Fe(o.element,i?"unfold-vertical":"fold-vertical",this.title[i?"folded":"expanded"])})}};var We=(t=>(t.ALWAYS="always",t.HOVER="hover",t.FOCUS="focus",t))(We||{}),lo=(t=>(t.None="none",t.Debug="debug",t.Info="info",t.Warn="warn",t.Error="error",t))(lo||{});class Qs extends xt{buttons=new Map;constructor(e){super(e)}get enabled(){return this.unit.plugin.settings.$.panels.local.panels.move.on&&this.unit.context.options.panels.move?.on}get cssClass(){return"izd-move-panel"}get cssStyles(){return{...this.unit.plugin.settings.$.panels.local.panels.move.position,gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"repeat(3, 1fr)"}}getButtonsConfig(){const e=this.unit.plugin.settings.$.panels.local.panels.move.buttons;return[{id:Pe.UpLeft,icon:"arrow-up-left",title:f("p"),gridArea:"1 / 1",x:50,y:50},{id:Pe.Up,icon:"arrow-up",title:f("o"),gridArea:"1 / 2",x:0,y:50},{id:Pe.UpRight,icon:"arrow-up-right",title:f("q"),gridArea:"1 / 3",x:-50,y:50},{id:Pe.Left,icon:"arrow-left",title:f("p"),gridArea:"2 / 1",x:50,y:0},{id:Pe.Right,icon:"arrow-right",title:f("n"),gridArea:"2 / 3",x:-50,y:0},{id:Pe.DownLeft,icon:"arrow-down-left",title:f("j"),gridArea:"3 / 1",x:50,y:-50},{id:Pe.Down,icon:"arrow-down",title:f("i"),gridArea:"3 / 2",x:0,y:-50},{id:Pe.DownRight,icon:"arrow-down-right",title:f("k"),gridArea:"3 / 3",x:-50,y:-50}].filter(n=>e[n.id]).map(n=>({id:n.id,icon:n.icon,action:()=>this.unit.actions.moveElement(n.x,n.y,{animated:!0}),title:n.title,gridArea:n.gridArea}))}setupPanelContents(){super.setupPanelContents(),this.panel.toggleClass("hidden",this.unit.plugin.settings.$.panels.global.triggering.mode!==We.ALWAYS)}}class er extends xt{buttons=new Map;constructor(e){super(e)}initialize(){super.initialize(),this.setupEventListeners()}get enabled(){return this.unit.plugin.settings.$.panels.local.panels.service.on&&this.unit.context.options.panels.service.on}get cssClass(){return"izd-service-panel"}get cssStyles(){return{...this.unit.plugin.settings.$.panels.local.panels.service.position,gridTemplateColumns:"repeat(auto-fit, minmax(24px, 1fr))",gridAutoFlow:"column"}}getButtonsConfig(){const e=[],n=this.unit.plugin.settings.$.panels.local.panels.service.buttons;return n.hide&&e.push({id:Re.Hide,icon:"eye",action:()=>{const i=this.buttons.get(Re.Hide)?.element;if(!i)return;const o=i.dataset.hiding==="true",s=!o;i.dataset.hiding=s.toString(),o?this.controlPanel.show(q.SERVICE_HIDING):this.controlPanel.hide(q.SERVICE_HIDING),Fe(i,o?"eye":"eye-off",f(s?"u":"w"))},title:f("w"),dataAttributes:{hiding:"false"}}),n.fullscreen&&e.push({id:Re.Fullscreen,icon:"maximize",action:async()=>{const i=this.buttons.get(Re.Fullscreen)?.element;i&&(await this.unit.actions.toggleFullscreen(),document.fullscreenElement===this.unit.context.container?Fe(i,"maximize",f("t")):Fe(i,"minimize",f("s")))},title:f("t")}),e}setupPanelContents(){const e=this.unit.plugin.settings;this.panel.toggleClass("hidden",e.$.panels.global.triggering.mode!==We.ALWAYS&&!e.$.panels.global.triggering.ignoreService),super.setupPanelContents()}setupEventListeners(){this.buttons.get(Re.Fullscreen)?.element&&this.registerDomEvent(this.unit.context.container,"fullscreenchange",this.onFullScreenChange)}onFullScreenChange=()=>{const e=this.buttons.get(Re.Fullscreen)?.element;e&&(document.fullscreenElement?(requestAnimationFrame(()=>{this.unit.actions.resetZoomAndMove()}),Fe(e,"minimize",f("t"))):(requestAnimationFrame(()=>{this.unit.actions.resetZoomAndMove()}),Fe(e,"maximize",f("s"))))};get supportedTriggers(){const e=super.supportedTriggers&~q.SERVICE_HIDING;if(!this.unit.plugin.settings.$.panels.global.triggering.ignoreService)return e;const n=q.MOUSE|q.FOCUS;return e&~n}}let tr=class extends xt{buttons=new Map;constructor(e){super(e)}get enabled(){return!0}get cssClass(){return"izd-tip-panel"}get cssStyles(){return{position:"absolute",left:"0%",top:"0%"}}getButtonsConfig(){const{plugin:e}=this.unit;return!e.userState.shouldShowTips||e.help.isHelpOpen?[]:[{id:ao.Ribbon,icon:"ribbon",action:()=>{this.unit.plugin.help.showModal("minimal")},title:"Tips"}]}get supportedTriggers(){return super.supportedTriggers}};class nr extends xt{buttons=new Map;constructor(e){super(e)}get enabled(){return this.controlPanel.unit.plugin.settings.$.panels.local.panels.zoom.on&&this.controlPanel.unit.context.options.panels.zoom.on}get cssClass(){return"izd-zoom-panel"}get cssStyles(){return{...this.controlPanel.unit.plugin.settings.$.panels.local.panels.zoom.position,transform:"translateY(-50%)",gridTemplateColumns:"1fr"}}getButtonsConfig(){const e=this.controlPanel.unit.plugin.settings.$.panels.local.panels.zoom.buttons,n=[];return e.in&&n.push({id:Dt.In,icon:"zoom-in",action:()=>this.controlPanel.unit.actions.zoomElement(1.1,{animated:!0}),title:f("y")}),e.reset&&n.push({id:Dt.Reset,icon:"refresh-cw",action:()=>this.controlPanel.unit.actions.resetZoomAndMove({animated:!0}),title:f("B")}),e.out&&n.push({id:Dt.Out,icon:"zoom-out",action:()=>this.controlPanel.unit.actions.zoomElement(.9,{animated:!0}),title:f("A")}),n}setupPanelContents(){this.panel.toggleClass("hidden",this.controlPanel.unit.plugin.settings.$.panels.global.triggering.mode!==We.ALWAYS),super.setupPanelContents()}}class Qe extends R.Component{constructor(e){super(),this.unit=e}static BUTTON_SIZE=34;static MIN_BUTTONS_HEIGHT=7;static MIN_BUTTONS_WIDTH=4;initialize(){this.load(),this.controlPanel=this.unit.context.container.createDiv(),this.controlPanel.addClass("izd-control-panel"),this.move=new Qs(this),this.zoom=new nr(this),this.fold=new Js(this),this.service=new er(this),this.tip=new tr(this),this.panels.forEach(e=>{this.addChild(e),e.initialize()}),this.unit.context.container.appendChild(this.controlPanel)}get canRender(){const{width:e,height:n}=this.unit.realSize;return n>=Qe.BUTTON_SIZE*Qe.MIN_BUTTONS_HEIGHT&&e>=Qe.BUTTON_SIZE*Qe.MIN_BUTTONS_WIDTH}get panels(){return[this.move,this.zoom,this.fold,this.service,this.tip]}show(e=q.FORCE){this.canRender&&this.panels.forEach(n=>n.show(e))}hide(e=q.FORCE){this.canRender&&this.panels.forEach(n=>n.hide(e))}get hasVisiblePanels(){return this.panels.some(e=>e.isVisible())}onunload(){super.onunload(),this.controlPanel?.remove()}}let co=class{async imgToBlob(e,n){let i;if(e instanceof SVGElement)n==="svg"?i=this.svgToBlob(e):i=await this.drawSVGAsRaster(e,n==="png"?"png":"jpeg");else{const o=n==="png"?"png":"jpeg";try{i=await this.fetchImg(e,o)}catch{i=await this.drawLocalImage(e,o)}}return i}async drawSVGAsRaster(e,n){const i=this.svgToCode(e),o=new Image,s=document.createElement("canvas"),r=s.getContext("2d"),l=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(i)}`;return o.src=l,await new Promise((h,u)=>{o.onload=h,o.onerror=u}),s.width=o.naturalWidth||800,s.height=o.naturalHeight||600,r.drawImage(o,0,0),new Promise(h=>{s.toBlob(u=>h(u),`image/${n}`)})}svgToCode(e){return e instanceof SVGElement?new XMLSerializer().serializeToString(e):""}svgToBlob(e){const n=this.svgToCode(e),i=`<?xml version="1.0" standalone="no"?>\r
`;return new Blob([i,n],{type:"image/svg+xml;charset=utf-8"})}async fetchImg(e,n){const i=await R.requestUrl(e.src);return new Blob([i.arrayBuffer],{type:`image/${n}`})}async drawLocalImage(e,n){const i=document.createElement("canvas"),o=i.getContext("2d");return i.width=e.naturalWidth,i.height=e.naturalHeight,o.drawImage(e,0,0),new Promise(s=>{i.toBlob(r=>s(r),`image/${n}`)})}};class ir extends R.Component{constructor(e){super(),this.contextMenu=e,this.imageConverter=new co}async copyAsPNG(e){try{const n=await this.imageConverter.imgToBlob(e,"png");await this.writeToBuffer(n,"png")}catch(n){this.contextMenu.events.unit.plugin.logger.error("Error copying as PNG:",{...n,functionName:"copyAsPNG",lineNumber:19,columnNumber:609,fileName:"src/modes/integrated-mode/integrated-unit/events/handlers/context-menu/context-actions/copy.ts"}),this.contextMenu.events.unit.plugin.showNotice("Failed to copy image as PNG. Please try again.")}}async copyAsPlain(e){const n=this.imageConverter.svgToCode(e),i=new Blob([n],{type:"text/plain"});await this.writeToBuffer(i,"plain")}async copyAsSource(){const e=this.contextMenu.events.unit.context.sourceData.source,n=new Blob([e],{type:"text/plain"});await this.writeToBuffer(n,"plain")}async writeToBuffer(e,n){const i={png:"image/png",plain:"text/plain"}[n];await navigator.clipboard.write([new ClipboardItem({[i]:e})])}}class or extends R.Component{constructor(e){super(),this.contextMenu=e,this.imageConverter=new co}async exportAsPNG(e){try{const n=await this.imageConverter.imgToBlob(e,"png");this.downloadFile(n,"png")}catch(n){this.contextMenu.events.unit.plugin.logger.error("Error exporting as PNG:",{...n,functionName:"exportAsPNG",lineNumber:19,columnNumber:614,fileName:"src/modes/integrated-mode/integrated-unit/events/handlers/context-menu/context-actions/export.ts"}),this.contextMenu.events.unit.plugin.showNotice("Failed to export image as PNG. Please try again.")}}async exportAsJPG(e){try{const n=await this.imageConverter.imgToBlob(e,"jpg");this.downloadFile(n,"jpg")}catch(n){this.contextMenu.events.unit.plugin.logger.error("Error exporting as JPG:",{...n,functionName:"exportAsJPG",lineNumber:35,columnNumber:1362,fileName:"src/modes/integrated-mode/integrated-unit/events/handlers/context-menu/context-actions/export.ts"}),this.contextMenu.events.unit.plugin.showNotice("Failed to export image as JPG. Please try again.")}}async exportAsSVG(e){try{const n=await this.imageConverter.imgToBlob(e,"svg");this.downloadFile(n,"svg")}catch(n){this.contextMenu.events.unit.plugin.logger.error("Error exporting as SVG:",{...n,functionName:"exportAsSVG",lineNumber:51,columnNumber:2092,fileName:"src/modes/integrated-mode/integrated-unit/events/handlers/context-menu/context-actions/export.ts"}),this.contextMenu.events.unit.plugin.showNotice("Failed to export SVG. Please try again.")}}downloadFile(e,n){const{unit:i}=this.contextMenu.events,o=`export_${i.plugin.integratedMode.context.view?.file?.basename??"unit"}}_${R.moment().format("YYYYMMDDHHmmss")}.${n}`,s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}}var Ct,H,uo,Ue,pi,ho,po,go,Bn,Cn,Sn,mo,yt={},fo=[],sr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,St=Array.isArray;function Ce(t,e){for(var n in e)t[n]=e[n];return t}function Hn(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function ue(t,e,n){var i,o,s,r={};for(s in e)s=="key"?i=e[s]:s=="ref"?o=e[s]:r[s]=e[s];if(arguments.length>2&&(r.children=arguments.length>3?Ct.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)r[s]===void 0&&(r[s]=t.defaultProps[s]);return gt(t,r,i,o,null)}function gt(t,e,n,i,o){var s={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++uo,__i:-1,__u:0};return o==null&&H.vnode!=null&&H.vnode(s),s}function vo(){return{current:null}}function W(t){return t.children}function we(t,e){this.props=t,this.context=e}function nt(t,e){if(e==null)return t.__?nt(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?nt(t):null}function yo(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return yo(t)}}function $n(t){(!t.__d&&(t.__d=!0)&&Ue.push(t)&&!Bt.__r++||pi!=H.debounceRendering)&&((pi=H.debounceRendering)||ho)(Bt)}function Bt(){for(var t,e,n,i,o,s,r,l=1;Ue.length;)Ue.length>l&&Ue.sort(po),t=Ue.shift(),l=Ue.length,t.__d&&(n=void 0,o=(i=(e=t).__v).__e,s=[],r=[],e.__P&&((n=Ce({},i)).__v=i.__v+1,H.vnode&&H.vnode(n),Vn(e.__P,n,i,e.__n,e.__P.namespaceURI,32&i.__u?[o]:null,s,o??nt(i),!!(32&i.__u),r),n.__v=i.__v,n.__.__k[n.__i]=n,_o(s,n,r),n.__e!=o&&yo(n)));Bt.__r=0}function bo(t,e,n,i,o,s,r,l,h,u,p){var c,v,m,x,C,P,S=i&&i.__k||fo,E=e.length;for(h=rr(n,e,S,h,E),c=0;c<E;c++)(m=n.__k[c])!=null&&(v=m.__i==-1?yt:S[m.__i]||yt,m.__i=c,P=Vn(t,m,v,o,s,r,l,h,u,p),x=m.__e,m.ref&&v.ref!=m.ref&&(v.ref&&Gn(v.ref,null,m),p.push(m.ref,m.__c||x,m)),C==null&&x!=null&&(C=x),4&m.__u||v.__k===m.__k?h=wo(m,h,t):typeof m.type=="function"&&P!==void 0?h=P:x&&(h=x.nextSibling),m.__u&=-7);return n.__e=C,h}function rr(t,e,n,i,o){var s,r,l,h,u,p=n.length,c=p,v=0;for(t.__k=new Array(o),s=0;s<o;s++)(r=e[s])!=null&&typeof r!="boolean"&&typeof r!="function"?(h=s+v,(r=t.__k[s]=typeof r=="string"||typeof r=="number"||typeof r=="bigint"||r.constructor==String?gt(null,r,null,null,null):St(r)?gt(W,{children:r},null,null,null):r.constructor==null&&r.__b>0?gt(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):r).__=t,r.__b=t.__b+1,l=null,(u=r.__i=ar(r,n,h,c))!=-1&&(c--,(l=n[u])&&(l.__u|=2)),l==null||l.__v==null?(u==-1&&(o>p?v--:o<p&&v++),typeof r.type!="function"&&(r.__u|=4)):u!=h&&(u==h-1?v--:u==h+1?v++:(u>h?v--:v++,r.__u|=4))):t.__k[s]=null;if(c)for(s=0;s<p;s++)(l=n[s])!=null&&(2&l.__u)==0&&(l.__e==i&&(i=nt(l)),Co(l,l));return i}function wo(t,e,n){var i,o;if(typeof t.type=="function"){for(i=t.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=t,e=wo(i[o],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=nt(t)),n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Me(t,e){return e=e||[],t==null||typeof t=="boolean"||(St(t)?t.some(function(n){Me(n,e)}):e.push(t)),e}function ar(t,e,n,i){var o,s,r,l=t.key,h=t.type,u=e[n],p=u!=null&&(2&u.__u)==0;if(u===null&&t.key==null||p&&l==u.key&&h==u.type)return n;if(i>(p?1:0)){for(o=n-1,s=n+1;o>=0||s<e.length;)if((u=e[r=o>=0?o--:s++])!=null&&(2&u.__u)==0&&l==u.key&&h==u.type)return r}return-1}function gi(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||sr.test(e)?n:n+"px"}function Pt(t,e,n,i,o){var s,r;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||gi(t.style,e,"");if(n)for(e in n)i&&n[e]==i[e]||gi(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(go,"$1")),r=e.toLowerCase(),e=r in t||e=="onFocusOut"||e=="onFocusIn"?r.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?i?n.u=i.u:(n.u=Bn,t.addEventListener(e,s?Sn:Cn,s)):t.removeEventListener(e,s?Sn:Cn,s);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function mi(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=Bn++;else if(e.t<n.u)return;return n(H.event?H.event(e):e)}}}function Vn(t,e,n,i,o,s,r,l,h,u){var p,c,v,m,x,C,P,S,E,M,A,L,D,T,G,U,pe,re=e.type;if(e.constructor!=null)return null;128&n.__u&&(h=!!(32&n.__u),s=[l=e.__e=n.__e]),(p=H.__b)&&p(e);e:if(typeof re=="function")try{if(S=e.props,E="prototype"in re&&re.prototype.render,M=(p=re.contextType)&&i[p.__c],A=p?M?M.props.value:p.__:i,n.__c?P=(c=e.__c=n.__c).__=c.__E:(E?e.__c=c=new re(S,A):(e.__c=c=new we(S,A),c.constructor=re,c.render=cr),M&&M.sub(c),c.props=S,c.state||(c.state={}),c.context=A,c.__n=i,v=c.__d=!0,c.__h=[],c._sb=[]),E&&c.__s==null&&(c.__s=c.state),E&&re.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=Ce({},c.__s)),Ce(c.__s,re.getDerivedStateFromProps(S,c.__s))),m=c.props,x=c.state,c.__v=e,v)E&&re.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),E&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(E&&re.getDerivedStateFromProps==null&&S!==m&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(S,A),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(S,c.__s,A)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(c.props=S,c.state=c.__s,c.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(ge){ge&&(ge.__=e)}),L=0;L<c._sb.length;L++)c.__h.push(c._sb[L]);c._sb=[],c.__h.length&&r.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(S,c.__s,A),E&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(m,x,C)})}if(c.context=A,c.props=S,c.__P=t,c.__e=!1,D=H.__r,T=0,E){for(c.state=c.__s,c.__d=!1,D&&D(e),p=c.render(c.props,c.state,c.context),G=0;G<c._sb.length;G++)c.__h.push(c._sb[G]);c._sb=[]}else do c.__d=!1,D&&D(e),p=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++T<25);c.state=c.__s,c.getChildContext!=null&&(i=Ce(Ce({},i),c.getChildContext())),E&&!v&&c.getSnapshotBeforeUpdate!=null&&(C=c.getSnapshotBeforeUpdate(m,x)),U=p,p!=null&&p.type===W&&p.key==null&&(U=xo(p.props.children)),l=bo(t,St(U)?U:[U],e,n,i,o,s,r,l,h,u),c.base=e.__e,e.__u&=-161,c.__h.length&&r.push(c),P&&(c.__E=c.__=null)}catch(ge){if(e.__v=null,h||s!=null)if(ge.then){for(e.__u|=h?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,e.__e=l}else{for(pe=s.length;pe--;)Hn(s[pe]);kn(e)}else e.__e=n.__e,e.__k=n.__k,ge.then||kn(e);H.__e(ge,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):l=e.__e=lr(n.__e,e,n,i,o,s,r,h,u);return(p=H.diffed)&&p(e),128&e.__u?void 0:l}function kn(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(kn)}function _o(t,e,n){for(var i=0;i<n.length;i++)Gn(n[i],n[++i],n[++i]);H.__c&&H.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(s){s.call(o)})}catch(s){H.__e(s,o.__v)}})}function xo(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:St(t)?t.map(xo):Ce({},t)}function lr(t,e,n,i,o,s,r,l,h){var u,p,c,v,m,x,C,P=n.props,S=e.props,E=e.type;if(E=="svg"?o="http://www.w3.org/2000/svg":E=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),s!=null){for(u=0;u<s.length;u++)if((m=s[u])&&"setAttribute"in m==!!E&&(E?m.localName==E:m.nodeType==3)){t=m,s[u]=null;break}}if(t==null){if(E==null)return document.createTextNode(S);t=document.createElementNS(o,E,S.is&&S),l&&(H.__m&&H.__m(e,s),l=!1),s=null}if(E==null)P===S||l&&t.data==S||(t.data=S);else{if(s=s&&Ct.call(t.childNodes),P=n.props||yt,!l&&s!=null)for(P={},u=0;u<t.attributes.length;u++)P[(m=t.attributes[u]).name]=m.value;for(u in P)if(m=P[u],u!="children"){if(u=="dangerouslySetInnerHTML")c=m;else if(!(u in S)){if(u=="value"&&"defaultValue"in S||u=="checked"&&"defaultChecked"in S)continue;Pt(t,u,null,m,o)}}for(u in S)m=S[u],u=="children"?v=m:u=="dangerouslySetInnerHTML"?p=m:u=="value"?x=m:u=="checked"?C=m:l&&typeof m!="function"||P[u]===m||Pt(t,u,m,P[u],o);if(p)l||c&&(p.__html==c.__html||p.__html==t.innerHTML)||(t.innerHTML=p.__html),e.__k=[];else if(c&&(t.innerHTML=""),bo(e.type=="template"?t.content:t,St(v)?v:[v],e,n,i,E=="foreignObject"?"http://www.w3.org/1999/xhtml":o,s,r,s?s[0]:n.__k&&nt(n,0),l,h),s!=null)for(u=s.length;u--;)Hn(s[u]);l||(u="value",E=="progress"&&x==null?t.removeAttribute("value"):x!=null&&(x!==t[u]||E=="progress"&&!x||E=="option"&&x!=P[u])&&Pt(t,u,x,P[u],o),u="checked",C!=null&&C!=t[u]&&Pt(t,u,C,P[u],o))}return t}function Gn(t,e,n){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(o){H.__e(o,n)}}function Co(t,e,n){var i,o;if(H.unmount&&H.unmount(t),(i=t.ref)&&(i.current&&i.current!=t.__e||Gn(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(s){H.__e(s,e)}i.base=i.__P=null}if(i=t.__k)for(o=0;o<i.length;o++)i[o]&&Co(i[o],e,n||typeof t.type!="function");n||Hn(t.__e),t.__c=t.__=t.__e=void 0}function cr(t,e,n){return this.constructor(t,n)}function bt(t,e,n){var i,o,s,r;e==document&&(e=document.documentElement),H.__&&H.__(t,e),o=(i=typeof n=="function")?null:n&&n.__k||e.__k,s=[],r=[],Vn(e,t=(!i&&n||e).__k=ue(W,null,[t]),o||yt,yt,e.namespaceURI,!i&&n?[n]:o?null:e.firstChild?Ct.call(e.childNodes):null,s,!i&&n?n:o?o.__e:e.firstChild,i,r),_o(s,t,r)}function So(t,e){bt(t,e,So)}function ur(t,e,n){var i,o,s,r,l=Ce({},t.props);for(s in t.type&&t.type.defaultProps&&(r=t.type.defaultProps),e)s=="key"?i=e[s]:s=="ref"?o=e[s]:l[s]=e[s]===void 0&&r!=null?r[s]:e[s];return arguments.length>2&&(l.children=arguments.length>3?Ct.call(arguments,2):n),gt(t.type,l,i||t.key,o||t.ref,null)}function ze(t){function e(n){var i,o;return this.getChildContext||(i=new Set,(o={})[e.__c]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){i=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&i.forEach(function(r){r.__e=!0,$n(r)})},this.sub=function(s){i.add(s);var r=s.componentWillUnmount;s.componentWillUnmount=function(){i&&i.delete(s),r&&r.call(s)}}),n.children}return e.__c="__cC"+mo++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,i){return n.children(i)}).contextType=e,e}Ct=fo.slice,H={__e:function(t,e,n,i){for(var o,s,r;e=e.__;)if((o=e.__c)&&!o.__)try{if((s=o.constructor)&&s.getDerivedStateFromError!=null&&(o.setState(s.getDerivedStateFromError(t)),r=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,i||{}),r=o.__d),r)return o.__E=o}catch(l){t=l}throw t}},uo=0,we.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Ce({},this.state),typeof t=="function"&&(t=t(Ce({},n),this.props)),t&&Ce(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),$n(this))},we.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),$n(this))},we.prototype.render=W,Ue=[],ho=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,po=function(t,e){return t.__v.__b-e.__v.__b},Bt.__r=0,go=/(PointerCapture)$|Capture$/i,Bn=0,Cn=mi(!1),Sn=mi(!0),mo=0;var dr=0;function a(t,e,n,i,o,s){e||(e={});var r,l,h=e;if("ref"in h)for(l in h={},e)l=="ref"?r=e[l]:h[l]=e[l];var u={type:t,props:h,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--dr,__i:-1,__u:0,__source:o,__self:s};if(typeof t=="function"&&(r=t.defaultProps))for(l in r)h[l]===void 0&&(h[l]=r[l]);return H.vnode&&H.vnode(u),u}var De,Q,dn,fi,it=0,$o=[],ne=H,vi=ne.__b,yi=ne.__r,bi=ne.diffed,wi=ne.__c,_i=ne.unmount,xi=ne.__;function Ye(t,e){ne.__h&&ne.__h(Q,t,it||e),it=0;var n=Q.__H||(Q.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function z(t){return it=1,Kt(ko,t)}function Kt(t,e,n){var i=Ye(De++,2);if(i.t=t,!i.__c&&(i.__=[n?n(e):ko(void 0,e),function(l){var h=i.__N?i.__N[0]:i.__[0],u=i.t(h,l);h!==u&&(i.__N=[u,i.__[1]],i.__c.setState({}))}],i.__c=Q,!Q.__f)){var o=function(l,h,u){if(!i.__c.__H)return!0;var p=i.__c.__H.__.filter(function(v){return!!v.__c});if(p.every(function(v){return!v.__N}))return!s||s.call(this,l,h,u);var c=i.__c.props!==l;return p.forEach(function(v){if(v.__N){var m=v.__[0];v.__=v.__N,v.__N=void 0,m!==v.__[0]&&(c=!0)}}),s&&s.call(this,l,h,u)||c};Q.__f=!0;var s=Q.shouldComponentUpdate,r=Q.componentWillUpdate;Q.componentWillUpdate=function(l,h,u){if(this.__e){var p=s;s=void 0,o(l,h,u),s=p}r&&r.call(this,l,h,u)},Q.shouldComponentUpdate=o}return i.__N||i.__}function Z(t,e){var n=Ye(De++,3);!ne.__s&&qn(n.__H,e)&&(n.__=t,n.u=e,Q.__H.__h.push(n))}function $e(t,e){var n=Ye(De++,4);!ne.__s&&qn(n.__H,e)&&(n.__=t,n.u=e,Q.__h.push(n))}function he(t){return it=5,ce(function(){return{current:t}},[])}function Wn(t,e,n){it=6,$e(function(){if(typeof t=="function"){var i=t(e());return function(){t(null),i&&typeof i=="function"&&i()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function ce(t,e){var n=Ye(De++,7);return qn(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function le(t,e){return it=8,ce(function(){return t},e)}function ke(t){var e=Q.context[t.__c],n=Ye(De++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(Q)),e.props.value):t.__}function Yn(t,e){ne.useDebugValue&&ne.useDebugValue(e?e(t):t)}function hr(t){var e=Ye(De++,10),n=z();return e.__=t,Q.componentDidCatch||(Q.componentDidCatch=function(i,o){e.__&&e.__(i,o),n[1](i)}),[n[0],function(){n[1](void 0)}]}function Kn(){var t=Ye(De++,11);if(!t.__){for(var e=Q.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function pr(){for(var t;t=$o.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Tt),t.__H.__h.forEach(En),t.__H.__h=[]}catch(e){t.__H.__h=[],ne.__e(e,t.__v)}}ne.__b=function(t){Q=null,vi&&vi(t)},ne.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),xi&&xi(t,e)},ne.__r=function(t){yi&&yi(t),De=0;var e=(Q=t.__c).__H;e&&(dn===Q?(e.__h=[],Q.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(Tt),e.__h.forEach(En),e.__h=[],De=0)),dn=Q},ne.diffed=function(t){bi&&bi(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&($o.push(e)!==1&&fi===ne.requestAnimationFrame||((fi=ne.requestAnimationFrame)||gr)(pr)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),dn=Q=null},ne.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Tt),n.__h=n.__h.filter(function(i){return!i.__||En(i)})}catch(i){e.some(function(o){o.__h&&(o.__h=[])}),e=[],ne.__e(i,n.__v)}}),wi&&wi(t,e)},ne.unmount=function(t){_i&&_i(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{Tt(i)}catch(o){e=o}}),n.__H=void 0,e&&ne.__e(e,n.__v))};var Ci=typeof requestAnimationFrame=="function";function gr(t){var e,n=function(){clearTimeout(i),Ci&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,35);Ci&&(e=requestAnimationFrame(n))}function Tt(t){var e=Q,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),Q=e}function En(t){var e=Q;t.__c=t.__(),Q=e}function qn(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function ko(t,e){return typeof e=="function"?e(t):e}function Eo(t,e){for(var n in e)t[n]=e[n];return t}function Nn(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var i in e)if(i!=="__source"&&t[i]!==e[i])return!0;return!1}function Zn(t,e){var n=e(),i=z({t:{__:n,u:e}}),o=i[0].t,s=i[1];return $e(function(){o.__=n,o.u=e,hn(o)&&s({t:o})},[t,n,e]),Z(function(){return hn(o)&&s({t:o}),t(function(){hn(o)&&s({t:o})})},[t]),n}function hn(t){var e,n,i=t.u,o=t.__;try{var s=i();return!((e=o)===(n=s)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Xn(t){t()}function Jn(t){return t}function Qn(){return[!1,Xn]}var qt=$e;function Ht(t,e){this.props=t,this.context=e}function No(t,e){function n(o){var s=this.props.ref,r=s==o.ref;return!r&&s&&(s.call?s(null):s.current=null),e?!e(this.props,o)||!r:Nn(this.props,o)}function i(o){return this.shouldComponentUpdate=n,ue(t,o)}return i.displayName="Memo("+(t.displayName||t.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i}(Ht.prototype=new we).isPureReactComponent=!0,Ht.prototype.shouldComponentUpdate=function(t,e){return Nn(this.props,t)||Nn(this.state,e)};var Si=H.__b;H.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Si&&Si(t)};var mr=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function $t(t){function e(n){var i=Eo({},n);return delete i.ref,t(i,n.ref||null)}return e.$$typeof=mr,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var $i=function(t,e){return t==null?null:Me(Me(t).map(e))},Po={map:$i,forEach:$i,count:function(t){return t?Me(t).length:0},only:function(t){var e=Me(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:Me},fr=H.__e;H.__e=function(t,e,n,i){if(t.then){for(var o,s=e;s=s.__;)if((o=s.__c)&&o.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),o.__c(t,e)}fr(t,e,n,i)};var ki=H.unmount;function Io(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),t.__c.__H=null),(t=Eo({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(i){return Io(i,e,n)})),t}function Lo(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(i){return Lo(i,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function mt(){this.__u=0,this.o=null,this.__b=null}function Mo(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Do(t){var e,n,i;function o(s){if(e||(e=t()).then(function(r){n=r.default||r},function(r){i=r}),i)throw i;if(!n)throw e;return ue(n,s)}return o.displayName="Lazy",o.__f=!0,o}function et(){this.i=null,this.l=null}H.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),ki&&ki(t)},(mt.prototype=new we).__c=function(t,e){var n=e.__c,i=this;i.o==null&&(i.o=[]),i.o.push(n);var o=Mo(i.__v),s=!1,r=function(){s||(s=!0,n.__R=null,o?o(l):l())};n.__R=r;var l=function(){if(!--i.__u){if(i.state.__a){var h=i.state.__a;i.__v.__k[0]=Lo(h,h.__c.__P,h.__c.__O)}var u;for(i.setState({__a:i.__b=null});u=i.o.pop();)u.forceUpdate()}};i.__u++||32&e.__u||i.setState({__a:i.__b=i.__v.__k[0]}),t.then(r,r)},mt.prototype.componentWillUnmount=function(){this.o=[]},mt.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=Io(this.__b,n,i.__O=i.__P)}this.__b=null}var o=e.__a&&ue(W,null,t.fallback);return o&&(o.__u&=-33),[ue(W,null,e.__a?null:t.children),o]};var Ei=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function vr(t){return this.getChildContext=function(){return t.context},t.children}function yr(t){var e=this,n=t.h;if(e.componentWillUnmount=function(){bt(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),!e.v){for(var i=e.__v;i!==null&&!i.__m&&i.__!==null;)i=i.__;e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:i.__m},contains:function(){return!0},insertBefore:function(o,s){this.childNodes.push(o),e.h.insertBefore(o,s)},removeChild:function(o){this.childNodes.splice(this.childNodes.indexOf(o)>>>1,1),e.h.removeChild(o)}}}bt(ue(vr,{context:e.context},t.__v),e.v)}function Zt(t,e){var n=ue(yr,{__v:t,h:e});return n.containerInfo=e,n}(et.prototype=new we).__a=function(t){var e=this,n=Mo(e.__v),i=e.l.get(t);return i[0]++,function(o){var s=function(){e.props.revealOrder?(i.push(o),Ei(e,t,i)):o()};n?n(s):s()}},et.prototype.render=function(t){this.i=null,this.l=new Map;var e=Me(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},et.prototype.componentDidUpdate=et.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){Ei(t,n,e)})};var To=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,br=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,wr=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,_r=/[A-Z0-9]/g,xr=typeof document<"u",Cr=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function ei(t,e,n){return e.__k==null&&(e.textContent=""),bt(t,e),typeof n=="function"&&n(),t?t.__c:null}function Ao(t,e,n){return So(t,e),typeof n=="function"&&n(),t?t.__c:null}we.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(we.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Ni=H.event;function Sr(){}function $r(){return this.cancelBubble}function kr(){return this.defaultPrevented}H.event=function(t){return Ni&&(t=Ni(t)),t.persist=Sr,t.isPropagationStopped=$r,t.isDefaultPrevented=kr,t.nativeEvent=t};var ti,Er={enumerable:!1,configurable:!0,get:function(){return this.class}},Pi=H.vnode;H.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,i=e.type,o={},s=i.indexOf("-")===-1;for(var r in n){var l=n[r];if(!(r==="value"&&"defaultValue"in n&&l==null||xr&&r==="children"&&i==="noscript"||r==="class"||r==="className")){var h=r.toLowerCase();r==="defaultValue"&&"value"in n&&n.value==null?r="value":r==="download"&&l===!0?l="":h==="translate"&&l==="no"?l=!1:h[0]==="o"&&h[1]==="n"?h==="ondoubleclick"?r="ondblclick":h!=="onchange"||i!=="input"&&i!=="textarea"||Cr(n.type)?h==="onfocus"?r="onfocusin":h==="onblur"?r="onfocusout":wr.test(r)&&(r=h):h=r="oninput":s&&br.test(r)?r=r.replace(_r,"-$&").toLowerCase():l===null&&(l=void 0),h==="oninput"&&o[r=h]&&(r="oninputCapture"),o[r]=l}}i=="select"&&o.multiple&&Array.isArray(o.value)&&(o.value=Me(n.children).forEach(function(u){u.props.selected=o.value.indexOf(u.props.value)!=-1})),i=="select"&&o.defaultValue!=null&&(o.value=Me(n.children).forEach(function(u){u.props.selected=o.multiple?o.defaultValue.indexOf(u.props.value)!=-1:o.defaultValue==u.props.value})),n.class&&!n.className?(o.class=n.class,Object.defineProperty(o,"className",Er)):(n.className&&!n.class||n.class&&n.className)&&(o.class=o.className=n.className),e.props=o}(t),t.$$typeof=To,Pi&&Pi(t)};var Ii=H.__r;H.__r=function(t){Ii&&Ii(t),ti=t.__c};var Li=H.diffed;H.diffed=function(t){Li&&Li(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),ti=null};var Oo={ReactCurrentDispatcher:{current:{readContext:function(t){return ti.__n[t.__c].props.value},useCallback:le,useContext:ke,useDebugValue:Yn,useDeferredValue:Jn,useEffect:Z,useId:Kn,useImperativeHandle:Wn,useInsertionEffect:qt,useLayoutEffect:$e,useMemo:ce,useReducer:Kt,useRef:he,useState:z,useSyncExternalStore:Zn,useTransition:Qn}}},Nr="18.3.1";function zo(t){return ue.bind(null,t)}function Ke(t){return!!t&&t.$$typeof===To}function Ro(t){return Ke(t)&&t.type===W}function Fo(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function Xt(t){return Ke(t)?ur.apply(null,arguments):t}function ni(t){return!!t.__k&&(bt(null,t),!0)}function Uo(t){return t&&(t.base||t.nodeType===1&&t)||null}var jo=function(t,e){return t(e)},Bo=function(t,e){return t(e)},Ho=W,Vo=Ke,oe={useState:z,useId:Kn,useReducer:Kt,useEffect:Z,useLayoutEffect:$e,useInsertionEffect:qt,useTransition:Qn,useDeferredValue:Jn,useSyncExternalStore:Zn,startTransition:Xn,useRef:he,useImperativeHandle:Wn,useMemo:ce,useCallback:le,useContext:ke,useDebugValue:Yn,version:"18.3.1",Children:Po,render:ei,hydrate:Ao,unmountComponentAtNode:ni,createPortal:Zt,createElement:ue,createContext:ze,createFactory:zo,cloneElement:Xt,createRef:vo,Fragment:W,isValidElement:Ke,isElement:Vo,isFragment:Ro,isMemo:Fo,findDOMNode:Uo,Component:we,PureComponent:Ht,memo:No,forwardRef:$t,flushSync:Bo,unstable_batchedUpdates:jo,StrictMode:Ho,Suspense:mt,SuspenseList:et,lazy:Do,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Oo},Pr=Object.freeze({__proto__:null,Children:Po,Component:we,Fragment:W,PureComponent:Ht,StrictMode:Ho,Suspense:mt,SuspenseList:et,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Oo,cloneElement:Xt,createContext:ze,createElement:ue,createFactory:zo,createPortal:Zt,createRef:vo,default:oe,findDOMNode:Uo,flushSync:Bo,forwardRef:$t,hydrate:Ao,isElement:Vo,isFragment:Ro,isMemo:Fo,isValidElement:Ke,lazy:Do,memo:No,render:ei,startTransition:Xn,unmountComponentAtNode:ni,unstable_batchedUpdates:jo,useCallback:le,useContext:ke,useDebugValue:Yn,useDeferredValue:Jn,useEffect:Z,useErrorBoundary:hr,useId:Kn,useImperativeHandle:Wn,useInsertionEffect:qt,useLayoutEffect:$e,useMemo:ce,useReducer:Kt,useRef:he,useState:z,useSyncExternalStore:Zn,useTransition:Qn,version:Nr});function Jt(t){return{render:function(e){ei(e,t)},unmount:function(){ni(t)}}}class je{static instance;refCounts=new Map;styleElements=new Map;static getInstance(){return je.instance||(je.instance=new je),je.instance}addStyle(e,n){const i=(this.refCounts.get(e)||0)+1;if(this.refCounts.set(e,i),this.styleElements.has(e)){this.styleElements.get(e).setAttribute("data-ref-count",i.toString());return}const o=document.createElement("style");o.id=e,o.textContent=n,o.setAttribute("data-ref-count",i.toString()),document.head.appendChild(o),this.styleElements.set(e,o)}removeStyle(e){const n=this.refCounts.get(e)||0;if(n<=1){const i=this.styleElements.get(e);i&&(i.remove(),this.styleElements.delete(e)),this.refCounts.delete(e)}else{const i=n-1;this.refCounts.set(e,i);const o=this.styleElements.get(e);o&&o.setAttribute("data-ref-count",i.toString())}}}const Mi="osetting-styles",Ir=`
   .osetting-item {
       padding: 8px !important;
       margin-bottom: 12px !important;
       transition: box-shadow 0.3s ease !important;
       border-bottom: 1px solid var(--color-base-30) !important;
   }
   
   .osetting-item.no-border {
       border-bottom: none !important;
   }
   
   .osetting-item:last-child {
       border-bottom: none !important;
   }
   
   .osetting-item .setting-item .button-active {
       background-color: var(--interactive-accent) !important;
       color: var(--text-on-accent) !important;
   }
   
   .osetting-item .setting-item .clickable-icon {
       color: var(--text-muted);
       transition: color 0.2s ease;
   }
   
   .osetting-item .setting-item .clickable-icon:hover {
       color: var(--text-normal);
   }
   
   .osetting-item .setting-item input[type='text'],
   .osetting-item .setting-item input[type='number'] {
       background-color: var(--background-secondary);
       border: 1px solid var(--background-modifier-border);
       border-radius: 4px;
       padding: 6px 8px;
       width: 100%;
   }
   
   .osetting-item svg {
       width: 18px;
       height: 18px;
       transition: transform 0.2s ease;
       flex-shrink: 0;
   }
   
   .osetting-item.collapsible {
    margin-bottom: 1em;
    }
    
    .osetting-item.collapsible details {
    border: 1px solid transparent;
    border-radius: 4px;
    padding: 0.5em;
}

.osetting-item.collapsible summary {
    outline: none;
    display: list-item;
    list-style: disclosure-closed;
    align-items: center;
    gap: 0.5em;
}

.osetting-item.collapsible details[open] > summary {
    list-style: disclosure-open;
}

.collapsible-content {
    margin-top: 0.75em;
    padding-left: 1em;
    display: flex;
    flex-direction: column;
    gap: 0.75em;
}


`,ct=({children:t,title:e,onOpen:n,onClose:i,maxHeight:o,maxWidth:s,width:r,height:l,closable:h=!0,className:u})=>{const p=document.body,c=le(m=>{m.key==="Escape"&&h&&i()},[i,h]);Z(()=>(window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)}),[i]),Z(()=>{n&&n()},[n]);const v=ce(()=>{const m={};return r&&(m["--dialog-width"]=r),l&&(m.height=l),s&&(m["--dialog-max-width"]=s),o&&(m["--dialog-max-height"]=o),r&&!s&&(m["--dialog-max-width"]=r),l&&!o&&(m["--dialog-max-height"]=l),m},[r,l,s,o]);return Zt(a("div",{className:"modal-container mod-dim",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",style:v,children:[a("div",{className:"modal-bg",onClick:()=>h&&i(),style:{opacity:"0.85"},"aria-hidden":"true"}),a("div",{className:`modal ${u??""}`,children:[a("div",{className:"modal-close-button",onClick:()=>h&&i(),"aria-label":"Close modal"}),a("div",{className:"modal-header",children:a("div",{className:"modal-title",children:e})}),a("div",{className:"modal-content",style:{position:"relative",zIndex:1e5},children:t})]})]}),p)},Lr=({children:t,disabled:e})=>{const n=he(null),i=t.props,o=i["data-icon"];return $e(()=>{const s=n.current;!s||!o||e||R.setIcon(s,o)},[e,o]),oe.cloneElement(t,{ref:n,disabled:e,tabIndex:e?-1:i.tabIndex||0,style:{...i.style,opacity:e?.6:1,cursor:e?"not-allowed":"default"}})},Mr=({children:t,disabled:e})=>{const n=t.props,i=he(null),o=n.disabled||e,s=n.checked!==void 0,[r,l]=z(n.defaultChecked||!1),h=s?n.checked:r,u=()=>{o||i.current?.click()},p=v=>{o||(s||l(v.target.checked),n.onChange&&n.onChange(v))},c=Object.keys(n).reduce((v,m)=>(m.startsWith("aria-")&&(v[m]=n[m]),v),{});return a("div",{className:`checkbox-container ${h?"is-enabled":""} ${o?"is-disabled":""}`,onPointerDown:u,...c,style:{cursor:o?"not-allowed":"default",opacity:o?.6:1},children:oe.cloneElement(t,{ref:i,tabIndex:o?-1:0,onChange:p,checked:h,disabled:o,style:{pointerEvents:"none"},...Object.keys(c).reduce((v,m)=>(v[m]=void 0,v),{})})})},Dr=({children:t,disabled:e})=>{const n=t.props,i=n.disabled||e;return oe.cloneElement(t,{className:`dropdown ${n.className||""}`.trim(),tabIndex:i?-1:0,disabled:i,style:{...n.style,opacity:i?.6:1,cursor:i?"not-allowed":"pointer"}})},Tr=({children:t,disabled:e})=>{const n=t.props,i=n.disabled||e,o=he(null),[s,r]=z(!1),[l,h]=z(""),[u,p]=z({x:0,y:0}),c=he(null),[v,m]=z(!1),x=()=>{if(o.current){const M=o.current.getBoundingClientRect();p({x:M.left+M.width/2,y:M.top-40})}},C=M=>{c.current&&clearTimeout(c.current),r(!0),v||(c.current=setTimeout(()=>{r(!1),c.current=null},200));const A=M.currentTarget.value;h(A),x(),n.onInput&&n.onInput(M)};Z(()=>{const M=()=>{m(!1),r(!1)};if(v)return document.addEventListener("pointerup",M),document.addEventListener("pointercancel",M),()=>{document.removeEventListener("pointerup",M),document.removeEventListener("pointercancel",M)}},[v]),Z(()=>()=>{c.current&&clearTimeout(c.current)},[]);const P=M=>{c.current&&clearTimeout(c.current),h(M.currentTarget.value),r(!0),x(),n.onMouseEnter&&n.onMouseEnter(M)},S=M=>{v||r(!1),n.onMouseLeave&&n.onMouseLeave(M)},E=()=>{m(!0),s||(h(o.current?.value||""),r(!0),x())};return a(W,{children:[oe.cloneElement(t,{ref:o,className:`slider ${n.className||""}`.trim(),tabIndex:i?-1:0,disabled:i,onInput:C,onPointerDown:E,onMouseEnter:P,onMouseLeave:S,style:{...n.style,opacity:i?.6:1,cursor:i?"not-allowed":"default"}}),s&&Zt(a("div",{className:"tooltip mod-top",style:{position:"fixed",left:u.x,top:u.y,transform:"translateX(-50%)",zIndex:1e3,pointerEvents:"none"},children:[l,a("div",{className:"tooltip-arrow"})]}),document.body)," "]})},Pn=(t,e)=>oe.Children.map(t,n=>{if(oe.isValidElement(n)){const i=n.props,o=i.disabled||e;if(n.type==="input")return i.type==="checkbox"?a(Mr,{disabled:o,children:n}):i.type==="range"?a(Tr,{disabled:o,children:n}):oe.cloneElement(n,{disabled:o,tabIndex:o?-1:i.tabIndex||0,style:{...i.style,opacity:o?.6:1,cursor:o?"not-allowed":"text"}});if(n.type==="button")return a(Lr,{disabled:o,children:n});if(n.type==="select")return a(Dr,{disabled:o,children:n});if(n.type==="textarea")return oe.cloneElement(n,{disabled:o,tabIndex:o?-1:i.tabIndex||0,style:{...i.style,opacity:o?.6:1,cursor:o?"not-allowed":"text"}});if(n.type==="a")return oe.cloneElement(n,{tabIndex:o?-1:i.tabIndex||0,onClick:o?s=>s.preventDefault():i.onClick,style:{...i.style,opacity:o?.6:1,cursor:o?"not-allowed":"pointer",pointerEvents:o?"none":"auto"}});if(i.onClick||i.onMouseDown||i.onMouseUp)return oe.cloneElement(n,{onClick:o?void 0:i.onClick,onMouseDown:o?void 0:i.onMouseDown,onMouseUp:o?void 0:i.onMouseUp,tabIndex:o?-1:i.tabIndex||0,style:{...i.style,opacity:o?.6:1,cursor:o?"not-allowed":i.style?.cursor||"pointer",pointerEvents:o?"none":"auto"},children:i.children?Pn(i.children,o):i.children});if(i.children)return oe.cloneElement(n,{children:Pn(i.children,o)})}return n}),Ar=t=>{const e=document.createDocumentFragment(),n=(typeof t=="string"?t:t.join(`
`)).split(`
`);return n.forEach((i,o)=>{e.append(document.createTextNode(i)),o<n.length-1&&e.append(document.createElement("br"))}),e},O=({name:t,heading:e,desc:n,className:i,noBorder:o,disabled:s,setupObsidianSettingManually:r,children:l})=>{const h=he(null),u=he(null);return $e(()=>{if(window.OSETTING_DISABLE_STYLES!=="true")return je.getInstance().addStyle(Mi,Ir),()=>{je.getInstance().removeStyle(Mi)}},[]),$e(()=>{if(!(!r||!h.current))return u.current?.clear(),u.current=new R.Setting(h.current),t&&u.current.setName(t),e&&u.current.setHeading(),n&&u.current.setDesc(Ar(n)),i&&u.current.setClass(i),r(u.current),s&&u.current.setDisabled(s),()=>{u.current?.clear(),u.current=null}},[r,t,e,n,i]),r?a("div",{className:"osetting-item",children:a("div",{ref:h})}):a("div",{className:`osetting-item ${o?"no-border":""} ${i??""}`,children:a("div",{className:`setting-item ${e?"setting-item-heading":""}`,children:[a("div",{className:"setting-item-info",children:[t&&a("div",{className:"setting-item-name",children:t}),n&&a("div",{className:"setting-item-description",children:typeof n=="string"?n:n.map((p,c)=>a("div",{children:p},c))})]}),a("div",{className:"setting-item-control",children:Pn(l,s)})]})})},Or=({info:t,onClose:e})=>a(ct,{title:"Image properties",onClose:e,width:"500px",maxHeight:"80vh",children:[a(O,{name:"General Information",heading:!0}),a(O,{name:"Name",desc:t.name}),a(O,{name:"Selector",desc:t.selector}),a(O,{name:"Status",desc:t.enabled?"Enabled":"Disabled"}),a(O,{name:"Element type",desc:t.elementType}),a(O,{name:"Dimensions",heading:!0}),a(O,{name:"Width",desc:`${t.dimensions.width}px`}),a(O,{name:"Height",desc:`${t.dimensions.height}px`}),a(O,{name:"Source Location",heading:!0}),a(O,{name:"Start line",desc:t.sourceLocation.lineStart.toString()}),a(O,{name:"End line",desc:t.sourceLocation.lineEnd.toString()}),a(O,{name:"Lines count",desc:t.sourceLocation.linesCount.toString()}),t.panels.length>0&&a(W,{children:[a(O,{name:"Panels",heading:!0}),t.panels.map((n,i)=>a(O,{name:n.name,desc:n.enabled?"\u2713 Enabled":"\u2717 Disabled"},`${i}-${n.name}`))]})]});let zr=class extends R.Component{constructor(e){super(),this.contextMenu=e}showInfo(){const e=this.info;this.modalDiv??=document.createElement("div"),document.body.appendChild(this.modalDiv),this.reactRoot||(this.reactRoot=Jt(this.modalDiv),this.reactRoot.render(a(Or,{info:e,onClose:this.closeModal})))}closeModal=()=>{this.reactRoot?.unmount(),this.reactRoot=void 0,this.modalDiv?.remove(),this.modalDiv=void 0};get info(){const e=this.contextMenu.events.unit,n=e.context.element,i=e.context.size,o=e.context.sourceData,s=e.context.options;return{name:s.name,selector:s.selector,enabled:s.on,dimensions:{width:i.width,height:i.height},sourceLocation:{lineStart:o.lineStart,lineEnd:o.lineEnd,linesCount:o.lineEnd-o.lineStart+1},panels:Object.entries(s.panels).map(([r,l])=>({name:r,enabled:l.on})),elementType:n.tagName.toLowerCase()}}onunload(){super.onunload(),this.closeModal()}},Rr=class extends R.Component{constructor(e){super(),this.contextMenu=e}async openPopupForImage(e){await this.contextMenu.events.unit.plugin.popupMode.showPopupForImage(e)}};class Fr extends R.Component{constructor(e){super(),this.events=e,this.export=new or(this),this.copy=new ir(this),this.info=new zr(this),this.openInPopup=new Rr(this),this.addChild(this.export),this.addChild(this.copy),this.addChild(this.info),this.addChild(this.openInPopup)}initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"contextmenu",n=>{const i=this.events.unit.plugin.settings.$,o=this.events.unit.context.origin;!i.units.contextMenu.showForDiagrams&&o==="generated"||!i.units.contextMenu.showForOtherImages&&o!=="generated"||(n.preventDefault(),n.stopPropagation(),this.onContextMenu(n))},{capture:!0,passive:!1})}onContextMenu=e=>{const{element:n}=this.events.unit.context;this.events.unit.context.content.focus(),this.showMenu(e,n)};showMenu(e,n){this.createMenu(n).showAtMouseEvent(e)}createMenu(e){const n=new R.Menu;return n.addItem(i=>{i.setIcon("download"),i.setTitle("Export as...");const o=i.setSubmenu();o.addItem(s=>{s.setIcon("file-export"),s.setTitle("PNG"),s.onClick(async()=>{await this.export.exportAsPNG(e)})}),o.addItem(s=>{s.setIcon("image"),s.setTitle("JPG"),s.onClick(async()=>{await this.export.exportAsJPG(e)})}),e instanceof SVGElement&&o.addItem(s=>{s.setIcon("file-code"),s.setTitle("SVG"),s.onClick(async()=>{await this.export.exportAsSVG(e)})})}),n.addItem(i=>{i.setIcon("copy"),i.setTitle("Copy as...");const o=i.setSubmenu();o.addItem(s=>{s.setIcon("image"),s.setTitle("PNG"),s.onClick(async()=>{await this.copy.copyAsPNG(e)})}),e instanceof SVGElement&&o.addItem(s=>{s.setIcon("code-2"),s.setTitle("Plain code"),s.onClick(async()=>{await this.copy.copyAsPlain(e)})}),o.addItem(s=>{s.setIcon("file-code"),s.setTitle("Source"),s.onClick(async()=>{await this.copy.copyAsSource()})})}),n.addSeparator(),!(e instanceof SVGElement)&&n.addItem(i=>{i.setIcon("maximize-2"),i.setTitle("Open this image in popup window"),i.onClick(async()=>{await this.openInPopup.openPopupForImage(e)})}),n.addItem(i=>{i.setIcon("info"),i.setTitle("Info"),i.onClick(async()=>{this.info.showInfo()})}),n}}class Ur extends R.Component{constructor(e){super(),this.events=e}initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"focusin",this.focusIn),this.registerDomEvent(e,"focusout",this.focusOut)}focusIn=()=>{this.events.unit.plugin.settings.$.units.folding.autoFoldOnFocusChange&&this.events.unit.controlPanel.fold.unfold(),this.events.unit.controlPanel.show(q.FOCUS)};focusOut=()=>{this.events.unit.plugin.settings.$.units.folding.autoFoldOnFocusChange&&this.events.unit.controlPanel.fold.fold(),this.events.unit.controlPanel.hide(q.FOCUS)}}class jr extends R.Component{constructor(e){super(),this.events=e}initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"keydown",this.keyDown)}keyDown=async e=>{const{code:n,ctrlKey:i,shiftKey:o,altKey:s}=e,r=this.events.unit.actions,l={ArrowUp:()=>r.moveElement(0,50,{animated:!0}),ArrowDown:()=>r.moveElement(0,-50,{animated:!0}),ArrowLeft:()=>r.moveElement(50,0,{animated:!0}),ArrowRight:()=>r.moveElement(-50,0,{animated:!0})},h={Equal:()=>r.zoomElement(1.1,{animated:!0}),Minus:()=>r.zoomElement(.9,{animated:!0}),Digit0:()=>r.resetZoomAndMove({animated:!0}),Backquote:()=>{const{container:c}=this.events.unit.context,v=c.dataset.folded==="true";c.setAttribute("data-folded",v?"false":"true"),this.events.unit.applyLayout(),v?this.events.unit.controlPanel.show(q.FOLD):this.events.unit.controlPanel.hide(q.FOLD)}},u={KeyF:async()=>await r.toggleFullscreen()};let p=null;i&&s&&n in u?p=u[n]:i&&n in h?p=h[n]:!i&&!o&&n in l&&(p=l[n]),p&&(e.preventDefault(),e.stopPropagation(),p())}}class Br extends R.Component{constructor(e){super(),this.events=e}isDragging=!1;initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"wheel",this.wheel),this.registerDomEvent(e,"wheel",this.wheelScroll),this.registerDomEvent(e,"mousedown",this.mouseDown),this.registerDomEvent(e,"mousemove",this.mouseMove),this.registerDomEvent(e,"mouseup",this.mouseUp),this.registerDomEvent(e,"mouseleave",this.mouseLeave),this.registerDomEvent(e,"mouseenter",this.mouseEnter),this.registerDomEvent(e,"dblclick",this.dblclick)}get elements(){const e=this.events.unit.context.container,n=this.events.unit.context.content;return{container:e,content:n}}wheel=e=>{if(!e.ctrlKey&&document.fullscreenElement!==this.events.unit.context.content||e.shiftKey||e.altKey)return;const{content:n,container:i}=this.elements,o=e.clientX,s=e.clientY,r=n.getBoundingClientRect(),l=r.left+r.width/2,h=r.top+r.height/2,u=(o-l)/this.events.unit.scale,p=(s-h)/this.events.unit.scale;e.deltaY<0;const c=this.events.unit.scale;this.events.unit.scale+=e.deltaY*-.001,this.events.unit.scale=Math.max(.125,this.events.unit.scale);const v=this.events.unit.scale-c;this.events.unit.dx-=u*v,this.events.unit.dy-=p*v,n.setCssStyles({transform:`translate(${this.events.unit.dx}px, ${this.events.unit.dy}px) scale(${this.events.unit.scale})`}),e.preventDefault(),e.stopPropagation()};wheelScroll=e=>{if(!(e.shiftKey||e.altKey))return;const n=e.shiftKey&&!e.altKey,i=e.shiftKey&&e.altKey;let o=0,s=0;n&&(o=e.deltaY>0?20:-20),i&&(s=e.deltaY>0?20:-20),this.events.unit.actions.moveElement(o,s,{animated:!0}),e.preventDefault(),e.stopPropagation()};mouseDown=e=>{if(e.button!==0)return;const{container:n,content:i}=this.elements;n.focus({preventScroll:!0}),this.isDragging=!0,this.startX=e.clientX,this.startY=e.clientY,this.initialX=this.events.unit.dx,this.initialY=this.events.unit.dy,i.setCssStyles({cursor:"grabbing"}),e.preventDefault(),e.stopPropagation()};mouseMove=e=>{if(!this.isDragging)return;const{content:n}=this.elements,i=e.clientX-this.startX,o=e.clientY-this.startY;this.events.unit.dx=this.initialX+i,this.events.unit.dy=this.initialY+o,n.setCssStyles({transform:`translate(${this.events.unit.dx}px, ${this.events.unit.dy}px) scale(${this.events.unit.scale})`}),e.preventDefault(),e.stopPropagation()};mouseUp=e=>{const{content:n}=this.elements;this.isDragging=!1,n.setCssStyles({cursor:"grab"}),e.preventDefault(),e.stopPropagation()};mouseLeave=e=>{this.mouseUp(e),this.events.unit.controlPanel.hide(q.MOUSE),e.preventDefault(),e.stopPropagation()};mouseEnter=e=>{this.events.unit.controlPanel.show(q.MOUSE),e.preventDefault(),e.stopPropagation()};dblclick=e=>{e.target.closest(".izd-control-panel")||(this.events.unit.actions.resetZoomAndMove({animated:!0}),e.stopPropagation(),e.preventDefault())}}class Hr extends R.Component{constructor(e){super(),this.events=e}isDragging=!1;isPinching=!1;tapTimeout=null;initialize(){this.load();const{container:e}=this.events.unit.context;this.registerDomEvent(e,"touchstart",this.touchStart,{passive:!1}),this.registerDomEvent(e,"touchmove",this.touchMove,{passive:!1}),this.registerDomEvent(e,"touchend",this.touchEnd,{passive:!1})}touchStart=e=>{this.events.unit.plugin.integratedMode.context.nativeTouchEventsEnabled||e.target.closest(".izd-panel")||(e.preventDefault(),e.stopPropagation(),e.touches.length===1?(this.isDragging=!0,this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY,this.tapTimeout?(clearTimeout(this.tapTimeout),this.tapTimeout=null,this.events.unit.actions.resetZoomAndMove({animated:!0})):this.tapTimeout=setTimeout(()=>{this.tapTimeout=null},300)):e.touches.length===2&&(this.isDragging=!1,this.isPinching=!0,this.initialDistance=this.calculateDistance(e.touches),this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null)))};touchMove=e=>{if(!(this.events.unit.plugin.integratedMode.context.nativeTouchEventsEnabled||(e.preventDefault(),e.stopPropagation(),!this.events.unit.context.content))){if(this.isDragging&&e.touches.length===1){const n=e.touches[0].clientX-this.startX,i=e.touches[0].clientY-this.startY;this.events.unit.actions.moveElement(n,i),this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY}else if(this.isPinching&&e.touches.length===2){const n=this.calculateDistance(e.touches),i=n/this.initialDistance;this.events.unit.actions.zoomElement(i),this.initialDistance=n}}};touchEnd=e=>{this.events.unit.plugin.integratedMode.context.nativeTouchEventsEnabled||(this.events.unit.context.container,e.target.closest(".izd-panel")||(e.preventDefault(),e.stopPropagation(),this.isDragging=!1,this.isPinching=!1,this.initialDistance=0))};calculateDistance(e){const[n,i]=[e[0],e[1]],o=i.clientX-n.clientX,s=i.clientY-n.clientY;return Math.sqrt(o*o+s*s)}}let Vr=class extends R.Component{constructor(e){super(),this.unit=e,this.mouse=new Br(this),this.touch=new Hr(this),this.keyboard=new jr(this),this.focus=new Ur(this),this.contextMenu=new Fr(this),this.addChild(this.mouse),this.addChild(this.touch),this.addChild(this.keyboard),this.addChild(this.focus),this.addChild(this.contextMenu)}initialize(){this.load(),this.mouse.initialize(),this.touch.initialize(),this.keyboard.initialize(),this.focus.initialize(),this.contextMenu.initialize()}};var Se=(t=>(t.LivePreview="live-preview",t.Preview="preview",t.PickerMode="picker-mode",t))(Se||{});let Gr=class extends R.Component{constructor(e){super(),this.unit=e,this.load()}async initialize(){this.unit.plugin.emitter.on("toggle-integrated-element",this.onToggleElement),await this.scheduleActivationIfNeeded()}async scheduleActivationIfNeeded(){if(this.unit.context.adapter===Se.PickerMode){await this.activate();return}this.unit.plugin.settings.$.units.interactivity.markdown.autoDetect&&await this.activate(!0)}onToggleElement=async e=>{e.element===this.unit.context.element&&(this.unit.active?await this.deactivate():await this.activate())};activate=async e=>{this.unit.active||(this.unit.context.element.setAttribute("data-interactive-mode",jt.Interactive),e?(await this.switchToInteractive(),this.unit.initialize()):await this.smoothTransition(this.unit.context.originalParent,async()=>{await this.switchToInteractive(),this.unit.initialize()}),this.unit.context.originalParent.style.removeProperty("transition"),this.unit.context.originalParent.style.removeProperty("transform"))};deactivate=async()=>{this.unit.active&&(this.unit.context.element.setAttribute("data-interactive-mode",jt.NonInteractive),await this.smoothTransition(this.unit.context.originalParent,async()=>{this.unit.unload(),this.unit.controlPanel.controlPanel?.remove(),await this.switchToNonInteractive()}),this.unit.context.originalParent.style.removeProperty("transition"),this.unit.context.originalParent.style.removeProperty("transform"))};async smoothTransition(e,n){return await e.animate([{opacity:"1",transform:"scale(1)",filter:"blur(0)"},{opacity:"0",transform:"scale(0.96)",filter:"blur(1px)"}],{duration:150,fill:"forwards"}).finished,await n(),e.animate([{opacity:"0",transform:"scale(0.96)",filter:"blur(1px)"},{opacity:"1",transform:"scale(1)",filter:"blur(0)"}],{duration:200,easing:"ease-out",fill:"forwards"}).finished}async switchToInteractive(){this.unit.active=!0,this.unit.plugin.logger.debug(`Switch unit with id ${this.unit.id} to interactive state`,{functionName:"switchToInteractive",lineNumber:116,columnNumber:3592,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit-state-manager.ts"});const{content:e,container:n,element:i,originalParent:o}=this.unit.context;if(this.unit.context.content.setCssStyles({transform:`translate(${this.unit.dx}px, ${this.unit.dy}px) scale(${this.unit.scale})`}),this.unit.context.element instanceof SVGElement){const s=o.className.trim();s&&e.addClasses(s.split(/\s+/)),e.removeClass("live-preview-parent"),o.className=""}this.unit.context.adapter===Se.LivePreview&&this.unit.context.livePreviewWidget?.addClass("live-preview-parent"),this.unit.context.livePreviewWidget&&this.unit.registerDomEvent(this.unit.context.livePreviewWidget,"click",s=>{s.target instanceof Element&&(s.target.closest(".izd-control-panel")||!this.unit.context.container.contains(s.target)||(s.preventDefault(),s.stopPropagation()))},!0),o.contains(i)?o.replaceChild(n,i):this.unit.plugin.logger.warn("Error with replace child. It seems that active leaf was changed?",{functionName:"switchToInteractive",lineNumber:161,columnNumber:5552,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit-state-manager.ts"}),n.appendChild(e),e.appendChild(i),await this.waitForElementsLayout([i,e,n])}async switchToNonInteractive(){this.unit.active=!1,this.unit.plugin.logger.debug(`Switch unit with id ${this.unit.id} to non-interactive state`,{functionName:"switchToNonInteractive",lineNumber:175,columnNumber:6206,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit-state-manager.ts"});const{content:e,container:n,element:i,originalParent:o}=this.unit.context;if(this.unit.context.element instanceof SVGElement&&(o.className=e.className,o.removeClass("izd-content")),this.unit.context.adapter===Se.LivePreview){const s=this.unit.context.livePreviewWidget;s?.removeClass("live-preview-parent"),s?.style?.removeProperty("height"),s?.style?.removeProperty("width")}o.contains(n)?o.replaceChild(i,n):this.unit.plugin.logger.warn("Error with replace child. It seems that active leaf was changed?",{functionName:"switchToNonInteractive",lineNumber:194,columnNumber:7185,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit-state-manager.ts"}),n.remove(),e.remove(),await new Promise(s=>requestAnimationFrame(s))}waitForElementsLayout(e){return new Promise(n=>{const i=()=>{if(!this._loaded){n();return}if(!e.every(s=>{const r=s.getBoundingClientRect();return r.width>0&&r.height>0})){requestAnimationFrame(i);return}const o=e[0].getBoundingClientRect();this.unit.context.size.width===0&&(this.unit.context.size.width=o.width),this.unit.context.size.height===0&&(this.unit.context.size.height=o.height),n()};requestAnimationFrame(i)})}onunload(){super.onunload(),this.unit.plugin.emitter.off("toggle-integrated-element",this.onToggleElement),this.unit.context.element.removeAttribute("data-interactive-initialization-status"),this.unit.context.element.removeAttribute("data-interactive-mode")}},Wr=class extends R.Component{dx=0;dy=0;scale=1;active=!1;constructor(e,n,i){super(),this.id=crypto.randomUUID(),this.plugin=e,this.context=n,this.fileStats=i,this.interactiveStateManager=new Gr(this),this.actions=new Xs(this),this.controlPanel=new Qe(this),this.events=new Vr(this),this.addChild(this.events),this.addChild(this.controlPanel)}async setup(){await this.interactiveStateManager.initialize()}initialize(){this.plugin.logger.debug(`Initialize unit with id ${this.id}`,{functionName:"initialize",lineNumber:46,columnNumber:1401,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit.ts"}),this.load(),this.setupEvents(),this.events.initialize(),this.controlPanel.initialize(),this.applyLayout(),this.plugin.logger.debug("Unit initialized successfully",{id:this.id,functionName:"initialize",lineNumber:56,columnNumber:1777,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit.ts"})}get realSize(){const e=()=>{const l=this.context.size,h=this.plugin.integratedMode.context.getAvailableSize(),u=h.width===0||h.height===0,p=u?l.width:Math.min(l.width,h.width),c=u?l.height:Math.min(l.height,h.height);return{width:p,height:c}},n=this.plugin.settings.$.units.size,i=this.context.container.dataset.folded==="true"?n.folded:n.expanded,o=e(),s=i.width.type==="%"?i.width.value/100*o.width:i.width.value,r=i.height.type==="%"?i.height.value/100*o.height:i.height.value;return{width:s,height:r}}applyLayout(){this.applyRealSize(),this.actions.fitToContainer({animated:!1})}applyRealSize(){const e=this.realSize;if(this.context.container.style.height=`${e.height}px`,this.context.container.style.width=`${e.width}px`,this.plugin.integratedMode.context.inLivePreviewMode){const n=this.context.livePreviewWidget;if(!n){this.plugin.logger.error("No parent found in live-preview mode",{functionName:"applyRealSize",lineNumber:117,columnNumber:3991,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit.ts"});return}n.style.setProperty("height",`${e.height}px`,"important"),n.style.setProperty("width",`${e.width}px`,"important")}}async onDelete(){await this.interactiveStateManager.deactivate(),this.interactiveStateManager.unload()}onunload(){super.onunload(),this.plugin.logger.debug(`Called unload for interactive element with id ${this.id}`,{functionName:"onunload",lineNumber:143,columnNumber:4810,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit.ts"})}setupEvents(){const e=R.debounce(this.applyLayout.bind(this),300,!0);this.plugin.emitter.on(this.plugin.settings.$$.units.size.$all,e),this.register(()=>this.plugin.emitter.off(this.plugin.settings.$$.units.size.$all,e)),this.plugin.emitter.on("leaf-layout-changed",e),this.register(()=>this.plugin.emitter.off("leaf-layout-changed",e))}},Yr=class{static async createUnit(e,n,i){e.logger.debug("Creating unit...",{functionName:"createUnit",lineNumber:11,columnNumber:353,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit-factory.ts"});const o=new Wr(e,n,i);return await o.setup(),e.logger.debug("Unit was created and initialized successfully.",{functionName:"createUnit",lineNumber:16,columnNumber:657,fileName:"src/modes/integrated-mode/integrated-unit/integrated-unit-factory.ts"}),o}},Kr=class{constructor(e,n){this.integratedMode=e,this.fileStat=n}matchInteractiveElement(e){const n=e,i=this.integratedMode.plugin.settings.$.units.configs,o=i.filter(r=>![Le.IMG_SVG,Le.Default].includes(r.selector)),s=i.filter(r=>[Le.IMG_SVG,Le.Default].includes(r.selector));for(const r of[...o,...s])if(r.on&&(e.matches(r.selector)||e.closest(r.selector)))return{element:n,options:JSON.parse(JSON.stringify(r))}}initializationGuard(e){if(e.element.dataset.interactiveInitializationStatus!==void 0)return!1;let n=!0;return e.adapter===Se.LivePreview&&e.element.cmView?n=!1:[Se.Preview,Se.PickerMode].includes(e.adapter)&&(n=!0),e.element.setAttribute("data-interactive-initialization-status",n?vt.Initialized:vt.NotInitialized),n}detectDiagramLayout(e,n){const i=e/n;return i>1.5?"wide":i<.67?"tall":"proportional"}getElSize(e){const n=e.element.getBoundingClientRect();return{width:n.width,height:n.height}}async createUnit(e){const n=await Yr.createUnit(this.integratedMode.plugin,e,this.fileStat);this.emitCreated(n)}emitCreated(e){this.integratedMode.plugin.emitter.emit("unit.created",e)}finalizeContext(e){if(!e.element||!e.sourceData||!e.size||!e.container||!e.content||!e.options)throw new Error("Incomplete context");return e}async createInteractiveElementWrapper(e){const n=document.createElement("div"),i=document.createElement("div");n.addClass("izd-container"),i.addClass("izd-content");const o=e.element.parentElement,s=this.integratedMode.plugin.integratedMode.context.inPreviewMode?"preview":"live-preview";return n.setAttribute("data-izd-rendering-mode",`${s}`),n.setAttribute("data-folded",this.integratedMode.plugin.settings.$.units.folding.foldByDefault.toString()),n.setAttribute("tabindex","0"),{container:n,content:i,originalParent:o}}findElementWithLivePreviewWidget(e){if(e===void 0)return;let n=e;for(;n&&n!==document.body;){if(n?.cmView)return n;n=n?.parentElement}}async unitProcessing(e,n){if(n.adapter=e,this.integratedMode.plugin.logger.debug(`Processing unit for adapter: ${e}`,{unitType:n.options.name,functionName:"unitProcessing",lineNumber:194,columnNumber:5879,fileName:"src/modes/integrated-mode/adapters/base-adapter.ts"}),!this.initializationGuard(n)){this.integratedMode.plugin.logger.debug(`Initialization guard failed for adapter: ${e}`,{functionName:"unitProcessing",lineNumber:205,columnNumber:6353,fileName:"src/modes/integrated-mode/adapters/base-adapter.ts"});return}if(n.mode==="live-preview"){const u=this.findElementWithLivePreviewWidget(n.element);u&&(n.livePreviewWidget=u)}const i=this.getElSize(n),o=this.detectDiagramLayout(i.width,i.height),{container:s,content:r,originalParent:l}=await this.createInteractiveElementWrapper(n);n.container=s,n.content=r,n.originalParent=l,n.size=i,n.layout=o;const h=this.finalizeContext(n);await this.createUnit(h),this.integratedMode.plugin.logger.debug(`Adapter ${e} was processed successfully.`,{functionName:"unitProcessing",lineNumber:234,columnNumber:7490,fileName:"src/modes/integrated-mode/adapters/base-adapter.ts"})}};class It extends Kr{constructor(e,n){super(e,n),this.integratedMode=e,this.fileStat=n}initialize=async e=>{const n=this.matchInteractiveElement(e.element);if(!n)return;const i={...n,...e},o=e.mode==="live-preview"?Se.LivePreview:Se.Preview;await this.unitProcessing(o,i)}}let qr=class{constructor(e){this.integratedMode=e}data=new Map;orphans={units:[]};initializeLeaf(e){this.data.get(e)||(this.data.set(e,{resizeObserver:void 0,units:[],nativeTouchEventsEnabled:!0}),this.integratedMode.plugin.logger.debug(`Initialized data for leaf width id: ${e}...`,{functionName:"initializeLeaf",lineNumber:31,columnNumber:997,fileName:"src/modes/integrated-mode/state.ts"}))}async cleanupLeaf(e){const n=this.data.get(e);if(!n){this.integratedMode.plugin.logger.error("No data for leaf",{leafID:e,functionName:"cleanupLeaf",lineNumber:39,columnNumber:1394,fileName:"src/modes/integrated-mode/state.ts"});return}for(const i of n.units)await i.onDelete(),this.integratedMode.plugin.logger.debug("Unloaded unit",{unitName:i.context.options.name,functionName:"cleanupLeaf",lineNumber:47,columnNumber:1760,fileName:"src/modes/integrated-mode/state.ts"});this.data.delete(e),this.integratedMode.plugin.logger.debug(`Data for leaf with id ${e} was cleaned successfully.`,{functionName:"cleanupLeaf",lineNumber:53,columnNumber:2090,fileName:"src/modes/integrated-mode/state.ts"})}async clear(){this.integratedMode.plugin.logger.debug("Started to clear state...",{functionName:"clear",lineNumber:58,columnNumber:2387,fileName:"src/modes/integrated-mode/state.ts"});for(const e of this.data.keys())await this.cleanupLeaf(e);await this.cleanOrphan(),this.integratedMode.plugin.logger.debug("State was cleared successfully.",{functionName:"clear",lineNumber:65,columnNumber:2722,fileName:"src/modes/integrated-mode/state.ts"})}getResizeObserver(e){return this.data.get(e)?.resizeObserver}setResizeObserver(e,n){const i=this.data.get(e);i&&(i.resizeObserver=n)}hasResizeObserver(e){return!!this.getResizeObserver(e)}getUnits(e){return this.data.get(e)?.units??[]}pushUnit(e,n){const i=this.data.get(e);if(!i){this.integratedMode.plugin.logger.error(`No data for leafID: ${e}`,{functionName:"pushUnit",lineNumber:90,columnNumber:3613,fileName:"src/modes/integrated-mode/state.ts"});return}i.units.push(n)}pushOrphanUnit(e){this.orphans.units.push(e)}async cleanOrphan(){for(const e of this.orphans.units)await e.onDelete()}async cleanupUnitsOnFileChange(e,n){const i=this.data.get(e);if(!i){this.integratedMode.plugin.logger.error(`No data for leafID: ${e}`,{functionName:"cleanupUnitsOnFileChange",lineNumber:113,columnNumber:4338,fileName:"src/modes/integrated-mode/state.ts"});return}const o=n.ctime,s=[];for(const r of i.units)r.context.adapter===Se.PickerMode||o!==r.fileStats.ctime?(await r.onDelete(),this.integratedMode.plugin.logger.debug(`Cleaned up unit with id ${r.id} due to file change`,{functionName:"cleanupUnitsOnFileChange",lineNumber:127,columnNumber:4957,fileName:"src/modes/integrated-mode/state.ts"})):s.push(r);i.units=s}},Zr=class extends R.Component{constructor(e){super(),this.plugin=e,this.context=new Zs(this),this.state=new qr(this)}initialize(){this.load(),this.setupCommands(),this.setupFileMenu(),this.setupInternalEventHandlers(),this.setupObsidianEventHandlers(),this.setupDomSubscriptions()}async onunload(){await this.state.clear()}setupCommands(){this.plugin.addCommand({id:"toggle-panels-state",name:"Toggle control panels visibility for all the active interactive images in current note",checkCallback:e=>{const n=this.state.getUnits(this.context.leafID);if(e)return(this.context.inLivePreviewMode||this.context.inPreviewMode)&&this.context.active&&n.some(r=>r.active);if(!this.context.active){this.plugin.showNotice(f("d"));return}if(!n.some(r=>r.active)){this.plugin.showNotice(f("c"));return}const i=n.filter(r=>r.active),o=i.some(r=>r.controlPanel.hasVisiblePanels);i.forEach(r=>o?r.controlPanel.hide(q.FORCE):r.controlPanel.show(q.FORCE));const s=f(o?"b":"e");return this.plugin.showNotice(s),this.plugin.logger.debug("Called command `toggle-panels-management-state`",{functionName:"anonymous",lineNumber:80,columnNumber:2800,fileName:"src/modes/integrated-mode/integrated-mode.ts"}),!0}})}setupFileMenu(){this.registerEvent(this.plugin.app.workspace.on("file-menu",e=>{if(!(this.context.inPreviewMode||this.context.inLivePreviewMode))return;const n=this.state.data.get(this.context.leafID)?.nativeTouchEventsEnabled;n!==void 0&&e.addItem(i=>{i.setIcon(n?"hand":"circle-slash-2"),i.setTitle(`Native touch: ${n?"ON":"OFF"}`),i.onClick(()=>{const o=this.state.data.get(this.context.leafID);o.nativeTouchEventsEnabled=!o.nativeTouchEventsEnabled})})}))}setupInternalEventHandlers(){this.plugin.emitter.on("unit.created",e=>{const n=this.context.leafID;if(!n){this.plugin.logger.warn("No active leaf found.",{functionName:"anonymous",lineNumber:125,columnNumber:4521,fileName:"src/modes/integrated-mode/integrated-mode.ts"}),this.state.pushOrphanUnit(e),this.plugin.logger.debug(`'orphan unit with id ${e.id} was added to state'`,{functionName:"anonymous",lineNumber:127,columnNumber:4769,fileName:"src/modes/integrated-mode/integrated-mode.ts"});return}this.state.pushUnit(n,e),this.plugin.logger.debug("Unit added to state",{leafID:n,unitName:e.context.options.name,functionName:"anonymous",lineNumber:132,columnNumber:5121,fileName:"src/modes/integrated-mode/integrated-mode.ts"})}),this.plugin.emitter.on("create-integrated-element",async e=>{const n=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView),i=this.plugin.leafIndex.data.get(n?.leaf.id)?.imageIndex.get(e);i&&await new It(this,n.file.stat).initialize(i)}),this.plugin.emitter.on("create-integrated-element-outside-view",async e=>{await new It(this,{ctime:0,size:0,mtime:0}).initialize(e)}),this.plugin.emitter.on("leaf-index.image.added",async e=>{if(this.plugin.help.isHelpOpen)return;const n=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView);if(!n){this.plugin.logger.warn("No active Markdown view found for image data",{...e,functionName:"anonymous",lineNumber:175,columnNumber:6661,fileName:"src/modes/integrated-mode/integrated-mode.ts"});return}const i=new It(this,n.file.stat);this.plugin.settings.$.units.interactivity.markdown.autoDetect&&await i.initialize(e)})}setupObsidianEventHandlers(){const e=async n=>{this.context.cleanup(i=>this.state.cleanupLeaf(i)),this.context.initialize(i=>{this.state.initializeLeaf(i),this.setupResizeObserver(i)}),this.context.active&&n==="layout-change"&&(await this.state.cleanupUnitsOnFileChange(this.context.leafID,this.context.view.file.stat),await this.state.cleanOrphan())};this.plugin.registerEvent(this.plugin.app.workspace.on("layout-change",async()=>{this.plugin.logger.debug("Calling withing the layout-change-event...",{functionName:"anonymous",lineNumber:216,columnNumber:8192,fileName:"src/modes/integrated-mode/integrated-mode.ts"}),await e("layout-change");const n=this.context.leafID;if(!n)return;const i=this.plugin.leafIndex.data.get(n);if(!i)return;const o=this.context.inPreviewMode?"preview":this.context.inLivePreviewMode?"live-preview":void 0;if(!o)return;const s=new It(this,this.context.view?.file?.stat),r=i.imageIndex.values().filter(l=>l.mode===o);for(const l of r)await s.initialize(l)})),this.plugin.registerEvent(this.plugin.app.workspace.on("active-leaf-change",async()=>{this.plugin.logger.debug("Called withing the active-leaf-change event...",{functionName:"anonymous",lineNumber:254,columnNumber:9630,fileName:"src/modes/integrated-mode/integrated-mode.ts"}),await e("active-leaf-change")}))}setupResizeObserver(e){if(this.state.hasResizeObserver(e))return;const n=R.debounce(()=>{this.state.getUnits(e).forEach(o=>o.applyLayout())},50,!0),i=new ResizeObserver((o,s)=>{n()});i.observe(this.context.view?.contentEl),this.state.setResizeObserver(e,i)}setupDomSubscriptions(){this.plugin.domWatcher.subscribe(e=>e.type==="attributes"&&e.target instanceof Element&&(e.target.hasClass("markdown-source-view")||e.target.hasClass("markdown-preview-view"))&&e.attributeName==="class"&&(!!e.oldValue?.contains("is-readable-line-width")||e.target.hasClass("is-readable-line-width"))&&this.context.active&&this.context.leaf.containerEl.contains(e.target),e=>{this.plugin.emitter.emit("leaf-layout-changed")})}},Xr=class extends R.Component{constructor(e){super(),this.plugin=e}isActive=!1;tooltip=null;currentElement=null;initialize(){this.load(),this.setupEvents(),this.setupCommands(),this.plugin.settings.$.units.interactivity.picker.enabled&&this.createRibbon()}pickerModeToggleHandler=e=>{e.newValue?this.createRibbon():(this.ribbonButton.removeEventListener("click",this.toggle),this.ribbonButton.remove())};setupEvents(){const e=this.plugin.settings.$$;this.plugin.emitter.on(e.units.interactivity.picker.enabled.$path,this.pickerModeToggleHandler)}setupCommands(){this.plugin.addCommand({id:"toggle-picker-mode",name:"Toggle picker mode",checkCallback:e=>{if(e)return this.plugin.settings.$.units.interactivity.picker.enabled;if(!this.plugin.settings.$.units.interactivity.picker.enabled){this.plugin.showNotice(f("a"));return}return this.toggle(),!0}})}createRibbon(){this.ribbonButton=this.plugin.addRibbonIcon("mouse-pointer-click","Picker mode",this.toggle)}toggle=e=>{this.isActive?this.deactivate():this.activate()};createTooltip(){this.tooltip=document.createElement("div"),this.tooltip.addClass("picker-mode-tooltip"),document.body.appendChild(this.tooltip)}showTooltip(e){if(!this.tooltip)return;const n=e.matches("svg,img")?e:e.querySelector("svg,img");if(!n)return;if(!hi(n)){this.tooltip.textContent="Alt+Click to open popup",this.tooltip.style.opacity="1";return}const i=n.getAttribute("data-interactive-initialization-status"),o=n.getAttribute("data-interactive-mode");let s="Make interactive";i===vt.NotInitialized?s=f("C"):s=(o===jt.Interactive?"on":"off")=="on"?f("E"):f("D"),this.tooltip.textContent=s,this.tooltip.style.opacity="1"}hideTooltip(){this.tooltip&&(this.tooltip.style.opacity="0"),this.currentElement=null}activate(){this.isActive=!0,document.body.addClass("picker-mode"),this.createTooltip(),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseover",this.onMouseOver),document.addEventListener("mouseout",this.onMouseOut),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("mousedown",this.onMouseDown,!0),document.querySelectorAll("svg, img").forEach(e=>{if(Ut(e))return;const n=e.getBoundingClientRect();n.width>=64&&n.height>=64&&e.addClass("interactive-candidate")}),this.plugin.showNotice(f("G"),1e4)}deactivate(){this.isActive&&(this.isActive=!1,document.body.removeClass("picker-mode"),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseover",this.onMouseOver),document.removeEventListener("mouseout",this.onMouseOut),document.removeEventListener("mousedown",this.onMouseDown,!0),document.removeEventListener("keydown",this.onKeyDown),document.querySelectorAll("svg, img").forEach(e=>{e.removeClass("interactive-candidate")}),this.tooltip?.remove(),this.tooltip=null,this.currentElement=null,this.plugin.showNotice(f("F"),1e4))}onMouseMove=e=>{this.tooltip&&(this.tooltip.style.left=`${e.clientX+12}px`,this.tooltip.style.top=`${e.clientY-32}px`)};onMouseOver=e=>{const n=e.target,i=n.closest(".cm-preview-code-block")||n.closest("svg,img,.izd-container");if(!i)return;const o=i.getBoundingClientRect();if(!(o.width>=64&&o.height>=64)){this.hideTooltip();return}this.currentElement=i,this.showTooltip(i)};onMouseOut=e=>{const n=e.target;(n.closest(".cm-preview-code-block")||n.closest("svg,img,.izd-container"))===this.currentElement&&this.hideTooltip()};onKeyDown=e=>{e.key==="Escape"&&this.isActive&&this.deactivate()};onMouseDown=async e=>{if(!(e.target instanceof Element))return;e.stopPropagation(),e.preventDefault();let n=e.target.closest(".cm-preview-code-block")||e.target.closest("svg,img,.izd-container");if(!n){this.deactivate();return}n=n?.matches("svg,img")?n:n?.querySelector("svg,img");const i=n;if(e.altKey){if(n instanceof SVGElement){this.plugin.showNotice("SVG support coming soon! Stay tuned!");return}await this.plugin.popupMode.showPopup(i),this.deactivate();return}if(hi(i)){if(i.dataset.interactiveInitializationStatus===vt.Initialized){this.plugin.emitter.emit("toggle-integrated-element",{element:n}),this.showTooltip(i);return}this.plugin.emitter.emit("create-integrated-element",i),this.showTooltip(i)}};onunload(){this.deactivate(),super.onunload(),this.plugin.emitter.off(this.plugin.settings.$$.units.interactivity.picker.enabled.$path,this.pickerModeToggleHandler)}};const Go=ze(void 0),Jr=({popupMode:t,initialImages:e,onClose:n,children:i})=>{const[o,s]=z(e),[r,l]=z(0),h=ce(()=>({popupMode:t,onClose:n,images:o,setImages:s,activeImageIndex:r,setActiveImageIndex:l}),[t,n,o,s,r,l]);return a(Go.Provider,{value:h,children:i})},kt=()=>{const t=ke(Go);if(t===void 0)throw new Error("usePopupContext must be used within a PopupProvider");return t};var ve=function(){return ve=Object.assign||function(e){for(var n,i=1,o=arguments.length;i<o;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ve.apply(this,arguments)};function wt(t,e,n){if(n||arguments.length===2)for(var i=0,o=e.length,s;i<o;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function Qr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ea(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function i(){var o=!1;try{o=this instanceof i}catch{}return o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:function(){return t[i]}})}),n}var te="-ms-",ft="-moz-",J="-webkit-",Wo="comm",Qt="rule",ii="decl",ta="@import",Yo="@keyframes",na="@layer",Ko=Math.abs,oi=String.fromCharCode,In=Object.assign;function ia(t,e){return de(t,0)^45?(((e<<2^de(t,0))<<2^de(t,1))<<2^de(t,2))<<2^de(t,3):0}function qo(t){return t.trim()}function Ie(t,e){return(t=e.exec(t))?t[0]:t}function V(t,e,n){return t.replace(e,n)}function At(t,e,n){return t.indexOf(e,n)}function de(t,e){return t.charCodeAt(e)|0}function ot(t,e,n){return t.slice(e,n)}function xe(t){return t.length}function Zo(t){return t.length}function pt(t,e){return e.push(t),t}function oa(t,e){return t.map(e).join("")}function Di(t,e){return t.filter(function(n){return!Ie(n,e)})}var en=1,st=1,Xo=0,be=0,ae=0,ut="";function tn(t,e,n,i,o,s,r,l){return{value:t,root:e,parent:n,type:i,props:o,children:s,line:en,column:st,length:r,return:"",siblings:l}}function Ae(t,e){return In(tn("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function Xe(t){for(;t.root;)t=Ae(t.root,{children:[t]});pt(t,t.siblings)}function sa(){return ae}function ra(){return ae=be>0?de(ut,--be):0,st--,ae===10&&(st=1,en--),ae}function _e(){return ae=be<Xo?de(ut,be++):0,st++,ae===10&&(st=1,en++),ae}function Ve(){return de(ut,be)}function Ot(){return be}function nn(t,e){return ot(ut,t,e)}function Ln(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function aa(t){return en=st=1,Xo=xe(ut=t),be=0,[]}function la(t){return ut="",t}function pn(t){return qo(nn(be-1,Mn(t===91?t+2:t===40?t+1:t)))}function ca(t){for(;(ae=Ve())&&ae<33;)_e();return Ln(t)>2||Ln(ae)>3?"":" "}function ua(t,e){for(;--e&&_e()&&!(ae<48||ae>102||ae>57&&ae<65||ae>70&&ae<97););return nn(t,Ot()+(e<6&&Ve()==32&&_e()==32))}function Mn(t){for(;_e();)switch(ae){case t:return be;case 34:case 39:t!==34&&t!==39&&Mn(ae);break;case 40:t===41&&Mn(t);break;case 92:_e();break}return be}function da(t,e){for(;_e()&&t+ae!==57&&!(t+ae===84&&Ve()===47););return"/*"+nn(e,be-1)+"*"+oi(t===47?t:_e())}function ha(t){for(;!Ln(Ve());)_e();return nn(t,be)}function pa(t){return la(zt("",null,null,null,[""],t=aa(t),0,[0],t))}function zt(t,e,n,i,o,s,r,l,h){for(var u=0,p=0,c=r,v=0,m=0,x=0,C=1,P=1,S=1,E=0,M="",A=o,L=s,D=i,T=M;P;)switch(x=E,E=_e()){case 40:if(x!=108&&de(T,c-1)==58){At(T+=V(pn(E),"&","&\f"),"&\f",Ko(u?l[u-1]:0))!=-1&&(S=-1);break}case 34:case 39:case 91:T+=pn(E);break;case 9:case 10:case 13:case 32:T+=ca(x);break;case 92:T+=ua(Ot()-1,7);continue;case 47:switch(Ve()){case 42:case 47:pt(ga(da(_e(),Ot()),e,n,h),h);break;default:T+="/"}break;case 123*C:l[u++]=xe(T)*S;case 125*C:case 59:case 0:switch(E){case 0:case 125:P=0;case 59+p:S==-1&&(T=V(T,/\f/g,"")),m>0&&xe(T)-c&&pt(m>32?Ai(T+";",i,n,c-1,h):Ai(V(T," ","")+";",i,n,c-2,h),h);break;case 59:T+=";";default:if(pt(D=Ti(T,e,n,u,p,o,l,M,A=[],L=[],c,s),s),E===123)if(p===0)zt(T,e,D,D,A,s,c,l,L);else switch(v===99&&de(T,3)===110?100:v){case 100:case 108:case 109:case 115:zt(t,D,D,i&&pt(Ti(t,D,D,0,0,o,l,M,o,A=[],c,L),L),o,L,c,l,i?A:L);break;default:zt(T,D,D,D,[""],L,0,l,L)}}u=p=m=0,C=S=1,M=T="",c=r;break;case 58:c=1+xe(T),m=x;default:if(C<1){if(E==123)--C;else if(E==125&&C++==0&&ra()==125)continue}switch(T+=oi(E),E*C){case 38:S=p>0?1:(T+="\f",-1);break;case 44:l[u++]=(xe(T)-1)*S,S=1;break;case 64:Ve()===45&&(T+=pn(_e())),v=Ve(),p=c=xe(M=T+=ha(Ot())),E++;break;case 45:x===45&&xe(T)==2&&(C=0)}}return s}function Ti(t,e,n,i,o,s,r,l,h,u,p,c){for(var v=o-1,m=o===0?s:[""],x=Zo(m),C=0,P=0,S=0;C<i;++C)for(var E=0,M=ot(t,v+1,v=Ko(P=r[C])),A=t;E<x;++E)(A=qo(P>0?m[E]+" "+M:V(M,/&\f/g,m[E])))&&(h[S++]=A);return tn(t,e,n,o===0?Qt:l,h,u,p,c)}function ga(t,e,n,i){return tn(t,e,n,Wo,oi(sa()),ot(t,2,-2),0,i)}function Ai(t,e,n,i,o){return tn(t,e,n,ii,ot(t,0,i),ot(t,i+1,-1),i,o)}function Jo(t,e,n){switch(ia(t,e)){case 5103:return J+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return J+t+t;case 4789:return ft+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return J+t+ft+t+te+t+t;case 5936:switch(de(t,e+11)){case 114:return J+t+te+V(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return J+t+te+V(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return J+t+te+V(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return J+t+te+t+t;case 6165:return J+t+te+"flex-"+t+t;case 5187:return J+t+V(t,/(\w+).+(:[^]+)/,J+"box-$1$2"+te+"flex-$1$2")+t;case 5443:return J+t+te+"flex-item-"+V(t,/flex-|-self/g,"")+(Ie(t,/flex-|baseline/)?"":te+"grid-row-"+V(t,/flex-|-self/g,""))+t;case 4675:return J+t+te+"flex-line-pack"+V(t,/align-content|flex-|-self/g,"")+t;case 5548:return J+t+te+V(t,"shrink","negative")+t;case 5292:return J+t+te+V(t,"basis","preferred-size")+t;case 6060:return J+"box-"+V(t,"-grow","")+J+t+te+V(t,"grow","positive")+t;case 4554:return J+V(t,/([^-])(transform)/g,"$1"+J+"$2")+t;case 6187:return V(V(V(t,/(zoom-|grab)/,J+"$1"),/(image-set)/,J+"$1"),t,"")+t;case 5495:case 3959:return V(t,/(image-set\([^]*)/,J+"$1$`$1");case 4968:return V(V(t,/(.+:)(flex-)?(.*)/,J+"box-pack:$3"+te+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+J+t+t;case 4200:if(!Ie(t,/flex-|baseline/))return te+"grid-column-align"+ot(t,e)+t;break;case 2592:case 3360:return te+V(t,"template-","")+t;case 4384:case 3616:return n&&n.some(function(i,o){return e=o,Ie(i.props,/grid-\w+-end/)})?~At(t+(n=n[e].value),"span",0)?t:te+V(t,"-start","")+t+te+"grid-row-span:"+(~At(n,"span",0)?Ie(n,/\d+/):+Ie(n,/\d+/)-+Ie(t,/\d+/))+";":te+V(t,"-start","")+t;case 4896:case 4128:return n&&n.some(function(i){return Ie(i.props,/grid-\w+-start/)})?t:te+V(V(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return V(t,/(.+)-inline(.+)/,J+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(xe(t)-1-e>6)switch(de(t,e+1)){case 109:if(de(t,e+4)!==45)break;case 102:return V(t,/(.+:)(.+)-([^]+)/,"$1"+J+"$2-$3$1"+ft+(de(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~At(t,"stretch",0)?Jo(V(t,"stretch","fill-available"),e,n)+t:t}break;case 5152:case 5920:return V(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,o,s,r,l,h,u){return te+o+":"+s+u+(r?te+o+"-span:"+(l?h:+h-+s)+u:"")+t});case 4949:if(de(t,e+6)===121)return V(t,":",":"+J)+t;break;case 6444:switch(de(t,de(t,14)===45?18:11)){case 120:return V(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+J+(de(t,14)===45?"inline-":"")+"box$3$1"+J+"$2$3$1"+te+"$2box$3")+t;case 100:return V(t,":",":"+te)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return V(t,"scroll-","scroll-snap-")+t}return t}function Vt(t,e){for(var n="",i=0;i<t.length;i++)n+=e(t[i],i,t,e)||"";return n}function ma(t,e,n,i){switch(t.type){case na:if(t.children.length)break;case ta:case ii:return t.return=t.return||t.value;case Wo:return"";case Yo:return t.return=t.value+"{"+Vt(t.children,i)+"}";case Qt:if(!xe(t.value=t.props.join(",")))return""}return xe(n=Vt(t.children,i))?t.return=t.value+"{"+n+"}":""}function fa(t){var e=Zo(t);return function(n,i,o,s){for(var r="",l=0;l<e;l++)r+=t[l](n,i,o,s)||"";return r}}function va(t){return function(e){e.root||(e=e.return)&&t(e)}}function ya(t,e,n,i){if(t.length>-1&&!t.return)switch(t.type){case ii:t.return=Jo(t.value,t.length,n);return;case Yo:return Vt([Ae(t,{value:V(t.value,"@","@"+J)})],i);case Qt:if(t.length)return oa(n=t.props,function(o){switch(Ie(o,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Xe(Ae(t,{props:[V(o,/:(read-\w+)/,":"+ft+"$1")]})),Xe(Ae(t,{props:[o]})),In(t,{props:Di(n,i)});break;case"::placeholder":Xe(Ae(t,{props:[V(o,/:(plac\w+)/,":"+J+"input-$1")]})),Xe(Ae(t,{props:[V(o,/:(plac\w+)/,":"+ft+"$1")]})),Xe(Ae(t,{props:[V(o,/:(plac\w+)/,te+"input-$1")]})),Xe(Ae(t,{props:[o]})),In(t,{props:Di(n,i)});break}return""})}}var ba={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},rt=typeof process<"u"&&process.env!==void 0&&(process.env.REACT_APP_SC_ATTR||process.env.SC_ATTR)||"data-styled",Qo="active",es="data-styled-version",on="6.1.19",si=`/*!sc*/
`,Gt=typeof window<"u"&&typeof document<"u",wa=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&process.env.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&process.env.REACT_APP_SC_DISABLE_SPEEDY!==""?process.env.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&process.env.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&process.env.SC_DISABLE_SPEEDY!==void 0&&process.env.SC_DISABLE_SPEEDY!==""&&process.env.SC_DISABLE_SPEEDY!=="false"&&process.env.SC_DISABLE_SPEEDY),sn=Object.freeze([]),at=Object.freeze({});function _a(t,e,n){return n===void 0&&(n=at),t.theme!==n.theme&&t.theme||e||n.theme}var ts=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),xa=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Ca=/(^-|-$)/g;function Oi(t){return t.replace(xa,"-").replace(Ca,"")}var Sa=/(a)(d)/gi,Lt=52,zi=function(t){return String.fromCharCode(t+(t>25?39:97))};function Dn(t){var e,n="";for(e=Math.abs(t);e>Lt;e=e/Lt|0)n=zi(e%Lt)+n;return(zi(e%Lt)+n).replace(Sa,"$1-$2")}var gn,ns=5381,tt=function(t,e){for(var n=e.length;n;)t=33*t^e.charCodeAt(--n);return t},is=function(t){return tt(ns,t)};function os(t){return Dn(is(t)>>>0)}function $a(t){return t.displayName||t.name||"Component"}function mn(t){return typeof t=="string"&&!0}var ss=typeof Symbol=="function"&&Symbol.for,rs=ss?Symbol.for("react.memo"):60115,ka=ss?Symbol.for("react.forward_ref"):60112,Ea={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Na={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},as={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Pa=((gn={})[ka]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},gn[rs]=as,gn);function Ri(t){return("type"in(e=t)&&e.type.$$typeof)===rs?as:"$$typeof"in t?Pa[t.$$typeof]:Ea;var e}var Ia=Object.defineProperty,La=Object.getOwnPropertyNames,Fi=Object.getOwnPropertySymbols,Ma=Object.getOwnPropertyDescriptor,Da=Object.getPrototypeOf,Ui=Object.prototype;function ls(t,e,n){if(typeof e!="string"){if(Ui){var i=Da(e);i&&i!==Ui&&ls(t,i,n)}var o=La(e);Fi&&(o=o.concat(Fi(e)));for(var s=Ri(t),r=Ri(e),l=0;l<o.length;++l){var h=o[l];if(!(h in Na||n&&n[h]||r&&h in r||s&&h in s)){var u=Ma(e,h);try{Ia(t,h,u)}catch{}}}}return t}function lt(t){return typeof t=="function"}function ri(t){return typeof t=="object"&&"styledComponentId"in t}function Be(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function Tn(t,e){if(t.length===0)return"";for(var n=t[0],i=1;i<t.length;i++)n+=t[i];return n}function _t(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function An(t,e,n){if(n===void 0&&(n=!1),!n&&!_t(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var i=0;i<e.length;i++)t[i]=An(t[i],e[i]);else if(_t(e))for(var i in e)t[i]=An(t[i],e[i]);return t}function ai(t,e){Object.defineProperty(t,"toString",{value:e})}function Et(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var Ta=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var n=0,i=0;i<e;i++)n+=this.groupSizes[i];return n},t.prototype.insertRules=function(e,n){if(e>=this.groupSizes.length){for(var i=this.groupSizes,o=i.length,s=o;e>=s;)if((s<<=1)<0)throw Et(16,"".concat(e));this.groupSizes=new Uint32Array(s),this.groupSizes.set(i),this.length=s;for(var r=o;r<s;r++)this.groupSizes[r]=0}for(var l=this.indexOfGroup(e+1),h=(r=0,n.length);r<h;r++)this.tag.insertRule(l,n[r])&&(this.groupSizes[e]++,l++)},t.prototype.clearGroup=function(e){if(e<this.length){var n=this.groupSizes[e],i=this.indexOfGroup(e),o=i+n;this.groupSizes[e]=0;for(var s=i;s<o;s++)this.tag.deleteRule(i)}},t.prototype.getGroup=function(e){var n="";if(e>=this.length||this.groupSizes[e]===0)return n;for(var i=this.groupSizes[e],o=this.indexOfGroup(e),s=o+i,r=o;r<s;r++)n+="".concat(this.tag.getRule(r)).concat(si);return n},t}(),Rt=new Map,Wt=new Map,Ft=1,Mt=function(t){if(Rt.has(t))return Rt.get(t);for(;Wt.has(Ft);)Ft++;var e=Ft++;return Rt.set(t,e),Wt.set(e,t),e},Aa=function(t,e){Ft=e+1,Rt.set(t,e),Wt.set(e,t)},Oa="style[".concat(rt,"][").concat(es,'="').concat(on,'"]'),za=new RegExp("^".concat(rt,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Ra=function(t,e,n){for(var i,o=n.split(","),s=0,r=o.length;s<r;s++)(i=o[s])&&t.registerName(e,i)},Fa=function(t,e){for(var n,i=((n=e.textContent)!==null&&n!==void 0?n:"").split(si),o=[],s=0,r=i.length;s<r;s++){var l=i[s].trim();if(l){var h=l.match(za);if(h){var u=0|parseInt(h[1],10),p=h[2];u!==0&&(Aa(p,u),Ra(t,p,h[3]),t.getTag().insertRules(u,o)),o.length=0}else o.push(l)}}},ji=function(t){for(var e=document.querySelectorAll(Oa),n=0,i=e.length;n<i;n++){var o=e[n];o&&o.getAttribute(rt)!==Qo&&(Fa(t,o),o.parentNode&&o.parentNode.removeChild(o))}};function Ua(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var cs=function(t){var e=document.head,n=t||e,i=document.createElement("style"),o=function(l){var h=Array.from(l.querySelectorAll("style[".concat(rt,"]")));return h[h.length-1]}(n),s=o!==void 0?o.nextSibling:null;i.setAttribute(rt,Qo),i.setAttribute(es,on);var r=Ua();return r&&i.setAttribute("nonce",r),n.insertBefore(i,s),i},ja=function(){function t(e){this.element=cs(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,o=0,s=i.length;o<s;o++){var r=i[o];if(r.ownerNode===n)return r}throw Et(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,n){try{return this.sheet.insertRule(n,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var n=this.sheet.cssRules[e];return n&&n.cssText?n.cssText:""},t}(),Ba=function(){function t(e){this.element=cs(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,n){if(e<=this.length&&e>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),Ha=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,n){return e<=this.length&&(this.rules.splice(e,0,n),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),Bi=Gt,Va={isServer:!Gt,useCSSOMInjection:!wa},us=function(){function t(e,n,i){e===void 0&&(e=at),n===void 0&&(n={});var o=this;this.options=ve(ve({},Va),e),this.gs=n,this.names=new Map(i),this.server=!!e.isServer,!this.server&&Gt&&Bi&&(Bi=!1,ji(this)),ai(this,function(){return function(s){for(var r=s.getTag(),l=r.length,h="",u=function(c){var v=function(S){return Wt.get(S)}(c);if(v===void 0)return"continue";var m=s.names.get(v),x=r.getGroup(c);if(m===void 0||!m.size||x.length===0)return"continue";var C="".concat(rt,".g").concat(c,'[id="').concat(v,'"]'),P="";m!==void 0&&m.forEach(function(S){S.length>0&&(P+="".concat(S,","))}),h+="".concat(x).concat(C,'{content:"').concat(P,'"}').concat(si)},p=0;p<l;p++)u(p);return h}(o)})}return t.registerId=function(e){return Mt(e)},t.prototype.rehydrate=function(){!this.server&&Gt&&ji(this)},t.prototype.reconstructWithOptions=function(e,n){return n===void 0&&(n=!0),new t(ve(ve({},this.options),e),this.gs,n&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(n){var i=n.useCSSOMInjection,o=n.target;return n.isServer?new Ha(o):i?new ja(o):new Ba(o)}(this.options),new Ta(e)));var e},t.prototype.hasNameForId=function(e,n){return this.names.has(e)&&this.names.get(e).has(n)},t.prototype.registerName=function(e,n){if(Mt(e),this.names.has(e))this.names.get(e).add(n);else{var i=new Set;i.add(n),this.names.set(e,i)}},t.prototype.insertRules=function(e,n,i){this.registerName(e,n),this.getTag().insertRules(Mt(e),i)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(Mt(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),Ga=/&/g,Wa=/^\s*\/\/.*$/gm;function ds(t,e){return t.map(function(n){return n.type==="rule"&&(n.value="".concat(e," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(e," ")),n.props=n.props.map(function(i){return"".concat(e," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=ds(n.children,e)),n})}function Ya(t){var e,n,i,o=at,s=o.options,r=s===void 0?at:s,l=o.plugins,h=l===void 0?sn:l,u=function(v,m,x){return x.startsWith(n)&&x.endsWith(n)&&x.replaceAll(n,"").length>0?".".concat(e):v},p=h.slice();p.push(function(v){v.type===Qt&&v.value.includes("&")&&(v.props[0]=v.props[0].replace(Ga,n).replace(i,u))}),r.prefix&&p.push(ya),p.push(ma);var c=function(v,m,x,C){m===void 0&&(m=""),x===void 0&&(x=""),C===void 0&&(C="&"),e=C,n=m,i=new RegExp("\\".concat(n,"\\b"),"g");var P=v.replace(Wa,""),S=pa(x||m?"".concat(x," ").concat(m," { ").concat(P," }"):P);r.namespace&&(S=ds(S,r.namespace));var E=[];return Vt(S,fa(p.concat(va(function(M){return E.push(M)})))),E};return c.hash=h.length?h.reduce(function(v,m){return m.name||Et(15),tt(v,m.name)},ns).toString():"",c}var Ka=new us,On=Ya(),hs=oe.createContext({shouldForwardProp:void 0,styleSheet:Ka,stylis:On});hs.Consumer;oe.createContext(void 0);function Hi(){return ke(hs)}var ps=function(){function t(e,n){var i=this;this.inject=function(o,s){s===void 0&&(s=On);var r=i.name+s.hash;o.hasNameForId(i.id,r)||o.insertRules(i.id,r,s(i.rules,r,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=n,ai(this,function(){throw Et(12,String(i.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=On),this.name+e.hash},t}(),qa=function(t){return t>="A"&&t<="Z"};function Vi(t){for(var e="",n=0;n<t.length;n++){var i=t[n];if(n===1&&i==="-"&&t[0]==="-")return t;qa(i)?e+="-"+i.toLowerCase():e+=i}return e.startsWith("ms-")?"-"+e:e}var gs=function(t){return t==null||t===!1||t===""},ms=function(t){var e,n,i=[];for(var o in t){var s=t[o];t.hasOwnProperty(o)&&!gs(s)&&(Array.isArray(s)&&s.isCss||lt(s)?i.push("".concat(Vi(o),":"),s,";"):_t(s)?i.push.apply(i,wt(wt(["".concat(o," {")],ms(s),!1),["}"],!1)):i.push("".concat(Vi(o),": ").concat((e=o,(n=s)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||e in ba||e.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Ge(t,e,n,i){if(gs(t))return[];if(ri(t))return[".".concat(t.styledComponentId)];if(lt(t)){if(!lt(s=t)||s.prototype&&s.prototype.isReactComponent||!e)return[t];var o=t(e);return Ge(o,e,n,i)}var s;return t instanceof ps?n?(t.inject(n,i),[t.getName(i)]):[t]:_t(t)?ms(t):Array.isArray(t)?Array.prototype.concat.apply(sn,t.map(function(r){return Ge(r,e,n,i)})):[t.toString()]}function Za(t){for(var e=0;e<t.length;e+=1){var n=t[e];if(lt(n)&&!ri(n))return!1}return!0}var Xa=is(on),Ja=function(){function t(e,n,i){this.rules=e,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&Za(e),this.componentId=n,this.baseHash=tt(Xa,n),this.baseStyle=i,us.registerId(n)}return t.prototype.generateAndInjectStyles=function(e,n,i){var o=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))o=Be(o,this.staticRulesId);else{var s=Tn(Ge(this.rules,e,n,i)),r=Dn(tt(this.baseHash,s)>>>0);if(!n.hasNameForId(this.componentId,r)){var l=i(s,".".concat(r),void 0,this.componentId);n.insertRules(this.componentId,r,l)}o=Be(o,r),this.staticRulesId=r}else{for(var h=tt(this.baseHash,i.hash),u="",p=0;p<this.rules.length;p++){var c=this.rules[p];if(typeof c=="string")u+=c;else if(c){var v=Tn(Ge(c,e,n,i));h=tt(h,v+p),u+=v}}if(u){var m=Dn(h>>>0);n.hasNameForId(this.componentId,m)||n.insertRules(this.componentId,m,i(u,".".concat(m),void 0,this.componentId)),o=Be(o,m)}}return o},t}(),fs=oe.createContext(void 0);fs.Consumer;var fn={};function Qa(t,e,n){var i=ri(t),o=t,s=!mn(t),r=e.attrs,l=r===void 0?sn:r,h=e.componentId,u=h===void 0?function(A,L){var D=typeof A!="string"?"sc":Oi(A);fn[D]=(fn[D]||0)+1;var T="".concat(D,"-").concat(os(on+D+fn[D]));return L?"".concat(L,"-").concat(T):T}(e.displayName,e.parentComponentId):h,p=e.displayName,c=p===void 0?function(A){return mn(A)?"styled.".concat(A):"Styled(".concat($a(A),")")}(t):p,v=e.displayName&&e.componentId?"".concat(Oi(e.displayName),"-").concat(e.componentId):e.componentId||u,m=i&&o.attrs?o.attrs.concat(l).filter(Boolean):l,x=e.shouldForwardProp;if(i&&o.shouldForwardProp){var C=o.shouldForwardProp;if(e.shouldForwardProp){var P=e.shouldForwardProp;x=function(A,L){return C(A,L)&&P(A,L)}}else x=C}var S=new Ja(n,v,i?o.componentStyle:void 0);function E(A,L){return function(D,T,G){var U=D.attrs,pe=D.componentStyle,re=D.defaultProps,ge=D.foldedComponentIds,qe=D.styledComponentId,Ze=D.target,B=oe.useContext(fs),Te=Hi(),ye=D.shouldForwardProp||Te.shouldForwardProp,d=_a(T,B,re)||at,g=function(I,k,N){for(var F,ee=ve(ve({},k),{className:void 0,theme:N}),K=0;K<I.length;K+=1){var Y=lt(F=I[K])?F(ee):F;for(var X in Y)ee[X]=X==="className"?Be(ee[X],Y[X]):X==="style"?ve(ve({},ee[X]),Y[X]):Y[X]}return k.className&&(ee.className=Be(ee.className,k.className)),ee}(U,T,d),y=g.as||Ze,b={};for(var w in g)g[w]===void 0||w[0]==="$"||w==="as"||w==="theme"&&g.theme===d||(w==="forwardedAs"?b.as=g.forwardedAs:ye&&!ye(w,y)||(b[w]=g[w]));var _=function(I,k){var N=Hi(),F=I.generateAndInjectStyles(k,N.styleSheet,N.stylis);return F}(pe,g),$=Be(ge,qe);return _&&($+=" "+_),g.className&&($+=" "+g.className),b[mn(y)&&!ts.has(y)?"class":"className"]=$,G&&(b.ref=G),ue(y,b)}(M,A,L)}E.displayName=c;var M=oe.forwardRef(E);return M.attrs=m,M.componentStyle=S,M.displayName=c,M.shouldForwardProp=x,M.foldedComponentIds=i?Be(o.foldedComponentIds,o.styledComponentId):"",M.styledComponentId=v,M.target=i?o.target:t,Object.defineProperty(M,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(A){this._foldedDefaultProps=i?function(L){for(var D=[],T=1;T<arguments.length;T++)D[T-1]=arguments[T];for(var G=0,U=D;G<U.length;G++)An(L,U[G],!0);return L}({},o.defaultProps,A):A}}),ai(M,function(){return".".concat(M.styledComponentId)}),s&&ls(M,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),M}function Gi(t,e){for(var n=[t[0]],i=0,o=e.length;i<o;i+=1)n.push(e[i],t[i+1]);return n}var Wi=function(t){return Object.assign(t,{isCss:!0})};function vs(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(lt(t)||_t(t))return Wi(Ge(Gi(sn,wt([t],e,!0))));var i=t;return e.length===0&&i.length===1&&typeof i[0]=="string"?Ge(i):Wi(Ge(Gi(i,e)))}function zn(t,e,n){if(n===void 0&&(n=at),!e)throw Et(1,e);var i=function(o){for(var s=[],r=1;r<arguments.length;r++)s[r-1]=arguments[r];return t(e,n,vs.apply(void 0,wt([o],s,!1)))};return i.attrs=function(o){return zn(t,e,ve(ve({},n),{attrs:Array.prototype.concat(n.attrs,o).filter(Boolean)}))},i.withConfig=function(o){return zn(t,e,ve(ve({},n),o))},i}var ys=function(t){return zn(Qa,t)},j=ys;ts.forEach(function(t){j[t]=ys(t)});function bs(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=Tn(vs.apply(void 0,wt([t],e,!1))),o=os(i);return new ps(o,i)}const Yt=j.button.withConfig({displayName:"Popupstyled__BaseButton",componentId:"sc-ghwxu6-0"})(["position:relative;&::after{content:attr(data-tooltip);position:absolute;bottom:-30px;left:50%;transform:translateX(-50%);background:black;color:white;padding:4px 8px;border-radius:4px;font-size:12px;opacity:0;visibility:hidden;transition:opacity 0.2s;}&:hover::after{opacity:1;visibility:visible;}"]),el=j.div.withConfig({displayName:"Popupstyled__Overlay",componentId:"sc-ghwxu6-1"})(["position:fixed;cursor:pointer;font-size:0;line-height:0;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.6);z-index:9999;height:100vh;width:100vw;display:flex;flex-direction:column;"]),tl=({img:t})=>a(W,{children:t instanceof HTMLImageElement&&a("img",{src:t.src,alt:t.src})});bs(["from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}"]);const nl=j.div.withConfig({displayName:"Content__P",componentId:"sc-41m4v6-0"})(["display:flex;flex:1;align-items:center;justify-content:center;overflow:hidden;pointer-events:none;"]),il=j.div.withConfig({displayName:"Content__k",componentId:"sc-41m4v6-1"})(["transform:translate(","px,","px) scale(",");cursor:",";pointer-events:auto;transition:",";transform-origin:center;"],t=>t.x,t=>t.y,t=>t.scale,t=>t.isDragging?"grabbing":"grab",t=>t.isDragging?"none":"transform 0.2s ease"),ol=()=>{const{images:t,activeImageIndex:e}=kt(),n=he(null),i=he(null),[o,s]=z(!1),[r,l]=z({x:0,y:0}),[h,u]=z({x:0,y:0}),[p,c]=z(1),v=()=>{if(!n.current||!i.current)return 1;const S=n.current,E=t[e];if(!E)return 1;const M=S.clientWidth,A=S.clientHeight;let L,D;if(E instanceof HTMLImageElement)L=E.naturalWidth,D=E.naturalHeight;else{const ge=E.getBoundingClientRect();L=ge.width,D=ge.height}const T=40,G=M-T,U=A-T,pe=G/L,re=U/D;return Math.min(pe,re,1)};Z(()=>{l({x:0,y:0}),u({x:0,y:0}),setTimeout(()=>{const S=v();c(S)},50)},[e]);const m=S=>{s(!0),u({x:S.clientX-r.x,y:S.clientY-r.y}),S.preventDefault()},x=S=>{o&&l({x:S.clientX-h.x,y:S.clientY-h.y})},C=()=>{s(!1)},P=S=>{S.preventDefault();const E=.1,M=S.deltaY>0?-E:E;c(A=>{const L=A+M;return Math.max(.1,Math.min(5,L))})};return Z(()=>(document.addEventListener("wheel",P),()=>{document.removeEventListener("wheel",P)}),[]),Z(()=>o?(document.addEventListener("mousemove",x),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",C)}):()=>{},[o,h]),a(nl,{ref:n,children:a(il,{isDragging:o,x:r.x,y:r.y,scale:p,onMouseDown:m,children:a("div",{ref:i,children:a(tl,{img:t[e]})})})})},sl=j.div.withConfig({displayName:"Footer__x",componentId:"sc-15ektlo-0"})(["display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px;"]),rl=j.div.withConfig({displayName:"Footer__b",componentId:"sc-15ektlo-1"})(["color:#fff;font-size:14px;font-weight:500;"]),al=j.div.withConfig({displayName:"Footer__w",componentId:"sc-15ektlo-2"})(["display:flex;flex-direction:row;justify-content:center;align-items:center;gap:5px;"]),ll=(t,e=150,n=150)=>new Promise(i=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const s=document.createElement("canvas"),r=s.getContext("2d");if(!r){i(t.src);return}const l=Math.min(e/o.naturalWidth,n/o.naturalHeight),h=o.naturalWidth*l,u=o.naturalHeight*l;s.width=h,s.height=u,r.drawImage(o,0,0,h,u);try{i(s.toDataURL("image/png",.7))}catch{i(t.src)}},o.onerror=()=>{i(t.src)},o.src=t.src}),cl=j(Yt).withConfig({displayName:"Footer__I",componentId:"sc-15ektlo-3"})(["width:60px;height:60px;margin:0;border:",";img{width:100%;height:100%;object-fit:cover;}"],t=>t.$isActive?"2px solid #007acc":"1px solid #ccc"),ul=()=>{const{images:t,activeImageIndex:e,setActiveImageIndex:n}=kt(),[i,o]=z([]);return Z(()=>{(async()=>{const s=await Promise.all(t.map(async r=>r instanceof HTMLImageElement?await ll(r):""));o(s)})()},[t]),a(sl,{children:[a(rl,{children:[e+1," / ",t.length]}),a(al,{children:i.map((s,r)=>a(cl,{$isActive:r===e,onClick:()=>n(r),children:a("img",{src:s,alt:`Thumbnail ${r}`})},r))})]})},dl=j.div.withConfig({displayName:"Headerstyled__SHeader",componentId:"sc-17cmp36-0"})(["display:flex;flex-direction:row;justify-content:flex-end;align-items:flex-end;"]);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pl=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,i)=>i?i.toUpperCase():n.toLowerCase()),Yi=t=>{const e=pl(t);return e.charAt(0).toUpperCase()+e.slice(1)},ws=(...t)=>t.filter((e,n,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===n).join(" ").trim(),gl=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ml={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const fl=$t(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:o="",children:s,iconNode:r,...l},h)=>ue("svg",{ref:h,...ml,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:ws("lucide",o),...!s&&!gl(l)&&{"aria-hidden":"true"},...l},[...r.map(([u,p])=>ue(u,p)),...Array.isArray(s)?s:[s]])),Ee=(t,e)=>{const n=$t(({className:i,...o},s)=>ue(fl,{ref:s,iconNode:e,className:ws(`lucide-${hl(Yi(t))}`,`lucide-${t}`,i),...o}));return n.displayName=Yi(t),n},vl=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],yl=Ee("arrow-left",vl),bl=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],wl=Ee("arrow-right",bl),_l=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],xl=Ee("chevron-down",_l),Cl=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Sl=Ee("chevron-right",Cl),$l=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],kl=Ee("maximize",$l),El=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],Nl=Ee("menu",El),Pl=[["path",{d:"M5 12h14",key:"1ays0h"}]],Il=Ee("minus",Pl),Ll=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],_s=Ee("rotate-ccw",Ll),Ml=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Dl=Ee("rotate-cw",Ml),Tl=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Al=Ee("x",Tl),Ol=({setMode:t})=>{const{onClose:e}=kt(),n=le(()=>{t("minimized")},[]);return a(dl,{children:[a(Yt,{onClick:n,"data-tooltip":"Minimize",children:a(Il,{})}),a(Yt,{onClick:e,"data-tooltip":"Close",children:a(Al,{})})]})},zl=({initialPosition:t,onDragEnd:e})=>{const[n,i]=z({x:0,y:0}),[o,s]=z(!1),[r,l]=z(t),[h,u]=z(!1),p=le(m=>{s(!0),u(!1);const x=m.currentTarget.getBoundingClientRect();i({x:m.clientX-x.left,y:m.clientY-x.top})},[]),c=le(m=>{o&&(u(!0),l({x:window.innerWidth-(m.clientX-n.x)-50,y:window.innerHeight-(m.clientY-n.y)-50}))},[o,n]),v=le(()=>{s(!1),e?.(h)},[h,e]);return{position:r,isDragging:o,dragHandlers:{onMouseDown:p,onMouseMove:c,onMouseUp:v}}},Rl=j(Yt).withConfig({displayName:"MinimizedModestyled__MinimizedButton",componentId:"sc-cmlnj7-0"})(["position:fixed;bottom:","px;right:","px;border-radius:50%;width:50px;height:50px;z-index:9999;display:flex;align-items:center;justify-content:center;padding:0;margin:0;user-select:none;"],t=>t.$y,t=>t.$x),Fl=j.div.withConfig({displayName:"MinimizedModestyled__Badge",componentId:"sc-cmlnj7-1"})(["position:absolute;top:-5px;right:-5px;background:red;color:white;border-radius:50%;width:20px;height:20px;font-size:12px;display:flex;align-items:center;justify-content:center;"]),Ul=({setMode:t})=>{const{images:e}=kt(),[n,i]=z(e.length);Z(()=>{i(e.length)},[e]);const{position:o,isDragging:s,dragHandlers:r}=zl({initialPosition:{x:20,y:80},onDragEnd:l=>{l||t("maximized")}});return Z(()=>{if(s)return document.addEventListener("mousemove",r.onMouseMove),document.addEventListener("mouseup",r.onMouseUp),()=>{document.removeEventListener("mousemove",r.onMouseMove),document.removeEventListener("mouseup",r.onMouseUp)}},[s,r.onMouseMove,r.onMouseUp]),a(Rl,{"data-tooltip":`Show popup (${n} images)`,$x:o.x,$y:o.y,onMouseDown:r.onMouseDown,children:[a(kl,{}),n>0&&a(Fl,{children:n})]})},jl=j.div.withConfig({displayName:"Popup__E",componentId:"sc-1m5dz9n-0"})(["position:relative;width:100%;height:100%;display:flex;flex-direction:column;"]),Bl=()=>{const{popupMode:t,onClose:e,setActiveImageIndex:n,setImages:i,images:o}=kt(),[s,r]=z("maximized");Z(()=>{const h=u=>{const p=o.length;i(c=>[...c,u]),n(p),r("maximized")};return t.plugin.emitter.on("image.popup.show",h),()=>{t.plugin.emitter.off("image.popup.show",h)}},[]),Z(()=>{const h=u=>{u.key==="Escape"&&e()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[e]);const l=le(h=>{h.target===h.currentTarget&&e()},[e]);return s==="maximized"?a(el,{onClick:l,children:a(jl,{children:[a(Ol,{setMode:r}),a(ol,{}),a(ul,{})]})}):a(Ul,{setMode:r})},Hl=({popupMode:t,initialImages:e,onClose:n})=>a(Jr,{popupMode:t,initialImages:e,onClose:n,children:a(Bl,{})});let Vl=class extends R.Component{constructor(e){super(),this.plugin=e}popupDiv=null;popupRoot=null;initialize(){this.load(),this.plugin.app.workspace.on("layout-change",()=>{const e=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView);e&&this.addPopupButton(e)})}addPopupButton(e){if(e.actionsEl.querySelector(".izd-popup-button"))return;const n=e.addAction("layout-grid","Open view image gallery in popup window",this.showPopupForViewImages.bind(this));n.addClass("izd-popup-button"),this.register(()=>{n.remove()})}async getAllImagesForPopup(e){const n=new R.Component;n.load();const i=document.createElement("div");i.style.visibility="hidden",document.body.appendChild(i);const o=await this.plugin.app.vault.cachedRead(e.file);await R.MarkdownRenderer.render(this.plugin.app,o,i,e.file.path,n),await new Promise(r=>requestAnimationFrame(r));const s=Array.from(i.querySelectorAll("img")).filter(r=>!Ut(r));return i.remove(),n.unload(),s}async showPopupForViewImages(){const e=this.plugin.app.workspace.getActiveViewOfType(R.MarkdownView),n=await this.getAllImagesForPopup(e);if(n.length===0){this.plugin.showNotice("No images found in the current view.");return}await this.showPopup(n)}async showPopupForImage(e){await this.showPopup(e)}async showPopup(e){const n=Array.isArray(e)?e:[e];this.popupDiv??=document.body.createDiv(),this.popupRoot?this.plugin.emitter.emit("image.popup.show",e):(this.popupRoot=Jt(this.popupDiv),this.popupRoot.render(a(Hl,{popupMode:this,initialImages:n,onClose:()=>this.closePopup()})))}closePopup(){this.popupRoot?.unmount(),this.popupRoot=null,this.popupDiv?.remove(),this.popupDiv=null}onunload(){super.onunload(),this.closePopup()}};function Gl(){return{units:{contextMenu:{showForDiagrams:!0,showForOtherImages:!1},interactivity:{markdown:{autoDetect:!0},picker:{enabled:!1}},folding:{foldByDefault:!1,autoFoldOnFocusChange:!1},settingsPagination:{perPage:5},size:{expanded:{width:{value:100,type:"%"},height:{value:100,type:"%"}},folded:{width:{value:50,type:"%"},height:{value:50,type:"%"}}},configs:Object.entries(Le).map(([t,e])=>({name:t,selector:e,on:e!==Le.IMG_SVG,panels:{move:{on:!0},zoom:{on:!0},service:{on:!0}}}))},panels:{global:{triggering:{mode:We.ALWAYS,ignoreService:!0}},local:{preset:"none",panels:{service:{on:!1,buttons:{hide:!0,fullscreen:!0},position:{top:"0px",right:"0px"}},move:{on:!1,buttons:{up:!0,down:!0,left:!0,right:!0,upLeft:!0,upRight:!0,downLeft:!0,downRight:!0},position:{bottom:"0px",right:"0px"}},zoom:{on:!1,buttons:{in:!0,out:!0,reset:!0},position:{top:"50%",right:"0px"}}}}},debug:{enabled:!1,level:lo.None}}}function xs(t,e){if(!e||typeof e!="object")return t;const n={...t};for(const i in e)e[i]&&typeof e[i]=="object"&&!Array.isArray(e[i])?n[i]=xs(n[i]??{},e[i]):e[i]!==void 0&&(n[i]=e[i]);return n}var vn={exports:{}},Ki;function Wl(){return Ki||(Ki=1,function(t,e){(function(n){var i=Object.hasOwnProperty,o=Array.isArray?Array.isArray:function(d){return Object.prototype.toString.call(d)==="[object Array]"},s=10,r=typeof process=="object"&&typeof process.nextTick=="function",l=typeof Symbol=="function",h=typeof Reflect=="object",u=typeof setImmediate=="function",p=u?setImmediate:setTimeout,c=l?h&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(d){var g=Object.getOwnPropertyNames(d);return g.push.apply(g,Object.getOwnPropertySymbols(d)),g}:Object.keys;function v(){this._events={},this._conf&&m.call(this,this._conf)}function m(d){d&&(this._conf=d,d.delimiter&&(this.delimiter=d.delimiter),d.maxListeners!==n&&(this._maxListeners=d.maxListeners),d.wildcard&&(this.wildcard=d.wildcard),d.newListener&&(this._newListener=d.newListener),d.removeListener&&(this._removeListener=d.removeListener),d.verboseMemoryLeak&&(this.verboseMemoryLeak=d.verboseMemoryLeak),d.ignoreErrors&&(this.ignoreErrors=d.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function x(d,g){var y="(node) warning: possible EventEmitter memory leak detected. "+d+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(y+=" Event name: "+g+"."),typeof process<"u"&&process.emitWarning){var b=new Error(y);b.name="MaxListenersExceededWarning",b.emitter=this,b.count=d,process.emitWarning(b)}else console.error(y),console.trace&&console.trace()}var C=function(d,g,y){var b=arguments.length;switch(b){case 0:return[];case 1:return[d];case 2:return[d,g];case 3:return[d,g,y];default:for(var w=new Array(b);b--;)w[b]=arguments[b];return w}};function P(d,g){for(var y={},b,w=d.length,_=0,$=0;$<w;$++)b=d[$],y[b]=$<_?g[$]:n;return y}function S(d,g,y){this._emitter=d,this._target=g,this._listeners={},this._listenersCount=0;var b,w;if((y.on||y.off)&&(b=y.on,w=y.off),g.addEventListener?(b=g.addEventListener,w=g.removeEventListener):g.addListener?(b=g.addListener,w=g.removeListener):g.on&&(b=g.on,w=g.off),!b&&!w)throw Error("target does not implement any known event API");if(typeof b!="function")throw TypeError("on method must be a function");if(typeof w!="function")throw TypeError("off method must be a function");this._on=b,this._off=w;var _=d._observers;_?_.push(this):d._observers=[this]}Object.assign(S.prototype,{subscribe:function(d,g,y){var b=this,w=this._target,_=this._emitter,$=this._listeners,I=function(){var k=C.apply(null,arguments),N={data:k,name:g,original:d};if(y){var F=y.call(w,N);F!==!1&&_.emit.apply(_,[N.name].concat(k));return}_.emit.apply(_,[g].concat(k))};if($[d])throw Error("Event '"+d+"' is already listening");this._listenersCount++,_._newListener&&_._removeListener&&!b._onNewListener?(this._onNewListener=function(k){k===g&&$[d]===null&&($[d]=I,b._on.call(w,d,I))},_.on("newListener",this._onNewListener),this._onRemoveListener=function(k){k===g&&!_.hasListeners(k)&&$[d]&&($[d]=null,b._off.call(w,d,I))},$[d]=null,_.on("removeListener",this._onRemoveListener)):($[d]=I,b._on.call(w,d,I))},unsubscribe:function(d){var g=this,y=this._listeners,b=this._emitter,w,_,$=this._off,I=this._target,k;if(d&&typeof d!="string")throw TypeError("event must be a string");function N(){g._onNewListener&&(b.off("newListener",g._onNewListener),b.off("removeListener",g._onRemoveListener),g._onNewListener=null,g._onRemoveListener=null);var F=G.call(b,g);b._observers.splice(F,1)}if(d){if(w=y[d],!w)return;$.call(I,d,w),delete y[d],--this._listenersCount||N()}else{for(_=c(y),k=_.length;k-- >0;)d=_[k],$.call(I,d,y[d]);this._listeners={},this._listenersCount=0,N()}}});function E(d,g,y,b){var w=Object.assign({},g);if(!d)return w;if(typeof d!="object")throw TypeError("options must be an object");var _=Object.keys(d),$=_.length,I,k,N;function F(K){throw Error('Invalid "'+I+'" option value'+(K?". Reason: "+K:""))}for(var ee=0;ee<$;ee++){if(I=_[ee],!i.call(g,I))throw Error('Unknown "'+I+'" option');k=d[I],k!==n&&(N=y[I],w[I]=N?N(k,F):k)}return w}function M(d,g){return(typeof d!="function"||!d.hasOwnProperty("prototype"))&&g("value must be a constructor"),d}function A(d){var g="value must be type of "+d.join("|"),y=d.length,b=d[0],w=d[1];return y===1?function(_,$){if(typeof _===b)return _;$(g)}:y===2?function(_,$){var I=typeof _;if(I===b||I===w)return _;$(g)}:function(_,$){for(var I=typeof _,k=y;k-- >0;)if(I===d[k])return _;$(g)}}var L=A(["function"]),D=A(["object","function"]);function T(d,g,y){var b,w,_=0,$,I=new d(function(k,N,F){y=E(y,{timeout:0,overload:!1},{timeout:function(X,me){return X*=1,(typeof X!="number"||X<0||!Number.isFinite(X))&&me("timeout must be a positive number"),X}}),b=!y.overload&&typeof d.prototype.cancel=="function"&&typeof F=="function";function ee(){w&&(w=null),_&&(clearTimeout(_),_=0)}var K=function(X){ee(),k(X)},Y=function(X){ee(),N(X)};b?g(K,Y,F):(w=[function(X){Y(X||Error("canceled"))}],g(K,Y,function(X){if($)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof X!="function")throw TypeError("onCancel callback must be a function");w.push(X)}),$=!0),y.timeout>0&&(_=setTimeout(function(){var X=Error("timeout");X.code="ETIMEDOUT",_=0,I.cancel(X),N(X)},y.timeout))});return b||(I.cancel=function(k){if(w){for(var N=w.length,F=1;F<N;F++)w[F](k);w[0](k),w=null}}),I}function G(d){var g=this._observers;if(!g)return-1;for(var y=g.length,b=0;b<y;b++)if(g[b]._target===d)return b;return-1}function U(d,g,y,b,w){if(!y)return null;if(b===0){var _=typeof g;if(_==="string"){var $,I,k=0,N=0,F=this.delimiter,ee=F.length;if((I=g.indexOf(F))!==-1){$=new Array(5);do $[k++]=g.slice(N,I),N=I+ee;while((I=g.indexOf(F,N))!==-1);$[k++]=g.slice(N),g=$,w=k}else g=[g],w=1}else _==="object"?w=g.length:(g=[g],w=1)}var K=null,Y,X,me,ln,cn,ht=g[b],un=g[b+1],Ne,fe;if(b===w)y._listeners&&(typeof y._listeners=="function"?(d&&d.push(y._listeners),K=[y]):(d&&d.push.apply(d,y._listeners),K=[y]));else if(ht==="*"){for(Ne=c(y),I=Ne.length;I-- >0;)Y=Ne[I],Y!=="_listeners"&&(fe=U(d,g,y[Y],b+1,w),fe&&(K?K.push.apply(K,fe):K=fe));return K}else if(ht==="**"){for(cn=b+1===w||b+2===w&&un==="*",cn&&y._listeners&&(K=U(d,g,y,w,w)),Ne=c(y),I=Ne.length;I-- >0;)Y=Ne[I],Y!=="_listeners"&&(Y==="*"||Y==="**"?(y[Y]._listeners&&!cn&&(fe=U(d,g,y[Y],w,w),fe&&(K?K.push.apply(K,fe):K=fe)),fe=U(d,g,y[Y],b,w)):Y===un?fe=U(d,g,y[Y],b+2,w):fe=U(d,g,y[Y],b,w),fe&&(K?K.push.apply(K,fe):K=fe));return K}else y[ht]&&(K=U(d,g,y[ht],b+1,w));if(X=y["*"],X&&U(d,g,X,b+1,w),me=y["**"],me)if(b<w)for(me._listeners&&U(d,g,me,w,w),Ne=c(me),I=Ne.length;I-- >0;)Y=Ne[I],Y!=="_listeners"&&(Y===un?U(d,g,me[Y],b+2,w):Y===ht?U(d,g,me[Y],b+1,w):(ln={},ln[Y]=me[Y],U(d,g,{"**":ln},b+1,w)));else me._listeners?U(d,g,me,w,w):me["*"]&&me["*"]._listeners&&U(d,g,me["*"],w,w);return K}function pe(d,g,y){var b=0,w=0,_,$=this.delimiter,I=$.length,k;if(typeof d=="string")if((_=d.indexOf($))!==-1){k=new Array(5);do k[b++]=d.slice(w,_),w=_+I;while((_=d.indexOf($,w))!==-1);k[b++]=d.slice(w)}else k=[d],b=1;else k=d,b=d.length;if(b>1){for(_=0;_+1<b;_++)if(k[_]==="**"&&k[_+1]==="**")return}var N=this.listenerTree,F;for(_=0;_<b;_++)if(F=k[_],N=N[F]||(N[F]={}),_===b-1)return N._listeners?(typeof N._listeners=="function"&&(N._listeners=[N._listeners]),y?N._listeners.unshift(g):N._listeners.push(g),!N._listeners.warned&&this._maxListeners>0&&N._listeners.length>this._maxListeners&&(N._listeners.warned=!0,x.call(this,N._listeners.length,F))):N._listeners=g,!0;return!0}function re(d,g,y,b){for(var w=c(d),_=w.length,$,I,k,N=d._listeners,F;_-- >0;)I=w[_],$=d[I],I==="_listeners"?k=y:k=y?y.concat(I):[I],F=b||typeof I=="symbol",N&&g.push(F?k:k.join(this.delimiter)),typeof $=="object"&&re.call(this,$,g,k,F);return g}function ge(d){for(var g=c(d),y=g.length,b,w,_;y-- >0;)w=g[y],b=d[w],b&&(_=!0,w!=="_listeners"&&!ge(b)&&delete d[w]);return _}function qe(d,g,y){this.emitter=d,this.event=g,this.listener=y}qe.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function Ze(d,g,y){if(y===!0)w=!0;else if(y===!1)b=!0;else{if(!y||typeof y!="object")throw TypeError("options should be an object or true");var b=y.async,w=y.promisify,_=y.nextTick,$=y.objectify}if(b||_||w){var I=g,k=g._origin||g;if(_&&!r)throw Error("process.nextTick is not supported");w===n&&(w=g.constructor.name==="AsyncFunction"),g=function(){var N=arguments,F=this,ee=this.event;return w?_?Promise.resolve():new Promise(function(K){p(K)}).then(function(){return F.event=ee,I.apply(F,N)}):(_?process.nextTick:p)(function(){F.event=ee,I.apply(F,N)})},g._async=!0,g._origin=k}return[g,$?new qe(this,d,g):this]}function B(d){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,m.call(this,d)}B.EventEmitter2=B,B.prototype.listenTo=function(d,g,y){if(typeof d!="object")throw TypeError("target musts be an object");var b=this;y=E(y,{on:n,off:n,reducers:n},{on:L,off:L,reducers:D});function w(_){if(typeof _!="object")throw TypeError("events must be an object");var $=y.reducers,I=G.call(b,d),k;I===-1?k=new S(b,d,y):k=b._observers[I];for(var N=c(_),F=N.length,ee,K=typeof $=="function",Y=0;Y<F;Y++)ee=N[Y],k.subscribe(ee,_[ee]||ee,K?$:$&&$[ee])}return o(g)?w(P(g)):w(typeof g=="string"?P(g.split(/\s+/)):g),this},B.prototype.stopListeningTo=function(d,g){var y=this._observers;if(!y)return!1;var b=y.length,w,_=!1;if(d&&typeof d!="object")throw TypeError("target should be an object");for(;b-- >0;)w=y[b],(!d||w._target===d)&&(w.unsubscribe(g),_=!0);return _},B.prototype.delimiter=".",B.prototype.setMaxListeners=function(d){d!==n&&(this._maxListeners=d,this._conf||(this._conf={}),this._conf.maxListeners=d)},B.prototype.getMaxListeners=function(){return this._maxListeners},B.prototype.event="",B.prototype.once=function(d,g,y){return this._once(d,g,!1,y)},B.prototype.prependOnceListener=function(d,g,y){return this._once(d,g,!0,y)},B.prototype._once=function(d,g,y,b){return this._many(d,1,g,y,b)},B.prototype.many=function(d,g,y,b){return this._many(d,g,y,!1,b)},B.prototype.prependMany=function(d,g,y,b){return this._many(d,g,y,!0,b)},B.prototype._many=function(d,g,y,b,w){var _=this;if(typeof y!="function")throw new Error("many only accepts instances of Function");function $(){return--g===0&&_.off(d,$),y.apply(this,arguments)}return $._origin=y,this._on(d,$,b,w)},B.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||v.call(this);var d=arguments[0],g,y=this.wildcard,b,w,_,$,I;if(d==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(y&&(g=d,d!=="newListener"&&d!=="removeListener"&&typeof d=="object")){if(w=d.length,l){for(_=0;_<w;_++)if(typeof d[_]=="symbol"){I=!0;break}}I||(d=d.join(this.delimiter))}var k=arguments.length,N;if(this._all&&this._all.length)for(N=this._all.slice(),_=0,w=N.length;_<w;_++)switch(this.event=d,k){case 1:N[_].call(this,d);break;case 2:N[_].call(this,d,arguments[1]);break;case 3:N[_].call(this,d,arguments[1],arguments[2]);break;default:N[_].apply(this,arguments)}if(y)N=[],U.call(this,N,g,this.listenerTree,0,w);else if(N=this._events[d],typeof N=="function"){switch(this.event=d,k){case 1:N.call(this);break;case 2:N.call(this,arguments[1]);break;case 3:N.call(this,arguments[1],arguments[2]);break;default:for(b=new Array(k-1),$=1;$<k;$++)b[$-1]=arguments[$];N.apply(this,b)}return!0}else N&&(N=N.slice());if(N&&N.length){if(k>3)for(b=new Array(k-1),$=1;$<k;$++)b[$-1]=arguments[$];for(_=0,w=N.length;_<w;_++)switch(this.event=d,k){case 1:N[_].call(this);break;case 2:N[_].call(this,arguments[1]);break;case 3:N[_].call(this,arguments[1],arguments[2]);break;default:N[_].apply(this,b)}return!0}else if(!this.ignoreErrors&&!this._all&&d==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},B.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||v.call(this);var d=arguments[0],g=this.wildcard,y,b,w,_,$,I;if(d==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(g&&(y=d,d!=="newListener"&&d!=="removeListener"&&typeof d=="object")){if(_=d.length,l){for($=0;$<_;$++)if(typeof d[$]=="symbol"){b=!0;break}}b||(d=d.join(this.delimiter))}var k=[],N=arguments.length,F;if(this._all)for($=0,_=this._all.length;$<_;$++)switch(this.event=d,N){case 1:k.push(this._all[$].call(this,d));break;case 2:k.push(this._all[$].call(this,d,arguments[1]));break;case 3:k.push(this._all[$].call(this,d,arguments[1],arguments[2]));break;default:k.push(this._all[$].apply(this,arguments))}if(g?(F=[],U.call(this,F,y,this.listenerTree,0)):F=this._events[d],typeof F=="function")switch(this.event=d,N){case 1:k.push(F.call(this));break;case 2:k.push(F.call(this,arguments[1]));break;case 3:k.push(F.call(this,arguments[1],arguments[2]));break;default:for(w=new Array(N-1),I=1;I<N;I++)w[I-1]=arguments[I];k.push(F.apply(this,w))}else if(F&&F.length){if(F=F.slice(),N>3)for(w=new Array(N-1),I=1;I<N;I++)w[I-1]=arguments[I];for($=0,_=F.length;$<_;$++)switch(this.event=d,N){case 1:k.push(F[$].call(this));break;case 2:k.push(F[$].call(this,arguments[1]));break;case 3:k.push(F[$].call(this,arguments[1],arguments[2]));break;default:k.push(F[$].apply(this,w))}}else if(!this.ignoreErrors&&!this._all&&d==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(k)},B.prototype.on=function(d,g,y){return this._on(d,g,!1,y)},B.prototype.prependListener=function(d,g,y){return this._on(d,g,!0,y)},B.prototype.onAny=function(d){return this._onAny(d,!1)},B.prototype.prependAny=function(d){return this._onAny(d,!0)},B.prototype.addListener=B.prototype.on,B.prototype._onAny=function(d,g){if(typeof d!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),g?this._all.unshift(d):this._all.push(d),this},B.prototype._on=function(d,g,y,b){if(typeof d=="function")return this._onAny(d,g),this;if(typeof g!="function")throw new Error("on only accepts instances of Function");this._events||v.call(this);var w=this,_;return b!==n&&(_=Ze.call(this,d,g,b),g=_[0],w=_[1]),this._newListener&&this.emit("newListener",d,g),this.wildcard?(pe.call(this,d,g,y),w):(this._events[d]?(typeof this._events[d]=="function"&&(this._events[d]=[this._events[d]]),y?this._events[d].unshift(g):this._events[d].push(g),!this._events[d].warned&&this._maxListeners>0&&this._events[d].length>this._maxListeners&&(this._events[d].warned=!0,x.call(this,this._events[d].length,d))):this._events[d]=g,w)},B.prototype.off=function(d,g){if(typeof g!="function")throw new Error("removeListener only takes instances of Function");var y,b=[];if(this.wildcard){var w=typeof d=="string"?d.split(this.delimiter):d.slice();if(b=U.call(this,null,w,this.listenerTree,0),!b)return this}else{if(!this._events[d])return this;y=this._events[d],b.push({_listeners:y})}for(var _=0;_<b.length;_++){var $=b[_];if(y=$._listeners,o(y)){for(var I=-1,k=0,N=y.length;k<N;k++)if(y[k]===g||y[k].listener&&y[k].listener===g||y[k]._origin&&y[k]._origin===g){I=k;break}if(I<0)continue;return this.wildcard?$._listeners.splice(I,1):this._events[d].splice(I,1),y.length===0&&(this.wildcard?delete $._listeners:delete this._events[d]),this._removeListener&&this.emit("removeListener",d,g),this}else(y===g||y.listener&&y.listener===g||y._origin&&y._origin===g)&&(this.wildcard?delete $._listeners:delete this._events[d],this._removeListener&&this.emit("removeListener",d,g))}return this.listenerTree&&ge(this.listenerTree),this},B.prototype.offAny=function(d){var g=0,y=0,b;if(d&&this._all&&this._all.length>0){for(b=this._all,g=0,y=b.length;g<y;g++)if(d===b[g])return b.splice(g,1),this._removeListener&&this.emit("removeListenerAny",d),this}else{if(b=this._all,this._removeListener)for(g=0,y=b.length;g<y;g++)this.emit("removeListenerAny",b[g]);this._all=[]}return this},B.prototype.removeListener=B.prototype.off,B.prototype.removeAllListeners=function(d){if(d===n)return!this._events||v.call(this),this;if(this.wildcard){var g=U.call(this,null,d,this.listenerTree,0),y,b;if(!g)return this;for(b=0;b<g.length;b++)y=g[b],y._listeners=null;this.listenerTree&&ge(this.listenerTree)}else this._events&&(this._events[d]=null);return this},B.prototype.listeners=function(d){var g=this._events,y,b,w,_,$;if(d===n){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!g)return[];for(y=c(g),_=y.length,w=[];_-- >0;)b=g[y[_]],typeof b=="function"?w.push(b):w.push.apply(w,b);return w}else{if(this.wildcard){if($=this.listenerTree,!$)return[];var I=[],k=typeof d=="string"?d.split(this.delimiter):d.slice();return U.call(this,I,k,$,0),I}return g?(b=g[d],b?typeof b=="function"?[b]:b:[]):[]}},B.prototype.eventNames=function(d){var g=this._events;return this.wildcard?re.call(this,this.listenerTree,[],null,d):g?c(g):[]},B.prototype.listenerCount=function(d){return this.listeners(d).length},B.prototype.hasListeners=function(d){if(this.wildcard){var g=[],y=typeof d=="string"?d.split(this.delimiter):d.slice();return U.call(this,g,y,this.listenerTree,0),g.length>0}var b=this._events,w=this._all;return!!(w&&w.length||b&&(d===n?c(b).length:b[d]))},B.prototype.listenersAny=function(){return this._all?this._all:[]},B.prototype.waitFor=function(d,g){var y=this,b=typeof g;return b==="number"?g={timeout:g}:b==="function"&&(g={filter:g}),g=E(g,{timeout:0,filter:n,handleError:!1,Promise,overload:!1},{filter:L,Promise:M}),T(g.Promise,function(w,_,$){function I(){var k=g.filter;if(!(k&&!k.apply(y,arguments)))if(y.off(d,I),g.handleError){var N=arguments[0];N?_(N):w(C.apply(null,arguments).slice(1))}else w(C.apply(null,arguments))}$(function(){y.off(d,I)}),y._on(d,I,!1)},{timeout:g.timeout,overload:g.overload})};function Te(d,g,y){y=E(y,{Promise,timeout:0,overload:!1},{Promise:M});var b=y.Promise;return T(b,function(w,_,$){var I;if(typeof d.addEventListener=="function"){I=function(){w(C.apply(null,arguments))},$(function(){d.removeEventListener(g,I)}),d.addEventListener(g,I,{once:!0});return}var k=function(){N&&d.removeListener("error",N),w(C.apply(null,arguments))},N;g!=="error"&&(N=function(F){d.removeListener(g,k),_(F)},d.once("error",N)),$(function(){N&&d.removeListener("error",N),d.removeListener(g,k)}),d.once(g,k)},{timeout:y.timeout,overload:y.overload})}var ye=B.prototype;Object.defineProperties(B,{defaultMaxListeners:{get:function(){return ye._maxListeners},set:function(d){if(typeof d!="number"||d<0||Number.isNaN(d))throw TypeError("n must be a non-negative number");ye._maxListeners=d},enumerable:!0},once:{value:Te,writable:!0,configurable:!0}}),Object.defineProperties(ye,{_maxListeners:{value:s,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),typeof n=="function"||(t.exports=B)})()}(vn)),vn.exports}var Yl=Wl(),Cs=Qr(Yl);function Ss(t,e=[]){return new Proxy(t,{get(n,i){if(i==="$path")return`settings.${e.join(".")}`;const o=e.length>0?`settings.${e.join(".")}`:"settings";if(i==="$all"||i==="$deep")return`${o}.**`;if(i==="$children")return`${o}.*`;const s=n[i];if(typeof s!="object"||s===null){const r=`settings.${[...e,i].join(".")}`;return{$path:r,$all:`${r}.**`,$deep:`${r}.**`,$children:`${r}.*`,toString:()=>r,valueOf:()=>r}}return Ss(s,[...e,i])}})}function $s(t,e,n=[]){return new Proxy(e,{get(i,o){if(o==="toJSON")return()=>i;const s=i[o];return typeof s=="object"&&s!==null?$s(t,s,[...n,o]):s},set(i,o,s){const r=i[o];i[o]=s;const l=[...n,o].join(".");return t.emitter?.emit(`settings.${l}`,{eventName:`settings.${l}`,oldValue:r,newValue:s}),!0},deleteProperty(i,o){const s=i[o],r=o in i;if(delete i[o],r){const l=[...n,o].join(".");t.emitter?.emit(`settings.${l}`,{eventName:`settings.${l}`,operation:"delete",oldValue:s,newValue:void 0})}return!0}})}let Kl=class extends R.Component{constructor(e){super(),this.plugin=e,this.emitter=new Cs({wildcard:!0,delimiter:"."}),this.setupEvents()}dirty=!1;get $(){return this.data}async load(){const e=await this.plugin.loadData()??{},n=xs(Gl(),e);this.data=$s(this,{...n},[]),this.$$=Ss(n)}async save(){return this.saveTimeout&&clearTimeout(this.saveTimeout),this.savePromise??=new Promise(e=>{this.saveResolve=e}),this.saveTimeout=setTimeout(async()=>{try{await this.plugin.saveData(this.$),this.dirty=!1}catch(e){this.plugin.logger.error(`Settings save failed: ${e.message}`,{functionName:"anonymous",lineNumber:62,columnNumber:1994,fileName:"src/settings/settings.ts"})}finally{this.savePromise=void 0,this.saveResolve?.(),this.saveResolve=void 0,this.saveTimeout=void 0}},50),this.savePromise}async reset(){const e=this.plugin.manifest.dir;if(!e)throw new Error("Image Zoom & Drag: `No plugin dir found`");const n=R.normalizePath(`${e}/data.json`);await this.plugin.app.vault.adapter.exists(n)&&await this.plugin.app.vault.adapter.remove(n),await this.load()}setupEvents(){this.emitter.on("**",()=>this.dirty=!0)}async onunload(){super.onunload(),this.emitter.removeAllListeners(),this.saveTimeout&&(clearTimeout(this.saveTimeout),this.saveTimeout=void 0),this.dirty&&this.savePromise?await this.savePromise:this.dirty&&(await this.plugin.saveData(this.$),this.dirty=!1),this.savePromise=void 0}};const ks=ze(void 0),ql=({app:t,plugin:e,children:n})=>{const[i,o]=z(0),[s,r]=z("/images"),l=le(()=>{o(u=>u+1)},[]),h=ce(()=>({app:t,plugin:e,forceReload:l,reloadCount:i,currentPath:s,setCurrentPath:r}),[t,e,l,i,s,r]);return a(ks.Provider,{value:h,children:n})},se=()=>{const t=ke(ks);if(t===void 0)throw new Error("useSettingsContext must be used within a SettingProvider");return t};function Zl(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var n,i,o,s,r=[],l="",h=t.split("/");for(h[0]||h.shift();o=h.shift();)n=o[0],n==="*"?(r.push(n),l+=o[1]==="?"?"(?:/(.*))?":"/(.*)"):n===":"?(i=o.indexOf("?",1),s=o.indexOf(".",1),r.push(o.substring(1,~i?i:~s?s:o.length)),l+=~i&&!~s?"(?:/([^/]+?))?":"/([^/]+?)",~s&&(l+=(~i?"?":"")+"\\"+o.substring(s))):l+="/"+o;return{keys:r,pattern:new RegExp("^"+l+(e?"(?=$|/)":"/?$"),"i")}}var yn={exports:{}},bn={},Xl=ea(Pr),qi;function Jl(){if(qi)return bn;qi=1;var t=Xl;function e(c,v){return c===v&&(c!==0||1/c===1/v)||c!==c&&v!==v}var n=typeof Object.is=="function"?Object.is:e,i=t.useState,o=t.useEffect,s=t.useLayoutEffect,r=t.useDebugValue;function l(c,v){var m=v(),x=i({inst:{value:m,getSnapshot:v}}),C=x[0].inst,P=x[1];return s(function(){C.value=m,C.getSnapshot=v,h(C)&&P({inst:C})},[c,m,v]),o(function(){return h(C)&&P({inst:C}),c(function(){h(C)&&P({inst:C})})},[c]),r(m),m}function h(c){var v=c.getSnapshot;c=c.value;try{var m=v();return!n(c,m)}catch{return!0}}function u(c,v){return v()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:l;return bn.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:p,bn}var Zi;function Ql(){return Zi||(Zi=1,yn.exports=Jl()),yn.exports}var Rn=Ql();const ec=qt,tc=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",nc=tc?$e:Z,ic=ec||nc,Es=t=>{const e=he([t,(...n)=>e[0](...n)]).current;return ic(()=>{e[0]=t}),e[1]},oc="popstate",li="pushState",ci="replaceState",sc="hashchange",Xi=[oc,li,ci,sc],rc=t=>{for(const e of Xi)addEventListener(e,t);return()=>{for(const e of Xi)removeEventListener(e,t)}},Ns=(t,e)=>Rn.useSyncExternalStore(rc,t,e),ac=()=>location.search,lc=({ssrSearch:t=""}={})=>Ns(ac,()=>t),Ji=()=>location.pathname,cc=({ssrPath:t}={})=>Ns(Ji,t?()=>t:Ji),uc=(t,{replace:e=!1,state:n=null}={})=>history[e?ci:li](n,"",t),dc=(t={})=>[cc(t),uc],Qi=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[Qi]>"u"){for(const t of[li,ci]){const e=history[t];history[t]=function(){const n=e.apply(this,arguments),i=new Event(t);return i.arguments=arguments,dispatchEvent(i),n}}Object.defineProperty(window,Qi,{value:!0})}const hc=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",Ps=(t="")=>t==="/"?"":t,pc=(t,e)=>t[0]==="~"?t.slice(1):Ps(e)+t,gc=(t="",e)=>hc(eo(Ps(t)),eo(e)),eo=t=>{try{return decodeURI(t)}catch{return t}},Is={hook:dc,searchHook:lc,parser:Zl,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:t=>t},Ls=ze(Is),Nt=()=>ke(Ls),Ms={},Ds=ze(Ms),mc=()=>ke(Ds),rn=t=>{const[e,n]=t.hook(t);return[gc(t.base,e),Es((i,o)=>n(pc(i,t.base),o))]},an=()=>rn(Nt()),Ts=(t,e,n,i)=>{const{pattern:o,keys:s}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",i),r=o.exec(n)||[],[l,...h]=r;return l!==void 0?[!0,(()=>{const u=s!==!1?Object.fromEntries(s.map((c,v)=>[c,h[v]])):r.groups;let p={...h};return u&&Object.assign(p,u),p})(),...i?[l]:[]]:[!1,null]},As=({children:t,...e})=>{const n=Nt(),i=e.hook?Is:n;let o=i;const[s,r]=e.ssrPath?.split("?")??[];r&&(e.ssrSearch=r,e.ssrPath=s),e.hrefs=e.hrefs??e.hook?.hrefs;let l=he({}),h=l.current,u=h;for(let p in i){const c=p==="base"?i[p]+(e[p]||""):e[p]||i[p];h===u&&c!==u[p]&&(l.current=u={...u}),u[p]=c,(c!==i[p]||c!==o[p])&&(o=u)}return ue(Ls.Provider,{value:o,children:t})},to=({children:t,component:e},n)=>e?ue(e,{params:n}):typeof t=="function"?t(n):t,fc=t=>{let e=he(Ms);const n=e.current;return e.current=Object.keys(t).length!==Object.keys(n).length||Object.entries(t).some(([i,o])=>o!==n[i])?t:n},He=({path:t,nest:e,match:n,...i})=>{const o=Nt(),[s]=rn(o),[r,l,h]=n??Ts(o.parser,t,s,e),u=fc({...mc(),...l});if(!r)return null;const p=h?ue(As,{base:h},to(i,u)):to(i,u);return ue(Ds.Provider,{value:u,children:p})};$t((t,e)=>{const n=Nt(),[i,o]=rn(n),{to:s="",href:r=s,onClick:l,asChild:h,children:u,className:p,replace:c,state:v,...m}=t,x=Es(P=>{P.ctrlKey||P.metaKey||P.altKey||P.shiftKey||P.button!==0||(l?.(P),P.defaultPrevented||(P.preventDefault(),o(r,t)))}),C=n.hrefs(r[0]==="~"?r.slice(1):n.base+r,n);return h&&Ke(u)?Xt(u,{onClick:x,href:C}):ue("a",{...m,onClick:x,href:C,className:p?.call?p(i===r):p,children:u,ref:e})});const Os=t=>Array.isArray(t)?t.flatMap(e=>Os(e&&e.type===W?e.props.children:e)):[t],zs=({children:t,location:e})=>{const n=Nt(),[i]=rn(n);for(const o of Os(t)){let s=0;if(Ke(o)&&(s=Ts(n.parser,o.props.path,e||i,o.props.nest))[0])return Xt(o,{match:s})}return null};function vc(t){return{all:t=t||new Map,on:function(e,n){var i=t.get(e);i?i.push(n):t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&(n?i.splice(i.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var i=t.get(e);i&&i.slice().map(function(o){o(n)}),(i=t.get("*"))&&i.slice().map(function(o){o(e,n)})}}}const yc=({path:t="/",searchPath:e="",static:n,record:i}={})=>{let o=t;e&&(o+=t.split("?")[1]?"&":"?",o+=e);let[s,r=""]=o.split("?");const l=[o],h=vc(),u=(C,{replace:P=!1}={})=>{i&&(P?l.splice(l.length-1,1,C):l.push(C)),[s,r=""]=C.split("?"),h.emit("navigate",C)},p=n?()=>null:u,c=C=>(h.on("navigate",C),()=>h.off("navigate",C)),v=()=>[Rn.useSyncExternalStore(c,()=>s),p],m=()=>Rn.useSyncExternalStore(c,()=>r);function x(){l.splice(0,l.length),u(o)}return{hook:v,searchHook:m,navigate:p,history:i?l:void 0,reset:i?x:void 0}},bc=j.div.withConfig({displayName:"Aboutstyled__FooterContent",componentId:"sc-wll54m-0"})(["font-size:small;color:gray;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;margin-top:40px;padding:20px 0;"]),wc=j.div.withConfig({displayName:"Aboutstyled__Info",componentId:"sc-wll54m-1"})(["margin-bottom:12px;span{margin:0 4px;}"]),_c=j.div.withConfig({displayName:"Aboutstyled__Slogan",componentId:"sc-wll54m-2"})(["margin-bottom:12px;"]),xc=()=>{const{plugin:t}=se();return a(W,{children:[a(O,{name:f("I"),children:a("button",{"aria-label":f("H"),onClick:()=>{window.open("https://github.com/Ssentiago/image-zoom-drag/","_blank")},"data-icon":"github"})}),a(O,{name:"Help",children:a("button",{"data-icon":"message-circle-question","aria-label":"Open the help modal window",onClick:()=>t.help.showModal("full")})}),a(bc,{children:[a(_c,{children:"Make Obsidian images and diagrams interactive!"}),a(wc,{children:[t.manifest.version,a("span",{children:"\u2022"}),a("a",{href:"https://github.com/Ssentiago/image-zoom-drag/blob/main/LICENSE",target:"_blank",children:"Apache-2.0"}),a("span",{children:"\u2022"}),"by"," ",a("a",{href:"https://github.com/gitcpy",target:"_blank",children:"gitcpy"})," ","and"," ",a("a",{href:"https://github.com/Ssentiago",target:"_blank",children:"Ssentiago"})]})]})]})},Cc=()=>{const{plugin:t}=se(),[e,n]=z({storage:t.logger.getStorageUsage(),entries:t.logger.getAllLogs().length});Z(()=>{const l=h=>{n(h)};return t.emitter.on("logs-changed",l),()=>{t.emitter.off("logs-changed",l)}},[t]);const i=le(()=>{const l=t.logger.exportLogs(),h=new Blob([l],{type:"text/plain"}),u=URL.createObjectURL(h),p=document.createElement("a");p.href=u,p.download="izd-logs.txt",p.click(),URL.revokeObjectURL(u)},[t.logger]),o=le(async()=>{const l=t.logger.exportLogs();if(l.trim()===""){t.showNotice(f("R"));return}await navigator.clipboard.writeText(l),t.showNotice(f("S"))},[]),s=le(async()=>{const l=JSON.stringify(t.logger.getShortSystemInfo(),null,2),h=encodeURIComponent(`## Issue Description
[Describe your issue here]

## Steps to Reproduce
1. [First step]
2. [Second step]

## System info
${l}

`),u=`https://github.com/Ssentiago/image-zoom-drag/issues/new?title=${encodeURIComponent("[Bug Report] ")}&labels=bug&body=${h}`;window.open(u,"_blank")},[]),r=le(async()=>{t.logger.clearAllLogs(),t.showNotice(f("O"))},[]);return a(W,{children:[a(O,{name:f("$"),desc:f("Z"),children:a("button",{"aria-label":f("_"),onClick:s,"data-icon":"bug"})}),a(O,{name:f("U"),desc:f("T"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.debug.enabled,onChange:async l=>{t.settings.$.debug.enabled=l.currentTarget.checked,await t.settings.save()}})}),a(O,{name:f("Y"),desc:f("X"),children:a("select",{value:t.settings.$.debug.level,onChange:async l=>{t.settings.$.debug.level=l.target.value,await t.settings.save()},children:[a("option",{value:"none",children:"None"}),a("option",{value:"error",children:"Error"}),a("option",{value:"warn",children:"Warning"}),a("option",{value:"info",children:"Info"}),a("option",{value:"debug",children:"Debug"})]})}),a(O,{name:f("K"),desc:f("J")}),a(O,{name:f("W"),children:a("button",{"aria-label":f("V"),onClick:i,"data-icon":"download"})}),a(O,{name:f("Q"),children:a("button",{"aria-label":f("P"),onClick:o,"data-icon":"clipboard"})}),a(O,{name:f("N"),desc:ie(f("M"),{storage:e.storage,entries:e.entries.toString()}),children:a("button",{"aria-label":f("L"),onClick:r,"data-icon":"trash"})})]})},Sc=j.div.withConfig({displayName:"RoutesContentstyled__SRoutesContent",componentId:"sc-1720ji1-0"})(["position:relative;height:100%;width:100%;"]),$c=bs(["from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}"]),kc=j.div.withConfig({displayName:"RoutesContentstyled__SRoutesContainer",componentId:"sc-1720ji1-1"})(["> *{animation:"," 0.3s ease;}"],$c),Ec=({onClose:t,title:e})=>{const{plugin:n}=se(),[i,o]=z(!1),s=oe.useMemo(()=>{const{zoom:p,move:c,service:v}=n.settings.$.panels.local.panels;return{zoom:[{tooltip:f("y"),icon:"zoom-in",getValue:()=>p.buttons.in,setValue:m=>p.buttons.in=m},{tooltip:f("A"),icon:"zoom-out",getValue:()=>p.buttons.out,setValue:m=>p.buttons.out=m},{tooltip:f("B"),icon:"refresh-cw",getValue:()=>p.buttons.reset,setValue:m=>p.buttons.reset=m}],move:[{tooltip:f("o"),icon:"arrow-up",getValue:()=>c.buttons.up,setValue:m=>c.buttons.up=m},{tooltip:f("i"),icon:"arrow-down",getValue:()=>c.buttons.down,setValue:m=>c.buttons.down=m},{tooltip:f("l"),icon:"arrow-left",getValue:()=>c.buttons.left,setValue:m=>c.buttons.left=m},{tooltip:f("n"),icon:"arrow-right",getValue:()=>c.buttons.right,setValue:m=>c.buttons.right=m},{tooltip:f("q"),icon:"arrow-up-right",getValue:()=>c.buttons.upRight,setValue:m=>c.buttons.upRight=m},{tooltip:f("k"),icon:"arrow-down-right",getValue:()=>c.buttons.downRight,setValue:m=>c.buttons.downRight=m},{tooltip:f("p"),icon:"arrow-up-left",getValue:()=>c.buttons.upLeft,setValue:m=>c.buttons.upLeft=m},{tooltip:f("j"),icon:"arrow-down-left",getValue:()=>c.buttons.downLeft,setValue:m=>c.buttons.downLeft=m}],service:[{tooltip:f("v"),icon:"eye",getValue:()=>v.buttons.hide,setValue:m=>v.buttons.hide=m},{tooltip:f("r"),icon:"fullscreen",getValue:()=>v.buttons.fullscreen,setValue:m=>v.buttons.fullscreen=m}]}},[n]),r={zoom:f("z"),move:f("m"),service:f("x")},l=he(!1),h={minimal:{zoom:{in:!0,out:!0,reset:!1},move:{up:!1,down:!1,left:!1,right:!1,upRight:!1,downRight:!1,upLeft:!1,downLeft:!1},service:{hide:!0,fullscreen:!1}},full:{zoom:{in:!0,out:!0,reset:!0},move:{up:!0,down:!0,left:!0,right:!0,upRight:!0,downRight:!0,upLeft:!0,downLeft:!0},service:{hide:!0,fullscreen:!0}},presentation:{zoom:{in:!0,out:!0,reset:!0},move:{up:!1,down:!1,left:!1,right:!1,upRight:!1,downRight:!1,upLeft:!1,downLeft:!1},service:{hide:!0,fullscreen:!0}}};Z(()=>{const p=async c=>{l.current||(n.settings.$.panels.local.preset="none",await n.settings.save(),o(v=>!v))};return n.settings.emitter.on(`${n.settings.$$.panels.local.panels.$all}`,p),()=>{n.settings.emitter.off(`${n.settings.$$.panels.local.panels.$all}`,p)}},[n,l]);const u=async p=>{l.current=!0;const{zoom:c,move:v,service:m}=n.settings.$.panels.local.panels,x=h[p];Object.assign(c.buttons,x.zoom),Object.assign(v.buttons,x.move),Object.assign(m.buttons,x.service),n.settings.$.panels.local.preset=p,await n.settings.save(),l.current=!1,o(C=>!C)};return a(ct,{title:e,onClose:t,children:[a(O,{name:f("aJ"),children:[a("button",{className:n.settings.$.panels.local.preset==="minimal"?"button-active":"",onClick:()=>u("minimal"),children:f("aH")}),a("button",{className:n.settings.$.panels.local.preset==="full"?"button-active":"",onClick:()=>u("full"),children:f("aG")}),a("button",{className:n.settings.$.panels.local.preset==="presentation"?"button-active":"",onClick:()=>u("presentation"),children:f("aI")})]}),Object.entries(s).map(([p,c])=>a(oe.Fragment,{children:[a(O,{name:r[p],heading:!0}),c.map(({tooltip:v,icon:m,getValue:x,setValue:C},P)=>a(O,{name:v,noBorder:P!==c.length-1,children:[a("button",{"aria-label":v,"data-icon":m}),a("input",{type:"checkbox",checked:x(),onChange:async S=>{C(S.target.checked)}})]},v))]},p))]})},Nc=j.div.withConfig({displayName:"PanelLayoutstyled__UnitSetup",componentId:"sc-1fhufom-0"})(["display:flex;flex-direction:column;gap:20px;"]),Pc=j.div.withConfig({displayName:"PanelLayoutstyled__UnitPreview",componentId:"sc-1fhufom-1"})(["position:relative;width:400px;height:300px;border:2px solid var(--color-base-30);margin:0 auto;"]),Rs=j.div.withConfig({displayName:"PanelLayoutstyled__PanelPreview",componentId:"sc-1fhufom-2"})(["position:absolute;width:60px;height:40px;padding:8px;background:var(--color-base-20);border-radius:4px;font-size:0.9em;display:flex;align-items:center;justify-content:center;user-select:none;cursor:move;opacity:",";transition:","}"],({dragging:t})=>t?.5:1,({dragging:t})=>t?"all 0.3s ease":"none"),Ic=j(Rs).withConfig({displayName:"PanelLayoutstyled__FoldPanel",componentId:"sc-1fhufom-3"})(["position:absolute;bottom:0;left:50%;transform:translateX(-50%);pointer-events:none;text-align:justify;"]),Lc=j.div.withConfig({displayName:"PanelLayoutstyled__PanelControl",componentId:"sc-1fhufom-4"})(["display:flex;justify-content:center;gap:20px;"]),Mc=j.div.withConfig({displayName:"PanelLayoutstyled__PanelToggle",componentId:"sc-1fhufom-5"})(["display:flex;flex-direction:column;align-items:center;font-size:0.9em;"]),wn=(t,e,n)=>{const i=(C,P,S)=>C<=30?{top:"0px"}:S-P<=30?{bottom:"0px"}:{top:`${(C/S*100).toFixed(1)}%`},o=(C,P,S)=>C<=30?{left:"0px"}:S-P<=30?{right:"0px"}:{left:`${(C/S*100).toFixed(1)}%`},s={},r=t,l=t+60,h=e,u=e+40,p=r,c=n.width-l,v=h,m=n.height-u,x=[{edge:"left",value:p},{edge:"right",value:c},{edge:"top",value:v},{edge:"bottom",value:m}].reduce((C,P)=>Math.abs(C.value)<Math.abs(P.value)?C:P);if(Math.abs(x.value)<=30)switch(x.edge){case"left":s.left="0px",Object.assign(s,i(h,u,n.height));break;case"right":s.right="0px",Object.assign(s,i(h,u,n.height));break;case"top":s.top="0px",Object.assign(s,o(r,l,n.width));break;case"bottom":s.bottom="0px",Object.assign(s,o(r,l,n.width));break}else s.left=`${(r/n.width*100).toFixed(1)}%`,s.top=`${(h/n.height*100).toFixed(1)}%`;return s},Dc=({unitPreviewRef:t,panels:e})=>{const{plugin:n}=se(),[i,o]=z(null),s=(c,v)=>{const m=c.currentTarget.getBoundingClientRect(),x=c.clientX-m.left,C=c.clientY-m.top;c.dataTransfer.setData("application/json",JSON.stringify({panelName:v,offsetX:x,offsetY:C})),o(v)},r=async c=>{if(c.preventDefault(),!t.current)return;const v=t.current.getBoundingClientRect(),m=JSON.parse(c.dataTransfer.getData("application/json")),x=c.clientX-v.left-m.offsetX,C=c.clientY-v.top-m.offsetY,P=wn(x,C,v),S=m.panelName;e[S].position=P,o(null),await n.settings.save()},l=(c,v)=>{const m=c.touches[0],x=c.target,C=x.getBoundingClientRect(),P=m.clientX-C.left,S=m.clientY-C.top;o(v),x.dataset.dragData=JSON.stringify({panelName:v,offsetX:P,offsetY:S})},h=c=>{const v=t.current;if(!v||i)return;c.preventDefault();const m=c.touches[0],x=c.currentTarget,C=JSON.parse(x.dataset.dragData??"{}"),P=v.getBoundingClientRect(),S=m.clientX-P.left-C.offsetX,E=m.clientY-P.top-C.offsetY,M=wn(S,E,P);x.style.left=M.left,x.style.top=M.top},u=async c=>{const v=t.current;if(!v||!i)return;const m=c.currentTarget,x=JSON.parse(m.dataset.dragData??"{}"),C=c.changedTouches[0],P=v.getBoundingClientRect(),S=C.clientX-P.left-x.offsetX,E=C.clientY-P.top-x.offsetY,M=wn(S,E,P),A=x.panelName;e[A].position=M,o(null),await n.settings.save()},p=R.Platform.isDesktopApp?{panel:c=>({draggable:!0,onDragStart:v=>s(v,c)}),container:{onDrop:r,onDragOver:c=>c.preventDefault()}}:{panel:c=>({onTouchStart:v=>l(v,c),onTouchMove:v=>h(v),onTouchEnd:v=>u(v)}),container:{}};return{draggedPanel:i,props:p}},Tc=()=>{const{plugin:t}=se(),[e,n]=z(t.settings.$.panels.local.panels),i=ce(()=>({zoom:f("z"),move:f("m"),service:f("x"),fold:f("h")}),[]),[,o]=z(!1),s=oe.useRef(null),{draggedPanel:r,props:l}=Dc({unitPreviewRef:s,panels:e});Z(()=>{const u=p=>{o(c=>!c)};return t.settings.emitter.on(t.settings.$$.panels.local.panels.$all,u),()=>{t.settings.emitter.off(t.settings.$$.panels.local.panels.$all,u)}},[]);const h=async u=>{e[u].on=!e[u].on,await t.settings.save()};return a(Nc,{children:[a(Pc,{ref:s,onDragOver:u=>u.preventDefault(),...l.container,children:[Object.entries(e).map(([u,p])=>p.on&&a(Rs,{dragging:r===u,...l.panel(u),style:{...p.position},children:i[u]},u)),a(Ic,{children:i.fold})]}),a(Lc,{className:"control",children:Object.entries(e).map(([u,p])=>a(Mc,{children:a(O,{name:i[u],children:a("input",{type:"checkbox",checked:p.on,onChange:()=>h(u)})})},u))})]})},Ac=({onClose:t,title:e})=>a(ct,{onClose:t,title:e,children:[a(O,{name:f("aT"),desc:f("aS"),heading:!0,noBorder:!0}),a(O,{name:f("aP"),desc:f("aO"),noBorder:!0}),a(O,{name:f("aR"),desc:f("aQ")}),a(Tc,{})]}),Oc=()=>{const[t,e]=oe.useState(!1),[n,i]=oe.useState(!1);return a(W,{children:[a(O,{name:f("aV"),desc:f("aN"),children:a("button",{"aria-label":f("aW"),onClick:()=>{e(!0)},"data-icon":"layout"})}),a(O,{name:f("aL"),desc:f("aF"),children:a("button",{"aria-label":f("aM"),onClick:()=>{i(!0)},"data-icon":"panels-top-left"})}),t&&a(Ac,{onClose:()=>e(!1),title:f("aU")}),n&&a(Ec,{onClose:()=>i(!1),title:f("aK")})]})},zc=()=>{const{plugin:t}=se(),[e,n]=z(t.settings.$.panels.global.triggering.mode!==We.ALWAYS),i=ce(()=>({always:f("ah"),hover:f("aj"),focus:f("ai")}),[t]),[o,s]=z(i[t.settings.$.panels.global.triggering.mode]),r=le(l=>{const h=l.value,u=i[h];s(u)},[t]);return a(W,{children:[a(O,{name:f("ag"),desc:f("ac"),children:[a("select",{value:t.settings.$.panels.global.triggering.mode,onChange:async l=>{const h=l.target.value;t.settings.$.panels.global.triggering.mode=h,n(h!==We.ALWAYS),r(l.target),await t.settings.save()},children:[a("option",{value:"always",children:f("ad")}),a("option",{value:"hover",children:f("af")}),a("option",{value:"focus",children:f("ae")})]}),a("button",{"aria-label":o,"data-icon":"message-circle-question"})]}),e&&a(O,{name:f("ab"),desc:f("aa"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.panels.global.triggering.ignoreService,onChange:async l=>{t.settings.$.panels.global.triggering.ignoreService=l.target.checked,await t.settings.save()}})})]})},Rc=()=>a(W,{children:[a(zc,{}),a(Oc,{})]}),Fc=()=>{const{plugin:t}=se();return a(W,{children:[a(O,{name:"Context menu",heading:!0}),a(O,{name:"Show context menu for diagrams",desc:"Toggle whether to show context menu for diagrams (svg and img generated from the codeblock)",children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.contextMenu.showForDiagrams,onChange:async e=>{t.settings.$.units.contextMenu.showForDiagrams=e.target.checked,await t.settings.save()}})}),a(O,{name:"Show context menu for other images",desc:"Toggle whether to show context menu for other images elements (i.e. local or external)",children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.contextMenu.showForOtherImages,onChange:async e=>{t.settings.$.units.contextMenu.showForOtherImages=e.target.checked,await t.settings.save()}})})]})},Uc=()=>{const{plugin:t}=se();return a(W,{children:[a(O,{name:f("am"),heading:!0}),a(O,{name:f("al"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.folding.foldByDefault,onChange:async e=>{t.settings.$.units.folding.foldByDefault=e.target.checked,await t.settings.save()}})}),a(O,{name:f("ak"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.folding.autoFoldOnFocusChange,onChange:async e=>{t.settings.$.units.folding.autoFoldOnFocusChange=e.target.checked,await t.settings.save()}})})]})},jc=()=>{const{plugin:t}=se();return a(W,{children:[a(O,{name:f("ap"),heading:!0}),a(O,{name:f("ar"),desc:f("aq"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.interactivity.picker.enabled,onChange:async e=>{t.settings.$.units.interactivity.picker.enabled=e.target.checked,await t.settings.save()}})}),a(O,{name:f("ao"),desc:f("an"),children:a("input",{type:"checkbox",defaultChecked:t.settings.$.units.interactivity.markdown.autoDetect,onChange:async e=>{const n=e.target.checked;t.settings.$.units.interactivity.markdown.autoDetect=n,await t.settings.save()}})})]})};var Oe=(t=>(t.Folded="folded",t.Expanded="expanded",t))(Oe||{});const Fn={px:{min:100,max:1e3,label:"px",rangeMessage:"100-1000px"},"%":{min:10,max:100,label:"%",rangeMessage:"10-100%"}},no=(t,e)=>{const n=parseInt(t,10),{min:i,max:o}=Fn[e];return n>=i&&n<=o},io=(t,e)=>{const n=e==="px"?Fn.px.rangeMessage:Fn["%"].rangeMessage;switch(t){case"width":return ie(f("aC"),{range:n});case"height":return ie(f("aB"),{range:n})}},oo=({type:t,initialOptions:e,border:n})=>{const{plugin:i}=se(),[o,s]=z(e.height.type),[r,l]=z(e.width.type),[h,u]=z(e.height.value.toString()),[p,c]=z(e.width.value.toString()),[v,m]=z(""),[x,C]=z("");he(null);const P=le(()=>{switch(t){case Oe.Expanded:return f("at");case Oe.Folded:return f("av")}},[t]);le(()=>{switch(t){case Oe.Expanded:return f("as");case Oe.Folded:return f("au")}},[t]);const S=(T,G)=>no(T,G)?(m(""),!0):(m(io("height",G)),!1),E=(T,G)=>no(T,G)?(C(""),!0):(C(io("width",G)),!1),M=le((T,G,U)=>{G==="height"?S(T,U):E(T,U)},[]);Z(()=>{M(p,"width",r),M(h,"height",o)},[r,o]);const A=async()=>{const T=S(h,o),G=E(p,r);if(!T||!G){i.showNotice(f("aA"));return}const U=parseInt(p,10),pe=parseInt(h,10);if(U===e.width.value&&pe===e.height.value&&r===e.width.type&&o===e.height.type){i.showNotice(f("aD"));return}e.width.value=U,e.height.value=pe,e.width.type=r,e.height.type=o,t===Oe.Folded?i.settings.$.units.size.folded=e:i.settings.$.units.size.expanded=e,await i.settings.save(),i.showNotice(f("aE"))},L=async T=>{T.code==="Enter"&&(T.preventDefault(),await A())},D=(T,G,U,pe,re,ge,qe,Ze)=>{const B=a(W,{children:[a("label",{htmlFor:G,children:T}),a("input",{id:G,type:"text",value:U,className:pe.trim()?"invalid":"","aria-label":pe||re==="px"?"100-1000px":"10-100%",onChange:Te=>{const ye=Te.target.value.replace(/\D/,"");Te.target.value=ye,ge(ye),Ze(ye,re)},onKeyDown:L}),a("select",{value:re,onChange:Te=>{const ye=Te.target.value;qe(ye),Ze(U,ye)},children:[a("option",{value:"px",children:"px"}),a("option",{value:"%",children:"%"})]})]});return R.Platform.isMobile?a(O,{noBorder:!0,children:B}):B};return a(W,{children:[a(O,{name:P(),noBorder:!0}),R.Platform.isMobile?a(W,{children:[D(f("ax"),"height-input",h,v,o,u,s,S),D(f("ay"),"width-input",p,x,r,c,l,E),a(O,{children:a("button",{"aria-label":f("az"),onClick:A,"data-icon":"save"})})]}):a(O,{children:[D(f("ax"),"height-input",h,v,o,u,s,S),D(f("ay"),"width-input",p,x,r,c,l,E),a("button",{"aria-label":f("az"),onClick:A,"data-icon":"save"})]})]})},Bc=()=>{const{plugin:t}=se();return a(W,{children:[a(O,{name:f("aw"),heading:!0}),a(oo,{type:Oe.Expanded,initialOptions:t.settings.$.units.size.expanded}),a(oo,{type:Oe.Folded,initialOptions:t.settings.$.units.size.folded,border:!0})]})},so=()=>a(W,{children:[a(jc,{}),a(Bc,{}),a(Uc,{}),a(Fc,{})]}),Hc=(t,e)=>{const{plugin:n}=se(),[i,o]=z(!1),[s,r]=z(!1),[l,h]=z([]),[u,p]=z([]),[c,v]=z(""),[m,x]=z("");Z(()=>{if(l.length>0){const L=l[l.length-1];v(L.description)}else v("");if(u.length>0){const L=u[u.length-1];x(L.description)}else x("")},[l,u]);const C=()=>{if(!c)return f("bU");const L=l.length>1?` (${l.length-1} more)`:"";return ie(f("bT"),{description:c,count:L})},P=()=>{if(!m)return f("bS");const L=u.length>1?` (${u.length-1} more)`:"";return ie(f("bR"),{description:m,count:L})};Z(()=>{const L=async()=>{h([]),p([]),o(!1),r(!1)};return n.settings.emitter.on("settings-reset",L),n.settings.emitter.on("settings-clear-history",L),()=>{n.settings.emitter.off("settings-reset",L),n.settings.emitter.off("settings-clear-history",L)}},[]);const S=(L,D)=>{let T=[...l];T.push({description:D,state:L}),o(!0),T.length>50&&(T=[...T.slice(-49)]),h(T),p([]),r(!1)},E=L=>{const D=[...u,L];p(D),r(!0)},M=async()=>{if(l.length>0){const L=l[l.length-1];E({state:[...t],description:L.description}),await e([...L.state]);const D=l.slice(0,-1);h(D),o(D.length>0)}},A=async()=>{if(u.length>0){const L=u[u.length-1],D=[...l,{state:[...t],description:L.description}];h(D);const T=u.slice(0,-1);p(T),await e([...L.state]),o(!0),r(T.length>0)}};return Z(()=>{const L=async D=>{D.code!=="KeyZ"&&D.code!=="KeyY"||((D.ctrlKey||D.metaKey)&&D.shiftKey?(D.preventDefault(),s?await A():n.showNotice(f("bP"))):(D.ctrlKey||D.metaKey)&&(D.preventDefault(),i?await M():n.showNotice(f("bQ"))),D.code==="KeyY"&&(D.ctrlKey||D.metaKey)&&!D.shiftKey&&(D.preventDefault(),await A()))};return window.addEventListener("keydown",L,!0),()=>{window.removeEventListener("keydown",L,!0)}},[M,A]),{updateUndoStack:S,undo:M,redo:A,canUndo:i,canRedo:s,getRedoLabel:P,getUndoLabel:C}},Vc=()=>{const t=ze(void 0);return{HistoryProvider:({state:e,updateState:n,children:i})=>{const{undo:o,canUndo:s,redo:r,canRedo:l,getRedoLabel:h,getUndoLabel:u,updateUndoStack:p}=Hc(e,n),{plugin:c}=se(),v=ce(()=>({undo:o,canUndo:s,redo:r,canRedo:l,getRedoLabel:h,getUndoLabel:u,updateUndoStack:p}),[o,s,r,l,h,u,p]);return Z(()=>()=>{c.settings.emitter.emit("settings-clear-history",{eventName:"settings-clear-history",oldValue:void 0,newValue:void 0})},[c]),a(t.Provider,{value:v,children:i})},useHistoryContext:()=>{const e=ke(t);if(e===void 0)throw new Error("useUndoRedoContext must be used within a UndoRedoProvider");return e}}},Fs=Vc(),ui=Fs.useHistoryContext,Gc=Fs.HistoryProvider,Wc=()=>{const{plugin:t}=se(),[e,n]=z(t.settings.$.units.configs);Z(()=>{const o=()=>{n(t.settings.$.units.configs)};return t.settings.emitter.on(t.settings.$$.units.configs.$path,o),()=>{t.settings.emitter.off(t.settings.$$.units.configs.$path,o)}},[t]);const i=le(async o=>{n(o),t.settings.$.units.configs=o,await t.settings.save()},[t]);return{units:e,saveUnits:i}},Us=ze(void 0),Yc=({children:t})=>{const{units:e,saveUnits:n}=Wc(),i=ce(()=>({units:e,saveUnits:n}),[e,n]);return a(Us.Provider,{value:i,children:t})},dt=()=>{const t=ke(Us);if(t===void 0)throw new Error("useUnitsManagerContext must be used within a UnitsManagerProvider");return t},di=()=>{const{plugin:t}=se(),{units:e}=dt(),[n,i]=z(new Set),[o,s]=z(new Set),r=p=>{const c={names:[],selectors:[]};p.forEach(v=>{c.names.push(v.name),c.selectors.push(v.selector)}),i(new Set(c.names)),s(new Set(c.selectors))};Z(()=>{r(t.settings.$.units.configs);const p=c=>{r(e)};return t.settings.emitter.on(t.settings.$$.units.configs.$path,p),()=>{t.settings.emitter.off(t.settings.$$.units.configs.$path,p)}},[e]);const l=p=>{try{return document.querySelector(p),{valid:!0,err:void 0}}catch(c){return{valid:!1,err:c.message.split(":").slice(1).join(":").trim()}}},h=(p,c)=>p.trim()?n.has(p)&&(!c||c.name!==p)?{valid:!1,tooltip:f("bY"),empty:!1}:{valid:!0,tooltip:"",empty:!1}:{empty:!0,tooltip:"",valid:!1},u=(p,c)=>{if(!p.trim())return{empty:!0,tooltip:"",valid:!1};const{valid:v,err:m}=l(p);return v?o.has(p)&&(!c||c.selector!==p)?{valid:!1,tooltip:f("b$"),empty:!1}:{valid:!0,tooltip:"",empty:!1}:{valid:!1,tooltip:ie(f("bX"),{err:m??""}),empty:!1}};return{validateBoth:(p,c,v)=>{const m=h(p,v),x=u(c,v),C=m.empty&&x.empty,P=(m.empty||x.empty)&&!C;return{nameResult:m,selectorResult:x,bothEmpty:C,oneEmpty:P}},validateName:h,validateSelector:u,processValidationOnSave:p=>{if(p.bothEmpty)return t.showNotice(f("bZ")),!1;if(p.oneEmpty){const m=p.nameResult.empty?"name":"selector";return t.showNotice(ie(f("bW"),{field:m})),!1}const c=!p.nameResult.valid&&!p.selectorResult.valid,v=!p.nameResult.valid||!p.selectorResult.valid;if(c)return t.showNotice(f("bV")),!1;if(v){const m=p.nameResult.valid?"selector":"name";return t.showNotice(ie(f("b_"),{field:m})),!1}return!0}}},Kc=()=>{const{plugin:t}=se(),e=ce(()=>t.manifest.dir,[t]),[n,i]=z(!0),[o,s]=z(""),r=async u=>{try{const p=await R.requestUrl("https://raw.githubusercontent.com/Ssentiago/image-zoom-drag/main/assets/videos/find-class.mp4");return p.status!==200?(t.logger.error(`Error downloading video: ${p.status}`,{functionName:"downloadVideo",lineNumber:21,columnNumber:779,fileName:"src/settings/ui/pages/images/presets/add-new-image-preset/modals/hooks/useUserGuideVideo.ts"}),!1):(await t.app.vault.adapter.writeBinary(u,p.arrayBuffer),!0)}catch(p){return t.logger.error(`Error downloading video: ${p.message}`,{functionName:"downloadVideo",lineNumber:33,columnNumber:1317,fileName:"src/settings/ui/pages/images/presets/add-new-image-preset/modals/hooks/useUserGuideVideo.ts"}),!1}},l=async()=>{const u=t.manifest.dir;if(!u)return!1;const p=R.normalizePath(`${u}/assets`),c=R.normalizePath(`${p}/user-guide-video.mp4`),v=await t.app.vault.adapter.exists(p),m=await t.app.vault.adapter.exists(c);return!v&&await t.app.vault.adapter.mkdir(p),m||await r(c),t.app.vault.adapter.exists(c)},h=he(R.normalizePath(`${e}/assets/user-guide-video.mp4`));return Z(()=>{(async()=>{i(!0);try{if(await l()){const u=await t.app.vault.adapter.readBinary(h.current),p=Buffer.from(u).toString("base64");s(`data:video/mp4;base64,${p}`)}else t.showNotice("The user guide video is not available.")}catch(u){console.error(u),t.showNotice("Something went wrong. The video is missing.")}finally{i(!1)}})()},[h]),{isLoading:n,videoUrl:o}},qc=({onClose:t})=>{const{isLoading:e,videoUrl:n}=Kc();return a(ct,{title:f("bh"),onClose:()=>t(),children:a(W,{children:[a(O,{name:f("bj"),desc:f("bi")}),a(O,{name:f("bn"),desc:f("bm")}),a(O,{name:f("bj"),desc:f("bi")}),a(O,{name:f("be"),heading:!0,desc:f("bd")}),a(O,{name:f("bg"),desc:f("bf")}),e&&a("p",{children:f("bl")}),!e&&n&&a("video",{src:n,controls:!0,autoPlay:!1,style:{width:"100%",maxHeight:"400px"}}),!e&&!n&&a("p",{children:f("bk")})]})})},Zc=()=>{const{plugin:t}=se(),[e,n]=z(!1),{validateSelector:i,validateBoth:o,validateName:s,processValidationOnSave:r}=di(),[l,h]=z(""),[u,p]=z(""),[c,v]=z(""),[m,x]=z(""),{units:C,saveUnits:P}=dt(),{updateUndoStack:S}=ui(),E=async()=>{debugger;const L=o(l,u);if(!r(L))return;const D=[...C],T={name:l,selector:u,on:!0,panels:{move:{on:!0},zoom:{on:!0},service:{on:!0}}},G=[...C,T];await P(G),S(D,ie(f("bc"),{name:T.name,selector:T.selector})),t.showNotice(f("aZ")),h(""),p("")},M=async L=>{L.code==="Enter"&&(L.preventDefault(),await E())},A=()=>{const L=()=>a("input",{id:"unit-name",type:"text",className:c.trim()?"invalid":"",placeholder:f("a_"),value:l,"aria-label":c,onChange:G=>{const U=G.target.value;h(U),s(U),v(s(l).tooltip)},onKeyDown:M}),D=()=>a("input",{id:"unit-selector",type:"text",value:u,className:m.trim()?"invalid":"","aria-label":m,placeholder:f("a$"),onChange:G=>{const U=G.target.value;p(U);const pe=i(U);x(pe.tooltip)},onKeyDown:M}),T=()=>a("button",{"aria-label":f("bb"),onClick:E,"data-icon":"save"});return R.Platform.isMobile?a(W,{children:[a(O,{noBorder:!0,children:L()}),a(O,{noBorder:!0,children:D()}),a(O,{noBorder:!0,children:T()})]}):a(O,{children:[L(),D(),T(),a("button",{"aria-label":f("ba"),onClick:()=>{n(!0)},"data-icon":"info"})]})};return a(W,{children:[a(O,{name:f("aY"),heading:!0,noBorder:!0,desc:f("aX")}),A(),e&&a(qc,{onClose:()=>n(!1)})]})},Xc=j.div.withConfig({displayName:"AvailableImageConfigsstyled__ButtonContainer",componentId:"sc-13jkgi2-0"})(["position:relative;display:flex;justify-content:center;align-items:center;gap:20px;margin-top:20px;margin-bottom:20px;padding-bottom:20px;&::after{content:'';position:absolute;left:0;right:0;bottom:0;height:1px;background-color:var(--color-base-30);margin-top:20px;}"]),ro=j.button.withConfig({displayName:"AvailableImageConfigsstyled__PaginationButton",componentId:"sc-13jkgi2-1"})(["&:disabled{background-color:var(--color-base-50);cursor:not-allowed;}"]),Jc=j.button.withConfig({displayName:"AvailableImageConfigsstyled__UndoButton",componentId:"sc-13jkgi2-2"})(["margin-right:auto;&:disabled{background-color:var(--color-base-50);cursor:not-allowed;}"]),Qc=j.button.withConfig({displayName:"AvailableImageConfigsstyled__RedoButton",componentId:"sc-13jkgi2-3"})(["margin-left:auto;&:disabled{background-color:var(--color-base-50);cursor:not-allowed;}"]),eu=j.div.withConfig({displayName:"AvailableImageConfigsstyled__PaginationControls",componentId:"sc-13jkgi2-4"})(["display:flex;align-items:center;gap:20px;"]),tu=()=>{const{plugin:t}=se(),{validateBoth:e,processValidationOnSave:n}=di(),{units:i,saveUnits:o}=dt(),{updateUndoStack:s}=ui();return{handleDelete:async r=>{const l=[...i],h=[...i],u=h[r];h.splice(r,1),await o(h),s(l,ie(f("br"),{name:u.name,selector:u.selector}))},handleToggle:async(r,l)=>{const h=JSON.parse(JSON.stringify(i));i[r].on=l,await o([...i]);const u=f(l?"bu":"bs"),p=ie(u,{name:i[r].name});s(h,p)},handleSaveEditing:async r=>{const l=JSON.parse(JSON.stringify(i)),h=i[r],u=document.querySelector("#editing-name-input"),p=document.querySelector("#editing-selector-input");if(!u||!p)return;const c=e(u.value,p.value,h),v=n(c);if(v){const m=h.name,x=h.selector,C=m!==u.value,P=x!==p.value;i[r].name=u.value,i[r].selector=p.value,await o([...i]),u.removeAttribute("id"),p.removeAttribute("id");const S=[];C&&S.push(ie(f("bp"),{old:m,new:i[r].name})),P&&S.push(ie(f("bq"),{old:x,new:i[r].selector})),s(l,ie(f("bt"),{name:i[r].name,changes:S.join(`
`)}))}return{validationResult:c,validated:v}}}},nu=({unit:t,index:e,modeState:n,setModeState:i})=>{const[o,s]=z(t.name),[r,l]=z(t.selector),[h,u]=z(""),[p,c]=z(""),{validateName:v,validateSelector:m}=di(),{handleSaveEditing:x,handleDelete:C,handleToggle:P}=tu(),S=async E=>{if(E.code==="Enter"){E.preventDefault();const M=await x(e);if(M){const{validationResult:A,validated:L}=M;u(A.nameResult.tooltip),c(A.selectorResult.tooltip),L&&i({index:-1,mode:"none"})}}};return n.index===e&&n.mode==="edit"?a(O,{children:[a("input",{id:"editing-name-input",type:"text",value:o,className:h.trim()?"invalid":"","aria-label":h,onChange:E=>{const M=E.target.value,A=v(M,t);u(A.tooltip)},onKeyDown:S}),a("input",{id:"editing-selector-input",type:"text",value:r,className:(p.trim(),""),"aria-label":p,onChange:E=>{const M=E.target.value,A=m(M,t);c(A.tooltip)},onKeyDown:S}),a("button",{"aria-label":f("bv"),onClick:()=>{i({index:-1,mode:"none"})},"data-icon":"circle-x"}),a("button",{"aria-label":ie(f("bz"),{name:t.name}),onClick:async()=>{const E=await x(e);if(E){const{validationResult:M,validated:A}=E;u(M.nameResult.tooltip),c(M.selectorResult.tooltip),A&&i({index:-1,mode:"none"})}else i({index:-1,mode:"none"})},"data-icon":"save"})]}):a(O,{name:t.name,desc:t.selector,children:[a("input",{type:"checkbox",checked:t.on,"aria-label":t.on?ie(f("bA"),{name:t.name}):ie(f("bB"),{name:t.name}),onChange:async E=>{await P(e,E.target.checked)}}),![Le.IMG_SVG,Le.Default].contains(t.selector)&&a(W,{children:[a("button",{"aria-label":ie(f("bx"),{name:t.name}),onClick:async()=>{i({index:e,mode:"edit"})},"data-icon":"edit"}),a("button",{"aria-label":ie(f("bw"),{name:t.name}),onClick:async()=>{await C(e)},"data-icon":"trash"})]}),a("button",{"aria-label":ie(f("by"),{name:t.name}),onClick:()=>{i({index:e,mode:"options"})},"data-icon":"settings"})]})},iu=({itemsPerPage:t,totalItems:e})=>{const[n,i]=z(1),[o,s]=z(0),r=ce(()=>Math.max(1,Math.ceil(e/t)),[e,t]),l=ce(()=>(n-1)*t,[n,t]),h=ce(()=>l+t,[l,t]);return Z(()=>{const u=Math.max(1,Math.ceil(e/t));i(p=>Math.min(p,u))},[t,e]),{page:n,pageStartIndex:l,pageEndIndex:h,delta:o,setDelta:s,totalPages:r,navigateToPage:u=>{i(p=>Math.min(r,Math.max(p+u,1)))}}},ou=({unitIndex:t,onClose:e,onChanges:n})=>{const{plugin:i}=se(),{units:o}=dt(),s=ce(()=>o[t],[t]);return a(ct,{onClose:e,title:ie(f("bD"),{name:s.name}),children:[a(O,{desc:f("bC")}),a(O,{name:f("bF"),heading:!0}),Object.entries(s.panels).map(([r,{on:l}])=>a(O,{name:r.charAt(0).toUpperCase().concat(r.slice(1).toLowerCase()),children:a("input",{type:"checkbox",defaultChecked:l,onChange:async h=>{const u=h.target.checked,p=JSON.parse(JSON.stringify(o));i.settings.$.units.configs[t].panels[r].on=u,await i.settings.save();const c=f(u?"bH":"bG");n(p,ie(f("bE"),{state:c,panel:r,name:s.name}))}})},r))]})},su=()=>{const{plugin:t}=se(),e=ce(()=>f("bN"),[t]),[n,i]=z(t.settings.$.units.settingsPagination.perPage),{units:o}=dt(),[s,r]=z({mode:"none",index:-1}),{navigateToPage:l,totalPages:h,pageStartIndex:u,pageEndIndex:p,page:c}=iu({itemsPerPage:n,totalItems:o.length}),{updateUndoStack:v,undo:m,canUndo:x,canRedo:C,getRedoLabel:P,redo:S,getUndoLabel:E}=ui();Z(()=>{const L=async()=>{i(t.settings.$.units.settingsPagination.perPage)};return t.settings.emitter.on(t.settings.$$.units.settingsPagination.perPage.$path,L),()=>{t.settings.emitter.off(t.settings.$$.units.settingsPagination.perPage.$path,L)}},[t]);const M=ce(()=>o.slice(u,p),[o,u,p]),A=L=>{const D=L==="next"?c<h:c>1;if(s.mode==="edit"&&D)return f("bI");switch(L){case"previous":return f(D?"bM":"bL");case"next":return f(D?"bK":"bJ")}};return a(W,{children:[a(O,{name:f("bo"),heading:!0}),a(O,{name:f("bO"),disabled:s.mode==="edit",children:a("input",{type:"range",min:1,max:50,step:1,onChange:async L=>{t.settings.$.units.settingsPagination.perPage=parseInt(L.target.value,10),await t.settings.save()}})}),a(Xc,{children:[a(Jc,{onClick:m,disabled:!x,"aria-label":E(),children:a(_s,{size:"20px"})}),a(eu,{children:[a(ro,{onClick:()=>l(-1),disabled:c===1||s.mode==="edit","aria-label":A("previous"),children:a(yl,{size:"20px"})}),ie(e,{current:c.toString(),total:h.toString(),count:o.length.toString()}),a(ro,{onClick:()=>l(1),disabled:c===h||s.mode==="edit","aria-label":A("next"),children:a(wl,{size:"20px"})})]}),a(Qc,{disabled:!C,onClick:S,"aria-label":P(),children:a(Dl,{size:"20px"})})]}),M.map((L,D)=>a(nu,{unit:L,index:u+D,modeState:s,setModeState:r},`${L.name}-${L.selector}`)),s.mode==="options"&&s.index!==-1&&a(ou,{unitIndex:s.index,onChanges:v,onClose:()=>{r({mode:"none",index:-1})}})]})},ru=()=>{const{units:t,saveUnits:e}=dt();return a(Gc,{state:t,updateState:e,children:[a(Zc,{}),a(su,{})]})},au=()=>{const[t,e]=an();return a(Yc,{children:a(zs,{location:t,children:[a(He,{path:"/general",children:()=>a(so,{})}),a(He,{path:"/presets",children:()=>a(ru,{})}),a(He,{path:"/controls",children:()=>a(Rc,{})}),a(He,{path:"",children:()=>a(so,{})})," "]})})},lu=j.button.withConfig({displayName:"Sidebarstyled__SidebarButton",componentId:"sc-4b9op8-0"})(["z-index:101;transition:all 0.2s ease;&:hover{transform:scale(1.05);background-color:var(--background-modifier-hover);}"]),cu=j.div.withConfig({displayName:"Sidebarstyled__Overlay",componentId:"sc-4b9op8-1"})(["position:absolute;top:0;left:0;width:100%;height:100%;z-index:99;"]),Je=j.div.withConfig({displayName:"Sidebarstyled__Section",componentId:"sc-4b9op8-2"})(["display:flex;padding:5px 10px;border-bottom:1px solid var(--background-modifier-border);margin-left:",";background-color:",";border-left:",";cursor:pointer;transition:all 0.2s ease;&:last-child{border-bottom:none;}&:hover{background-color:",";}svg{width:14px;height:14px;transition:transform 0.2s ease;flex-shrink:0;}"],t=>t.$nested?"20px":"0",t=>t.$active?"var(--interactive-accent)":"transparent",t=>t.$active?"3px solid var(--text-accent)":"3px solid transparent",t=>t.$active?"var(--interactive-accent-hover)":"var(--background-modifier-hover)"),uu=j.div.withConfig({displayName:"Sidebarstyled__SectionHeader",componentId:"sc-4b9op8-3"})(["display:flex;align-items:center;justify-content:space-between;width:100%;svg{transition:transform 0.2s ease;}"]),du=j.div.withConfig({displayName:"Sidebarstyled__SidebarContainer",componentId:"sc-4b9op8-4"})(["background:var(--background-primary);position:absolute;height:100%;width:250px;top:0;left:0;z-index:100;border-right:1px solid var(--border-color);box-shadow:2px 0 8px rgba(0,0,0,0.15);transform:translateX(-100%);animation:slideIn 0.3s ease forwards;@keyframes slideIn{to{transform:translateX(0);}}"]),hu=j.div.withConfig({displayName:"Sidebarstyled__SidebarContent",componentId:"sc-4b9op8-5"})(["padding-top:60px;height:100%;overflow-y:auto;"]),pu=j.div.withConfig({displayName:"Sidebarstyled__CollapsibleSection",componentId:"sc-4b9op8-6"})(["overflow:hidden;max-height:",";transition:max-height 0.3s ease;"],t=>t.$expanded?"200px":"0");var js=(t=>(t.IMAGES="images",t.PANELS="panels",t))(js||{});const gu=()=>{const[t,e]=z(!1),[n,i]=z({images:!1,panels:!1}),o=h=>{i(u=>({...u,[h]:!u[h]}))},[s,r]=an(),l=h=>r(h);return Z(()=>{const h=document.querySelector(".izd-settings");h&&h.classList.toggle("sidebar-open",t)},[t]),a(W,{children:[a(lu,{"aria-label":f("cc"),onClick:()=>e(h=>!h),children:a(Nl,{size:18})}),t&&a(W,{children:[a(cu,{onClick:()=>e(!1)}),a(du,{children:a(hu,{children:[a(Je,{onClick:()=>o(js.IMAGES),children:a(uu,{children:["Images",n.images?a(xl,{size:16}):a(Sl,{size:16})]})}),a(pu,{$expanded:n.images,children:[a(Je,{$nested:!0,$active:["/images/general","/images"].includes(s),onClick:()=>l("/images/general"),children:"General"}),a(Je,{$nested:!0,$active:s==="/images/presets",onClick:()=>l("/images/presets"),children:"Presets"}),a(Je,{$nested:!0,$active:s==="/images/controls",onClick:()=>l("/images/controls"),children:"Controls"})]}),a(Je,{onClick:()=>l("/debug"),$active:s==="/debug",children:"Debug"}),a(Je,{onClick:()=>l("/about"),$active:s==="/about",children:"About"})]})})]})]})},mu=j.div.withConfig({displayName:"Toolbarstyled__ToolbarComponent",componentId:"sc-12wg4bk-0"})(["display:flex;align-items:center;width:100%;justify-content:space-between;margin-top:20px;margin-bottom:40px;"]),fu=()=>{const{plugin:t,forceReload:e,setCurrentPath:n}=se(),[i,o]=an(),s=le(async()=>{n(i),await t.settings.reset(),t.settings.emitter.emit("settings-reset",{eventName:"settings-reset",oldValue:void 0,newValue:void 0}),e(),t.showNotice(f("ca"))},[t,e,n,i]);return a("button",{"aria-label":f("cb"),onClick:s,children:a(_s,{size:18})})},vu=()=>a(mu,{children:[a(gu,{}),a(fu,{})]}),yu=()=>{const[t]=an();return a(Sc,{children:[a(vu,{}),a(kc,{children:a(zs,{location:t,children:[a(He,{path:"/images",nest:!0,children:()=>a(au,{})}),a(He,{path:"/debug",children:()=>a(Cc,{})}),a(He,{path:"/about",children:()=>a(xc,{})})]})})]})},bu=()=>{const{reloadCount:t,currentPath:e}=se(),{hook:n}=yc({path:e});return a(As,{hook:n,children:a(yu,{})},t)},wu=({app:t,plugin:e})=>a(ql,{app:t,plugin:e,children:a(bu,{})});class _u extends R.PluginSettingTab{constructor(e,n){super(e,n),this.app=e,this.plugin=n,this.containerEl.addClass("izd-settings")}root=void 0;display(){this.plugin.settings.emitter.on("**",e=>{this.plugin.emitter.emit(e.eventName,e)}),this.root=Jt(this.containerEl),this.root.render(a(wu,{app:this.app,plugin:this.plugin}))}hide(){this.plugin.settings.emitter.removeAllListeners(),this.root?.unmount(),this.containerEl.empty()}}const xu=j.div.withConfig({displayName:"HelpSection__n",componentId:"sc-1ygybyw-0"})(["margin-bottom:24px;&:last-child{margin-bottom:0;}"]),Cu=j.h3.withConfig({displayName:"HelpSection__i",componentId:"sc-1ygybyw-1"})(["margin:0 0 12px 0;font-size:16px;font-weight:600;color:var(--text-normal);border-bottom:1px solid var(--background-modifier-border);padding-bottom:8px;"]),Su=j.div.withConfig({displayName:"HelpSection__a",componentId:"sc-1ygybyw-2"})(["color:var(--text-muted);line-height:1.6;p{margin:0 0 12px 0;&:last-child{margin-bottom:0;}}kbd{background:var(--background-modifier-border);border:1px solid var(--background-modifier-border-hover);border-radius:3px;padding:2px 6px;font-size:0.85em;font-family:var(--font-monospace);color:var(--text-normal);}strong{color:var(--text-normal);font-weight:600;}code{background:var(--code-background);padding:2px 4px;border-radius:3px;font-family:var(--font-monospace);font-size:0.9em;}"]),_n=({title:t,children:e})=>a(xu,{children:[a(Cu,{children:t}),a(Su,{children:e})]}),$u=j.div.withConfig({displayName:"HelpContent__f",componentId:"sc-1xpaofg-0"})(["margin-bottom:16px;padding:8px 12px;background:var(--background-secondary);border-radius:6px;display:flex;justify-content:space-between;align-items:center;font-size:14px;"]),ku=j.button.withConfig({displayName:"HelpContent__w",componentId:"sc-1xpaofg-1"})(["padding:4px 8px;border-radius:4px;border:1px solid var(--border-color);background:var(--background-primary);cursor:pointer;&:hover{background:var(--background-modifier-hover);}"]),Eu=j.div.withConfig({displayName:"HelpContent__y",componentId:"sc-1xpaofg-2"})(["display:flex;gap:20px;"]),Nu=j.div.withConfig({displayName:"HelpContent__C",componentId:"sc-1xpaofg-3"})(["flex:0 0 300px;max-height:calc(100vh - 40px);position:sticky;top:20px;overflow:hidden;display:flex;align-items:flex-start;justify-content:center;"]),Pu=j.div.withConfig({displayName:"HelpContent__v",componentId:"sc-1xpaofg-4"})(["flex:1;min-width:0;"]),Un=`
\`\`\`mermaid
graph TD
    A[Start] --> B[Process 1]
    B --> C{Decision}
    C -->|Yes| D[Process 2]
    C -->|No| E[Process 3]
    D --> F[End]
    E --> F
\`\`\`
`,Iu=t=>{const e={};return e.element=t,e.elementType="svg",e.origin="generated",e.mode="preview",e.sourceData={source:Un,lineStart:0,lineEnd:Un.length-1},e},Lu=async(t,e,n)=>{await R.MarkdownRenderer.render(t.plugin.app,Un,e,"",n);const i=e.querySelector("svg");if(i){const o=Iu(i);t.plugin.emitter.emit("create-integrated-element-outside-view",o)}await new Promise(o=>requestAnimationFrame(o))},Mu=({onClose:t,mode:e,help:n})=>{const i=he(null),[o,s]=z(e);return Z(()=>{let r=null;return(async()=>i.current&&(r=new R.Component,r.load(),await Lu(n,i.current,r)))(),()=>{r?.unload()}},[n,i]),a(ct,{onClose:t,title:"Image Zoom & Drag Help",height:"100%",width:"100%",children:[a($u,{children:[a("span",{children:["Help mode: ",o==="full"?"Detailed":"Quick"]}),a(ku,{onClick:()=>s(o==="full"?"minimal":"full"),children:o==="full"?"Show less":"Show more"})]}),o==="full"&&a(_n,{title:"Picker mode",children:[a("p",{children:"Picker mode allows you to convert any image into both modes mentioned below: integrated and popup."}),a("p",{children:"Works with images 64px+ (smaller ones aren't practical to interact with)"}),a("p",{children:["You can enable picker mode at: Settings \u2192 Image Zoom & Drag Settings \u2192 Images \u2192 General \u2192"," ",a("kbd",{children:"Enable Picker Mode"})]}),a("p",{children:["Activate picker mode: ribbon button on the left or command in command palette:"," ",a("kbd",{children:"Toggle picker mode"})]}),a("p",{children:"This mode allows you to convert any suitable image into integrated or popup modes"}),a("p",{children:"In this mode, the plugin automatically scans the DOM and highlights all suitable images with a light blue dashed outline."}),a("p",{children:[a("kbd",{children:"Click"})," on a suitable image will toggle it to integrated mode"]}),a("p",{children:[a("kbd",{children:"Alt + Click"})," on an integrated image will toggle it to popup mode"]})]}),a(Eu,{children:[a(Pu,{children:a(_n,{title:"Integrated Mode",children:[a("p",{children:"Basic controls:"}),a("p",{children:[a("kbd",{children:"Click"})," - focus on image"]}),a("p",{children:[a("kbd",{children:"Click + Drag"})," - change visual position by dx/dy"]}),a("p",{children:[a("kbd",{children:"Ctrl + Wheel up / down"})," - change diagram scale"]}),a("p",{children:[a("kbd",{children:"Shift + Wheel"})," - move diagram horizontally"]}),a("p",{children:[a("kbd",{children:"Shift + Alt + Wheel"})," - move diagram vertically"]}),a("p",{children:[a("kbd",{children:"Ctrl + ` (backtick)"})," - collapse / expand diagram"]}),a("p",{children:[a("kbd",{children:"Ctrl + Alt + F"})," - switch fullscreen mode"]}),a("p",{children:[a("kbd",{children:"Double click / Double tap"})," - reset position and scale"]}),a("p",{children:[a("kbd",{children:"Arrow keys"})," - move diagram in specified direction"]}),a("p",{children:[a("kbd",{children:"Ctrl + Minus"})," - zoom out"]}),a("p",{children:[a("kbd",{children:"Ctrl + Plus"})," - zoom in"]}),a("p",{children:[a("kbd",{children:"Ctrl + 0"})," - reset scale"]}),a("p",{children:[a("kbd",{children:"Right click"})," - open context menu"]}),o==="full"&&a(W,{children:[a("p",{children:"Integrated mode is the default mode for interactive images in your notes."}),a("p",{children:"By default, the plugin only works with auto-generated diagrams (Mermaid, PlantUML, etc.) that match built-in presets."}),a("p",{children:"To enable for regular images: Obsidian Settings \u2192 Plugins \u2192 Image Zoom & Drag Settings \u2192 Images \u2192 Presets \u2192 IMG_SVG."}),a("p",{children:'Enable the "IMG_SVG" preset to make all images interactive, not just diagrams.'}),a("p",{children:"An image that becomes interactive gets extended capabilities: zoom, drag, etc."}),a("p",{children:"Doesn't affect performance - all images are cleaned up when closing the note."}),a("p",{children:"Besides basic functions, you can enable control panels on images."}),a("p",{children:"Control panels available: zoom, movement, collapse/expand and fullscreen mode."}),a("p",{children:"Disabled by default."}),a("p",{children:"Enable for all diagrams: Settings \u2192 Images \u2192 Controls."}),a("p",{children:"Configure for specific type: Settings \u2192 Images \u2192 Presets."})]})]})}),a(Nu,{ref:i})]}),o==="full"&&a(_n,{title:"Popup mode",children:[a("p",{children:"Popup mode displays images in a fullscreen overlay window."}),a("p",{children:"Three ways to open popup:"}),a("p",{children:"\u2022 Alt + Click in picker mode"}),a("p",{children:"\u2022 Through image context menu"}),a("p",{children:"\u2022 Note panel button (for all images in the note)"}),a("p",{children:["Controls: ",a("kbd",{children:"Wheel"})," - zoom,"," ",a("kbd",{children:"Click + Drag"})," - pan"]}),a("p",{children:"Popup mode supports working with multiple images simultaneously"}),a("p",{children:"Close popup with Esc key or the close button in the top right corner"}),a("p",{children:"You can minimize the popup by clicking the minimize button next to the close button. It collapses to a floating button in the bottom right corner"}),a("p",{children:"The button shows the number of open images and can be moved anywhere."}),a("p",{children:"Switch between images: click any image in the gallery at the bottom of the screen."}),a("p",{children:"Limitation: works only with regular images (PNG, JPG). SVG support is planned for future versions."})]})]})},Du=({mode:t,onClose:e,help:n})=>a(Mu,{help:n,mode:t,onClose:e});class Tu extends R.Component{constructor(e){super(),this.plugin=e}rootDiv=null;root=null;isHelpOpen=!1;onload(){this.plugin.userState.isFirstLaunch&&this.plugin.showInteractiveNotice("New to Image Zoom & Drag? Click here for quick start guide (auto-hide in 1 min)",()=>{this.showModal("full")},6e4),this.setupCommands()}showModal(e){this.closeModal(),this.rootDiv??=document.createElement("div"),this.root=Jt(this.rootDiv),this.root.render(a(Du,{help:this,mode:e,onClose:()=>this.closeModal()})),this.isHelpOpen=!0}closeModal(){this.root?.unmount(),this.rootDiv?.remove(),this.isHelpOpen=!1}onunload(){this.closeModal()}setupCommands(){this.plugin.addCommand({id:"open-help-guide",name:"Open help guide",callback:()=>this.showModal("full")})}}class Au{constructor(e){this.plugin=e,this.storageKey=`${e.manifest.id}-logs`,this.checkStorageAvailability()}maxEntries=2e3;isStorageAvailable=!0;async init(){await this.ensureLogsDirExists(),this.plugin.settings.$.debug.enabled&&await this.writeSystemInfo()}async saveLogsToFile(e){try{const n=`logs-${R.moment().format("YYYY-MM-DD HH:mm:ss")}.json`,i=R.normalizePath(`${this.logsDir}/${n}`);await this.plugin.app.vault.adapter.write(i,e),await this.rotateLogFiles(this.logsDir)}catch(n){console.error("Image Zoom & Drag: Error in the file:",n)}}async ensureLogsDirExists(){const e=this.plugin.manifest.dir;if(e===void 0)throw new Error(`Image Zoom & Drag: It was not possible to get the way to the plugin. Path:${e}`);this.logsDir=R.normalizePath(`${e}/logs`),!await this.plugin.app.vault.adapter.exists(this.logsDir)&&await this.plugin.app.vault.adapter.mkdir(this.logsDir)}async rotateLogFiles(e){try{const n=await this.plugin.app.vault.adapter.list(e),i=R.moment().unix()*1e3,o=10080*60*1e3;for(const s of n.files){if(!s.endsWith(".json"))continue;const r=`${e}/${s}`,l=await this.plugin.app.vault.adapter.stat(r);l&&i-l.mtime>o&&(await this.plugin.app.vault.adapter.remove(r),console.log(`Image Zoom & Drag: Remove the old log-file${s}`))}}catch(n){console.error("Image Zoom & Drag: Log Rotation Error:",n)}}getObsidianVersion(){const e=document.title.match(/Obsidian v([\d.]+)/);return e?e[1]:"unknown"}async writeSystemInfo(){const e=this.getSystemInfo();this.addLogEntry(e)}getSystemInfo(){return{timestamp:R.moment().toISOString(),session_start:!0,obsidian:{version:this.getObsidianVersion(),title:document.title,enabledPlugins_count:this.plugin.app.plugins.enabledPlugins.size,enabledPlugins_list:Array.from(this.plugin.app.plugins.enabledPlugins),vault_name:this.plugin.app.vault.getName(),is_mobile:R.Platform.isMobile,is_desktop:R.Platform.isDesktopApp},system:{platform:this.getPlatformInfo(),userAgent:navigator.userAgent,language:navigator.language,screen_resolution:`${screen.width}x${screen.height}`,viewport_size:`${window.innerWidth}x${window.innerHeight}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,online_status:navigator.onLine,cpu_cores:navigator.hardwareConcurrency||"unknown",device_memory:navigator.deviceMemory||"unknown",connection_type:navigator.connection?.effectiveType||"unknown"},plugin:{name:this.plugin.manifest.name,version:this.plugin.manifest.version,minAppVersion:this.plugin.manifest.minAppVersion,id:this.plugin.manifest.id,author:this.plugin.manifest.author,description:this.plugin.manifest.description},performance:{memory_used:performance.memory?.usedJSHeapSize||"unknown",memory_total:performance.memory?.totalJSHeapSize||"unknown",memory_limit:performance.memory?.jsHeapSizeLimit||"unknown",load_time:performance.now()},storage:{localStorage_usage:this.getStorageUsage()}}}getShortSystemInfo(){return{timestamp:R.moment().toISOString(),obsidian:{version:this.getObsidianVersion(),vault_name:this.plugin.app.vault.getName(),is_mobile:R.Platform.isMobile},system:{platform:this.getPlatformInfo(),language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},plugin:{name:this.plugin.manifest.name,version:this.plugin.manifest.version,id:this.plugin.manifest.id}}}getPlatformInfo(){return"userAgentData"in navigator?navigator.userAgentData.platform??"unknown":navigator.platform??"unknown"}getStorageUsage(){try{const e=localStorage.getItem(this.storageKey);return e?`${((e.length+this.storageKey.length)/1024).toFixed(2)} KB`:"0 B"}catch{return"unknown"}}checkStorageAvailability(){try{localStorage.setItem("test","test"),localStorage.removeItem("test")}catch{this.isStorageAvailable=!1,console.warn("Image Zoom & Drag: Localstorage is not available")}}addLogEntry(e){if(this.isStorageAvailable)try{const n=this.getAllLogs();n.push(e),n.length>this.maxEntries&&n.splice(0,n.length-this.maxEntries),localStorage.setItem(this.storageKey,JSON.stringify(n)),this.plugin.emitter.emit("logs-changed",{storage:this.getStorageUsage(),entries:this.getAllLogs().length})}catch(n){console.error("Logger: \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u043F\u0438\u0441\u0438 \u0432 localStorage:",n),this.isStorageAvailable=!1}}getAllLogs(){const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}log(e,n,i){if(!this.plugin.settings.$.debug.enabled)return;const o={timestamp:new Date().toISOString(),level:e,message:n,context:i};this.addLogEntry(o)}shouldLog(e){const n=["none","debug","info","warn","error"],i=this.plugin.settings.$.debug.level;if(i==="none")return!1;const o=n.indexOf(e.toLowerCase()),s=n.indexOf(i);return o>=s}debug(e,n){this.shouldLog("debug")&&this.log("DEBUG",e,n)}info(e,n){this.shouldLog("info")&&this.log("INFO",e,n)}warn(e,n){this.shouldLog("warn")&&this.log("WARNING",e,n)}error(e,n){this.shouldLog("error")&&this.log("ERROR",e,n)}exportLogs(){const e=this.getAllLogs();if(e.length===0)return"";const n=e.filter(s=>s.session_start),i=e.filter(s=>!s.session_start);let o=`=== SYSTEM INFO ===
`;return n.forEach(s=>{o+=JSON.stringify(s,null,2)+`

`}),o+=`
=== LOGS ===
`,i.forEach(s=>{const r=new Date(s.timestamp).toLocaleTimeString(),l=s.context,h=l?.file?`${l.file}:${l.lineNumber}${l.functionName?` (${l.functionName})`:""}`:"unknown";o+=`[${r}] ${s.level.toUpperCase().padEnd(5)} | ${h}
`,o+=`  ${s.message}
`;const u={...l};delete u.file,delete u.lineNumber,delete u.columnNumber,delete u.functionName,Object.keys(u).length>0&&(o+=`  Context: ${JSON.stringify(u)}
`),o+=`
`}),o}clearAllLogs(){localStorage.removeItem(this.storageKey),this.plugin.emitter.emit("logs-changed",{storage:this.getStorageUsage(),entries:this.getAllLogs().length})}}class Ou extends R.Plugin{async onload(){await this.initialize(),this.logger.info("Plugin loaded successfully",{functionName:"onload",lineNumber:39,columnNumber:1202,fileName:"src/core/izd-plugin.ts"})}async onunload(){super.onunload(),this.emitter.removeAllListeners(),this.logger.info("Plugin unloaded successfully",{functionName:"onunload",lineNumber:46,columnNumber:1480,fileName:"src/core/izd-plugin.ts"})}async initialize(){await this.initializeCore(),await this.initializeServices(),await this.initializeUI()}async initializeCore(){await qs,this.settings=new Kl(this),this.addChild(this.settings),await this.settings.load(),this.addSettingTab(new _u(this.app,this)),this.emitter=new Cs({wildcard:!0,delimiter:"."})}async initializeUI(){this.pickerMode=new Xr(this),this.integratedMode=new Zr(this),this.popupMode=new Vl(this),this.pickerMode.initialize(),this.integratedMode.initialize(),this.popupMode.initialize(),this.addChild(this.pickerMode),this.addChild(this.integratedMode),this.addChild(this.popupMode)}async initializeServices(){this.leafIndex=new Ws(this),this.addChild(this.leafIndex),this.domWatcher=new Vs,this.addChild(this.domWatcher),this.logger=new Au(this),await this.logger.init(),this.userState=new Ys(this),await this.userState.initialize(),this.help=new Tu(this),this.addChild(this.help)}showNotice(e,n){this.noticeEl?.remove();const i=new R.Notice(e,n);this.noticeEl=i.containerEl}showInteractiveNotice(e,n,i){this.showNotice(e,i),this.noticeEl?.addEventListener("click",n,{once:!0})}}const Bs={a:"Picker mode is disabled",b:"Control panels hidden",c:"No active images found",d:"This command can only be used when a markdown note is open.",e:"Control panels shown",f:"Fold",g:"Expand",h:"Fold",i:"Move down",j:"Move down left",k:"Move down right",l:"Move left",m:"Move",n:"Move right",o:"Move up",p:"Move up left",q:"Move up right",r:"Fullscreen",s:"Open in fullscreen mode",t:"Exit fullscreen mode",u:"Show panels",v:"Panel Visibility",w:"Hide panels",x:"Service",y:"Zoom in",z:"Zoom",A:"Zoom out",B:"Reset zoom and position",C:"Cannot initialize this image. Consult for docs for more info",D:"Activate interactive mode",E:"Deactivate interactive mode",F:"Picker mode disabled",G:`Picker mode enabled
Click on image to toggle interactive mode
Alt + click on image to open in in Popup viewer
Press Esc to exit`,H:"Go to GitHub page of this plugin",I:"GitHub page",J:["Exported logs contain:","\u2022 Complete system information (OS, hardware, plugins)","\u2022 Debug events with timestamps","\u2022 Performance metrics","Review logs before sharing - remove sensitive data if needed."],K:"About exported logs",L:"Clear logs storage",M:"Storage: {{storage}}, Entries: {{entries}}",N:"Clear logs storage",O:"Logs storage was cleared",P:"Copy logs to clipboard",Q:"Copy logs",R:"No logs data found",S:"Logs was copied to clipboard",T:"Enable debug logging for troubleshooting",U:"Enable logging",V:"Export logs",W:"Export logs",X:"Set minimum log level to display",Y:"Log level",Z:["If you encounter any issues or have suggestions, please report them on GitHub.","How to report an issue:","1. Enable debug logging below and set level to `Debug`.","Warning: This may impact performance temporarily.","2. Reproduce the issue with logging enabled.","3. Export logs using the button below.","4. Click `Report an issue` and fill out the form.","5. Attach the exported log file.","6. Submit the issue."],_:"Report an issue",$:"Report an issue",aa:"Service panel will always be visible regardless of visibility mode",ab:"Ignore controls visibility rule for service panel",ac:"Set when panels will be visible",ad:"Always",ae:"On focus",af:"On hover",ag:"Controls visibility",ah:"Controls stay visible when enabled (globally and per preset)",ai:"Controls appear when image is clicked",aj:"Controls appear on hover",ak:"Automatically fold images on focus change",al:"Fold images by default",am:"Fold",an:"When enabled, the plugin will automatically scan and prepare all suitable images for potential interactivity.",ao:"Auto-detect images",ap:"Interactivity options",aq:["Adds a ribbon button and command palette entry for toggling picker mode.","When activated, hover over images/SVG elements to see availability status, then click to initialize or toggle interactivity."],ar:"Enable picker mode",as:["Set the container dimensions for expanded state."],at:"Expanded image container size",au:["Set the container dimensions for folded state."],av:"Folded image container size",aw:"Image size",ax:"Height:",ay:"Width:",az:"Save changes",aA:"Please fix validation errors",aB:"Invalid height. Please enter number in range {{range}}.",aC:"Invalid width. Please enter number in range {{range}}.",aD:"Nothing to save",aE:"Saved successfully",aF:"Configure which buttons are shown on each panel",aG:"Full",aH:"Minimal",aI:"Presentation mode",aJ:"Quick presets",aK:"Buttons layout",aL:"Buttons layout",aM:"Open control buttons layout editor",aN:"Change where controls appear and when they show",aO:["\u2022 Move Panel: Arrow buttons to move the image around","\u2022 Zoom Panel: Zoom in, zoom out, and reset to original size","\u2022 Service Panel: Extra tools and options"],aP:"Available panels",aQ:["1. Use checkboxes below to toggle panel visibility on/off","2. Click and drag any panel to reposition it on the image","3. Panel positions are saved automatically","4. Close and reopen the note to see your changes to see your changes take effect"],aR:"How to customize panels",aS:"Customize control panels appearance and position",aT:"Panel configuration",aU:"Controls layout",aV:"Controls layout",aW:"Open controls layout editor",aX:["Add new image preset to override default settings for specific images.","Name: any UTF-8 characters allowed","Selector: CSS selector for target images"],aY:"Add new image preset",aZ:"New image preset was added",a_:"Example preset name",a$:".example-preset-selector",ba:"Click for more information on how the plugin works",bb:"Add this preset",bc:`Add image preset
Name: {{name}}
Selector: {{selector}}`,bd:"Selectors are only needed for specific behavior overrides. For example, to disable UI panels for SVG inside Mermaid diagrams.",be:"Custom selectors (optional)",bf:["1. Open DevTools (Ctrl+Shift+I)","2. Use element selector (Ctrl+Shift+C)","3. Click on the specific element you want to customize","4. Find the class attribute: `.mermaid`, `.block-language-plantuml`, etc.","5. Use this selector to create specific settings overrides"],bg:"Finding selectors (when needed):",bh:"User Guide",bi:["The plugin automatically processes all images and SVG elements in your markdown files.","In auto-detect mode, it finds all suitable images and makes them interactive","In picker mode, hover over any image and click to make it interactive with zoom, drag, and control panels."],bj:"How this plugin works",bk:"Video failed to load. Please try again later.",bl:"Loading video...",bm:["\u2022 Auto-detect: Plugin automatically finds and processes all images","\u2022 Picker toggle: Hover over images and click to activate interaction","\u2022 Use ribbon button or command palette to toggle picker mode"],bn:"Working modes",bo:"Available image presets",bp:'name: "{{old}}" \u2192 "{{new}}"',bq:'selector: "{{old}}" \u2192 "{{new}}"',br:"Delete preset\n`Name: {{name}}\nSelector: {{selector}}`",bs:"Disable {{name}} preset",bt:`Edit preset "{{name}}":
{{changes}}`,bu:"Enable {{name}} preset",bv:"Cancel operation? All changes will be lost.",bw:"Delete {{name}} preset",bx:"Edit {{name}} preset",by:"Options for {{name}} preset",bz:"Save changes for {{name}}?",bA:"Disable {{name}} preset",bB:"Enable {{name}} preset",bC:"These settings will only apply to this preset.",bD:"{{name}} preset options",bE:"Turn {{state}} panel `{{panel}}` for preset `{{name}}`",bF:"Panels",bG:"off",bH:"on",bI:"Can`t change page while editing",bJ:"No next page",bK:"Go to next page",bL:"No previous page",bM:"Go to previous page",bN:"{{current}}/{{total}} \u2022 {{count}}",bO:"Image presets per page",bP:"Nothing to redo",bQ:"Nothing to undo",bR:`Redo
{{description}}{{count}}
Shortcut: CTRL+SHIFT+Z`,bS:`Nothing to redo
Shortcut: CTRL+SHIFT+Z`,bT:`Undo
{{description}}{{count}}
Shortcut: CTRL+Z`,bU:`Nothing to undo
Shortcut: CTRL+Z`,bV:"Preset name and selector are both invalid",bW:"Fill out preset {{field}} field!",bX:"Invalid CSS selector: {{err}}",bY:"Preset with that name already exists",bZ:"Nothing to save",b_:"Preset {{field}} is invalid",b$:"Preset with that selector already exists",ca:"Settings have been reset to default.",cb:"Reset settings to default",cc:"Toggle sidebar"},jn={en:Bs};function Hs(){const t=R.moment.locale(),e=t in jn?t:"en";return jn[e]}const zu=Hs();function Ru(t){return zu[t]??Bs[t]??`[missing: ${t}]`}var Fu=Object.freeze({__proto__:null,initLocale:Hs,locales:jn,t:Ru});module.exports=Ou;
/* End of bundle */
