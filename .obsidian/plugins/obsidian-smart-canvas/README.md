## Smart Canvas（Obsidian 插件）

为 Obsidian Canvas 提供高效的画布操作：
- 一键排版对齐（支持“整个画布”与“框选多节点”两种模式）
- 一键将选中文件卡片的反向链接笔记加入当前画布（自动去重、排除当前画布、自动连线）
- 一键将选中文件卡片的正向链接笔记加入当前画布（自动去重、排除当前画布、自动连线）

说明：插件尽量通过数据层写入，减少与第三方 Canvas 增强插件的冲突。

### 安装与使用

1. 将本插件目录复制到你的库目录：`<Vault>/.obsidian/plugins/obsidian-smart-canvas/`
2. 打开 Obsidian 设置 → “第三方插件” → 启用 "Smart Canvas"
3. 打开任意 Canvas 白板，命令面板执行：
   - 一键排版对齐（Canvas）
     - 默认：对当前画布所有节点网格化对齐
     - 若当前框选≥2个节点：仅对所选节点对齐
   - 将选中卡片的反向链接笔记加入当前画布（Canvas）
     - 需选中一个“文件卡片”；会加入所有反向链接笔记并连线
     - 自动跳过已在画布中的相同文件
     - 自动排除 `.canvas` 文件与当前画布自身
   - 将选中卡片的正向链接笔记加入当前画布（Canvas）
     - 需选中一个“文件卡片”；会加入所有出站（正向）链接笔记并连线
     - 自动跳过已在画布中的相同文件
     - 自动排除 `.canvas` 文件与当前画布自身

### 功能细节

- 对齐策略：稳定排序（先 y 后 x）+ 方阵式列数（≈√N），合理的行/列间距
- 反向链接：基于 `metadataCache.getBacklinksForFile`，默认插入在选中节点右侧并纵向排布
- 正向链接：基于 `metadataCache.resolvedLinks`，默认插入在选中节点右侧并纵向排布
- ID 规范：新建节点与连线 ID 均无连字符

### Roadmap（规划）
- 智能布局
  - 星型（以选中节点为中心）、树型（按层级/父子）、路径/标签/Frontmatter 分组布局
- 快速连线
  - 框选后按标题相似度或链接关系自动连线
- 一键导入双链图谱子集
  - 选中节点后，将 N 跳（1~2）内的邻居加载到当前画布，支持去重与连线
- 一键导出为图片/Markdown 摘要
  - 导出当前画布为 PNG/SVG，或生成包含节点快照/链接清单的 MD
- 对齐增强
  - 左/右/上/下对齐、等间距分布（水平/垂直）、参考线平均对齐
- 自定义设置
  - 对齐间距、列数策略、默认节点大小与插入间距可在设置中调整（计划）

### 开发

- 开发：`npm run dev`
- 构建：`npm run build`
- 主要文件：
  - `main.ts`：插件逻辑
  - `manifest.json`：插件元信息
  - `esbuild.config.mjs`：打包配置

### 已知限制

- 不同 Canvas 版本或第三方增强插件可能包裹核心方法。必要时回退到 `getData` + `setData/importData/setViewData` 写入，尽量兼容。
- 对齐仅调整位置，不改变大小；更复杂的美学布局将在未来提供。

### 许可

MIT


