/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var le=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Ae=Object.prototype.hasOwnProperty;var De=(g,e)=>{for(var i in e)le(g,i,{get:e[i],enumerable:!0})},He=(g,e,i,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Te(e))!Ae.call(g,r)&&r!==i&&le(g,r,{get:()=>e[r],enumerable:!(t=Me(e,r))||t.enumerable});return g};var Ne=g=>He(le({},"__esModule",{value:!0}),g);var Be={};De(Be,{default:()=>oe});module.exports=Ne(Be);var j=require("obsidian");var ue=require("obsidian");var re=require("obsidian");var x=class{constructor(e){this.app=e}removeMarkdownFormatting(e){return e&&(e=e.replace(/\*\*(.*?)\*\*/g,"$1").replace(/__(.*?)__/g,"$1"),e=e.replace(/\*(.*?)\*/g,"$1").replace(/_(.*?)_/g,"$1"),e=e.replace(/`(.*?)`/g,"$1"),e=e.replace(/~~(.*?)~~/g,"$1"),e=e.replace(/==(.*?)==/g,"$1"),e=e.replace(/\[(.*?)\]\(.*?\)/g,"$1"),e.trim())}async parseCanvasFile(e){try{let i=await this.app.vault.read(e),t=JSON.parse(i),r=t.nodes.find(s=>s.type==="group"&&(s.label==="Mastered"||s.label==="\u5DF2\u638C\u63E1")),a=[];for(let s of t.nodes)if(s.type==="text"&&s.text){let o=this.parseTextNode(s,e.path);o&&(r&&this.isNodeInGroup(s,r)&&(o.mastered=!0),a.push(o))}return a}catch(i){return console.error(`Failed to parse canvas file ${e.path}:`,i),[]}}parseTextNode(e,i){if(!e.text)return null;let t=e.text.trim(),r="",a=[],s="";try{let o=t.split(`
`);if(o.length===0||(r=o[0].replace(/^#+\s*/,"").trim(),r=this.removeMarkdownFormatting(r),!r))return null;if(o.length>1){let n=-1,c=-1;for(let u=1;u<o.length;u++){let h=o[u].trim();if(h.startsWith("*")&&h.endsWith("*")&&h.length>2){let v=h.slice(1,-1).split(",").map(y=>y.trim()).filter(y=>y);a.push(...v),n=u}else if(h!==""){c=u;break}}if(c>0&&c<o.length){for(;c<o.length&&o[c].trim()==="";)c++;c<o.length&&(s=o.slice(c).join(`
`).trim())}else n===-1&&(s=o.slice(1).join(`
`).trim())}return r?{word:r.toLowerCase(),aliases:a.length>0?a:void 0,definition:s,source:i,nodeId:e.id,color:e.color}:null}catch(o){return console.error(`\u89E3\u6790\u8282\u70B9\u6587\u672C\u65F6\u51FA\u9519: ${o}`),null}}static isCanvasFile(e){return e.extension==="canvas"}async validateCanvasFile(e){var i;try{let t=await this.app.vault.read(e),r=(i=t==null?void 0:t.trim())!=null?i:"";if(r==="")return!0;let a=JSON.parse(r),s=!("nodes"in a)||Array.isArray(a.nodes),o=!("edges"in a)||Array.isArray(a.edges);return s&&o}catch(t){return!0}}isNodeInGroup(e,i){if(Array.isArray(e.group))return!!e.group.includes(i.id);let t=typeof e.x=="number"?e.x:0,r=typeof e.y=="number"?e.y:0,a=typeof e.width=="number"?e.width:200,s=typeof e.height=="number"?e.height:60,o=typeof i.x=="number"?i.x:0,l=typeof i.y=="number"?i.y:0,n=typeof i.width=="number"?i.width:300,c=typeof i.height=="number"?i.height:150,u=t,h=t+a,p=r,v=r+s,y=o,C=o+n,W=l,b=l+c;if(!(u>=y&&h<=C&&p>=W&&v<=b)){if(u<C&&h>y&&p<b&&v>W){let D=Math.max(u,y),E=Math.min(h,C),P=Math.max(p,W),S=Math.min(v,b),L=(E-D)*(S-P),G=a*s;return L>=G*.5}return!1}return!0}};function F(g,e,i){var b,f,_,D,E,P,S,L,G,U;if(!e.autoLayoutEnabled)return;let t=g.nodes.find(m=>m.type==="group"&&m.label==="Mastered"),r=V((b=e.cardWidth)!=null?b:260,120,800),a=V((f=e.cardHeight)!=null?f:120,60,800),s=V((_=e.horizontalGap)!=null?_:24,0,200),o=V((D=e.verticalGap)!=null?D:16,0,200),l=V((E=e.leftPadding)!=null?E:24,0,400),n=(P=e.minLeftX)!=null?P:0,c=Number.POSITIVE_INFINITY;t&&(c=t.x-l);let u=g.nodes.filter(m=>!(m.type!=="text"||t&&i.isNodeInGroup(m,t)));if(u.length===0)return;let h=(S=e.columnsAuto)!=null?S:!0,p=V((L=e.columns)!=null?L:3,1,(G=e.maxColumns)!=null?G:6);if(h){let k=Math.min(...u.map(ne=>ne.x),n),T=Math.max(c-k,r),H=r+s;p=Math.max(1,Math.min(Math.floor((T+s)/H),(U=e.maxColumns)!=null?U:6))}let v=u.slice().sort((m,k)=>m.y!==k.y?m.y-k.y:m.x-k.x),y=Math.max(n,function(){let m=v.length?v:u;return Math.min(...m.map(T=>T.x),n)}()),C=[];for(let m=0;m<p;m++)C.push(y+m*(r+s));let W=new Array(p).fill(v.length?Math.min(...v.map(m=>m.y)):0);for(let m of v){let k=0,T=W[0];for(let H=1;H<p;H++)W[H]<T&&(T=W[H],k=H);m.x=C[k],m.y=T,m.width=m.width||r,m.height=m.height||a,W[k]=T+(m.height||a)+o}}function de(g,e,i,t){var y,C,W,b,f;let r=V((y=i.groupInnerPadding)!=null?y:24,0,400),a=V((C=i.groupInnerGap)!=null?C:12,0,200),s=V((W=i.groupInnerColumns)!=null?W:2,1,8),o=V((b=i.cardWidth)!=null?b:260,120,800),l=V((f=i.cardHeight)!=null?f:120,60,800),n=g.nodes.filter(_=>_.type==="text"&&t.isNodeInGroup(_,e));if(n.length===0)return;let c=e.x+r,u=e.y+r,h=0;for(let _ of n)_.x=c,_.y=u,_.width=_.width||o,_.height=_.height||l,h++,h>=s?(h=0,c=e.x+r,u+=(_.height||l)+a):c+=(_.width||o)+a;let p=Math.max(...n.map(_=>_.x+(_.width||o)),e.x+2*r+s*o+(s-1)*a),v=Math.max(...n.map(_=>_.y+(_.height||l)),e.y+2*r+Math.ceil(n.length/s)*l+(Math.ceil(n.length/s)-1)*a);e.width=Math.max(e.width,p-e.x+r),e.height=Math.max(e.height,v-e.y+r)}function V(g,e,i){return Math.max(e,Math.min(i,g))}var q=class{constructor(e,i){this.app=e,this.settings=i}updateSettings(e){this.settings=e}genHex16(){let e=new Uint8Array(8);return(window.crypto||window.msCrypto).getRandomValues(e),Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}async addWordToCanvas(e,i,t,r,a){try{let s=this.app.vault.getAbstractFileByPath(e);if(!s||!(s instanceof re.TFile)||!x.isCanvasFile(s))return console.error(`\u65E0\u6548\u7684 Canvas \u6587\u4EF6: ${e}`),!1;a&&(a=a.filter(l=>l&&l.trim().length>0),a.length===0&&(a=void 0));let o=new x(this.app);return await this.app.vault.process(s,l=>{var S,L,G,U;let n=JSON.parse(l||'{"nodes":[],"edges":[]}');Array.isArray(n.nodes)||(n.nodes=[]);let c=this.genHex16(),u=(S=this.settings.cardWidth)!=null?S:260,h=(L=this.settings.cardHeight)!=null?L:120,p=(G=this.settings.verticalGap)!=null?G:16,v=(U=this.settings.leftPadding)!=null?U:24,y=(m,k)=>typeof m=="number"?m:k,C=m=>({x:y(m.x,0),y:y(m.y,0),w:y(m.width,200),h:y(m.height,60)}),W=(m,k,T,H)=>m<T+H&&m+k>T,b=n.nodes.find(m=>m.type==="group"&&m.label&&(m.label==="Mastered"||m.label==="\u5DF2\u638C\u63E1")),f=b?C(b):void 0,_=0,D=0;if(n.nodes.length>0){let m;for(let k=n.nodes.length-1;k>=0;k--){let T=n.nodes[k];if(T.type!=="group"){if(f){let H=C(T),ne=W(H.x,H.w,f.x,f.w),xe=W(H.y,H.h,f.y,f.h);if(ne&&xe)continue}m=T;break}}if(m){let k=C(m);_=k.x,D=k.y+k.h+p}}f&&W(_,u,f.x,f.w)&&(_=f.x+f.w+v);let E=i;a&&a.length>0&&(E=`${i}
*${a.join(", ")}*`),t&&(E=`${E}

${t}`);let P={id:c,type:"text",x:_,y:D,width:u,height:h,text:E,color:r!==void 0?r.toString():void 0};return n.nodes.push(P),F(n,this.settings,o),JSON.stringify(n)}),!0}catch(s){return console.error(`\u6DFB\u52A0\u8BCD\u6C47\u5230 Canvas \u5931\u8D25: ${s}`),!1}}async updateWordInCanvas(e,i,t,r,a,s){try{let o=this.app.vault.getAbstractFileByPath(e);if(!o||!(o instanceof re.TFile)||!x.isCanvasFile(o))return console.error(`\u65E0\u6548\u7684 Canvas \u6587\u4EF6: ${e}`),!1;s&&(s=s.filter(c=>c&&c.trim().length>0),s.length===0&&(s=void 0));let l=!1,n=new x(this.app);return await this.app.vault.process(o,c=>{let u=JSON.parse(c||'{"nodes":[],"edges":[]}');Array.isArray(u.nodes)||(u.nodes=[]);let h=u.nodes.findIndex(v=>v.id===i);if(h===-1)return console.error(`\u672A\u627E\u5230\u8282\u70B9: ${i}`),JSON.stringify(u);let p=t;return s&&s.length>0&&(p=`${t}
*${s.join(", ")}*`),r&&(p=`${p}

${r}`),u.nodes[h].text=p,a!==void 0&&(u.nodes[h].color=a.toString()),F(u,this.settings,n),l=!0,JSON.stringify(u)}),l}catch(o){return console.error(`\u66F4\u65B0 Canvas \u4E2D\u7684\u8BCD\u6C47\u5931\u8D25: ${o}`),!1}}async deleteWordFromCanvas(e,i){try{let t=this.app.vault.getAbstractFileByPath(e);if(!t||!(t instanceof re.TFile)||!x.isCanvasFile(t))return console.error(`\u65E0\u6548\u7684 Canvas \u6587\u4EF6: ${e}`),!1;let r=!1,a=new x(this.app);return await this.app.vault.process(t,s=>{let o=JSON.parse(s||'{"nodes":[],"edges":[]}');Array.isArray(o.nodes)||(o.nodes=[]);let l=o.nodes.findIndex(n=>n.id===i);return l===-1?(console.warn(`\u672A\u627E\u5230\u8981\u5220\u9664\u7684\u8282\u70B9: ${i}`),JSON.stringify(o)):(o.nodes.splice(l,1),F(o,this.settings,a),r=!0,JSON.stringify(o))}),r}catch(t){return console.error(`\u4ECE Canvas \u4E2D\u5220\u9664\u8BCD\u6C47\u5931\u8D25: ${t}`),!1}}};var ce=require("obsidian");var X=class{constructor(e,i){this.MASTERED_GROUP_LABEL="Mastered";this.MASTERED_GROUP_COLOR="4";this.app=e,this.canvasParser=new x(e),this.settings=i}updateSettings(e){this.settings=e}genHex16(){let e=new Uint8Array(8);return(window.crypto||window.msCrypto).getRandomValues(e),Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}async ensureMasteredGroup(e){try{let i=await this.loadCanvas(e);if(!i)return null;let t=i.nodes.find(r=>r.type==="group"&&r.label===this.MASTERED_GROUP_LABEL);return t||(t=this.createMasteredGroup(i),i.nodes.push(t),await this.saveCanvas(e,i)),t.id}catch(i){return null}}async moveToMasteredGroup(e,i){try{let t=await this.ensureMasteredGroup(e);if(!t)return!1;let r=await this.loadCanvas(e);if(!r)return!1;let a=r.nodes.find(l=>l.id===i),s=r.nodes.find(l=>l.id===t);if(!a||!s||!await this.moveNodeToGroupOptimized(a,s,r))return!1;try{this.settings&&(de(r,s,this.settings,this.canvasParser),F(r,this.settings,this.canvasParser))}catch(l){}return await this.saveCanvas(e,r),!0}catch(t){return!1}}async removeFromMasteredGroup(e,i){try{let t=await this.loadCanvas(e);if(!t)return!1;let r=t.nodes.find(s=>s.id===i);if(!r||!t.nodes.find(s=>s.type==="group"&&s.label===this.MASTERED_GROUP_LABEL))return!1;await this.moveNodeOutOfGroup(r,t);try{this.settings&&F(t,this.settings,this.canvasParser)}catch(s){}return await this.saveCanvas(e,t),!0}catch(t){return!1}}async isNodeInMasteredGroup(e,i){try{let t=await this.loadCanvas(e);if(!t)return!1;let r=t.nodes.find(s=>s.id===i);if(!r)return!1;let a=t.nodes.find(s=>s.type==="group"&&s.label===this.MASTERED_GROUP_LABEL);return a?this.canvasParser.isNodeInGroup(r,a):!1}catch(t){return!1}}createMasteredGroup(e){let i=this.genHex16(),{x:t,y:r}=this.calculateMasteredGroupPosition(e);return{id:i,type:"group",x:t,y:r,width:400,height:200,color:this.MASTERED_GROUP_COLOR,label:this.MASTERED_GROUP_LABEL}}calculateMasteredGroupPosition(e){let i=e.nodes.filter(h=>h.type==="text"||h.type==="group");if(i.length===0)return{x:50,y:50};let t=Math.min(...i.map(h=>h.x)),r=Math.max(...i.map(h=>h.x+(h.width||200))),a=Math.min(...i.map(h=>h.y)),s=Math.max(...i.map(h=>h.y+(h.height||100))),o=800,l=600,n=50,c=r+n,u=a;return c+o>3e3&&(c=t,u=s+n),{x:c,y:u}}async moveNodeToGroupOptimized(e,i,t){var r,a,s,o,l,n;try{let c=(a=(r=this.settings)==null?void 0:r.groupInnerPadding)!=null?a:24,u=(o=(s=this.settings)==null?void 0:s.cardWidth)!=null?o:260,h=(n=(l=this.settings)==null?void 0:l.cardHeight)!=null?n:120;return e.width=e.width||u,e.height=e.height||h,e.x=Math.max(i.x+c,i.x),e.y=Math.max(i.y+c,i.y),!0}catch(c){return!1}}async moveNodeOutOfGroup(e,i){var u,h,p,v,y,C,W,b;let t=i.nodes.find(f=>f.type==="group"&&f.label===this.MASTERED_GROUP_LABEL),r=i.nodes.filter(f=>f.type!=="text"||f.id===e.id?!1:t?!this.canvasParser.isNodeInGroup(f,t):!0),a=(h=(u=this.settings)==null?void 0:u.leftPadding)!=null?h:24,s=(v=(p=this.settings)==null?void 0:p.verticalGap)!=null?v:16,o=e.width||((C=(y=this.settings)==null?void 0:y.cardWidth)!=null?C:260),l=e.height||((b=(W=this.settings)==null?void 0:W.cardHeight)!=null?b:120);if(r.length===0){e.x=a,e.y=s;return}let n=Math.min(...r.map(f=>f.x),a),c=Math.max(...r.map(f=>f.y+(f.height||l)),0);if(e.x=n,e.y=c+s,t){let f=t.y+t.height;e.y<f+s&&(e.y=f+s)}}getGroupMembers(e,i,t){return i.nodes.filter(r=>r.id!==e.id&&r.id!==t&&r.type!=="group"&&this.canvasParser.isNodeInGroup(r,e))}async loadCanvas(e){try{let i=this.app.vault.getAbstractFileByPath(e);if(!(i instanceof ce.TFile))return null;let t=await this.app.vault.read(i);return JSON.parse(t)}catch(i){return null}}async saveCanvas(e,i){try{let t=this.app.vault.getAbstractFileByPath(e);return t instanceof ce.TFile?(await this.app.vault.process(t,()=>JSON.stringify(i)),!0):!1}catch(t){return!1}}};var K=class{constructor(e,i){this.definitions=new Map;this.wordDefinitionCache=new Map;this.allWordsCache=[];this.bookWordsCache=new Map;this.cacheValid=!1;this.memoryOnlyWords=new Map;this.pendingSyncWords=new Map;this.syncTimeouts=new Map;this.tempNodeIdCounter=0;this.app=e,this.canvasParser=new x(e),this.canvasEditor=new q(e,i),this.settings=i}async loadAllVocabularyBooks(){let e=performance.now();this.definitions.clear(),this.invalidateCache();let i=this.settings.vocabularyBooks.filter(r=>r.enabled).map(r=>this.loadVocabularyBook(r));await Promise.all(i),this.rebuildCache();let t=performance.now()}async loadVocabularyBook(e){let i=performance.now(),t=this.app.vault.getAbstractFileByPath(e.path);if(!t||!(t instanceof ue.TFile)){console.warn(`Canvas file not found: ${e.path}`);return}if(!x.isCanvasFile(t)){console.warn(`File is not a canvas: ${e.path}`);return}try{let r=await this.canvasParser.parseCanvasFile(t);this.definitions.set(e.path,r),this.invalidateCache();let a=performance.now()}catch(r){console.error(`Failed to load vocabulary book ${e.name}:`,r)}}getDefinition(e,i=new Set){let t=e.toLowerCase().trim();if(i.has(t))return null;if(i.add(t),this.cacheValid&&this.wordDefinitionCache.has(t))return this.wordDefinitionCache.get(t)||null;if(!this.cacheValid&&(this.rebuildCache(),this.wordDefinitionCache.has(t)))return this.wordDefinitionCache.get(t)||null;for(let r of this.definitions.values()){let a=r.find(o=>o.word===t);if(a)return this.wordDefinitionCache.set(t,a),a;let s=r.find(o=>o.aliases&&o.aliases.includes(t));if(s)return this.wordDefinitionCache.set(t,s),s}return null}getAllWords(){return this.cacheValid?[...this.allWordsCache]:(this.rebuildCache(),[...this.allWordsCache])}getAllWordsForHighlight(){if(!this.settings.enableMasteredFeature)return this.getAllWords();if(this.cacheValid){let i=[];for(let t of this.allWordsCache){let r=this.wordDefinitionCache.get(t);r&&!r.mastered&&i.push(t)}return i}this.rebuildCache();let e=[];for(let i of this.allWordsCache){let t=this.wordDefinitionCache.get(i);t&&!t.mastered&&e.push(i)}return e}getWordsFromBook(e){if(this.cacheValid&&this.bookWordsCache.has(e))return[...this.bookWordsCache.get(e)];let i=this.definitions.get(e);if(!i)return[];let t=[];t.push(...i.map(a=>a.word)),i.forEach(a=>{a.aliases&&a.aliases.length>0&&t.push(...a.aliases)});let r=[...new Set(t)];return this.bookWordsCache.set(e,r),r}async reloadVocabularyBook(e){let i=this.settings.vocabularyBooks.find(t=>t.path===e);i&&i.enabled&&(await this.loadVocabularyBook(i),this.invalidateCache())}updateSettings(e){this.settings=e,this.invalidateCache(),this.canvasEditor&&this.canvasEditor.updateSettings&&this.canvasEditor.updateSettings(e)}getSettings(){return this.settings}getStats(){let e=this.settings.vocabularyBooks.length,i=this.settings.vocabularyBooks.filter(r=>r.enabled).length,t=0;for(let r of this.definitions.values())t+=r.length;return{totalBooks:e,enabledBooks:i,totalWords:t}}hasWord(e){let i=e.toLowerCase().trim();return this.cacheValid?this.wordDefinitionCache.has(i):this.getDefinition(e)!==null}clear(){this.definitions.clear(),this.invalidateCache()}async addWordToCanvas(e,i,t,r,a){try{let s={word:i,definition:t,source:e,nodeId:this.generateTempNodeId(),color:r?this.getColorString(r):void 0,aliases:a==null?void 0:a.filter(o=>o&&o.trim().length>0)};return this.addWordToMemoryCache(e,s),this.rebuildCache(),this.scheduleCanvasSync(e,s),!0}catch(s){return console.error("Failed to add word to canvas:",s),!1}}invalidateCache(){this.cacheValid=!1,this.wordDefinitionCache.clear(),this.allWordsCache=[],this.bookWordsCache.clear()}rebuildCache(){let e=performance.now();this.wordDefinitionCache.clear(),this.allWordsCache=[],this.bookWordsCache.clear();let i=new Set;for(let[t,r]of this.definitions.entries()){let a=new Set;for(let s of r){let o=s.word.toLowerCase().trim();if(this.wordDefinitionCache.set(o,s),i.add(o),a.add(o),s.aliases&&s.aliases.length>0)for(let l of s.aliases){let n=l.toLowerCase().trim();this.wordDefinitionCache.set(n,s),i.add(n),a.add(n)}}this.bookWordsCache.set(t,[...a])}this.allWordsCache=[...i],this.cacheValid=!0}async updateWordInCanvas(e,i,t,r,a,s){try{if(await this.canvasEditor.updateWordInCanvas(e,i,t,r,a,s)){let l={word:t,definition:r,source:e,nodeId:i,color:a?this.getColorString(a):void 0,aliases:s==null?void 0:s.filter(n=>n&&n.trim().length>0)};return this.updateWordInMemoryCache(e,i,l),this.rebuildCache(),!0}return!1}catch(o){return console.error("Failed to update word in canvas:",o),!1}}generateTempNodeId(){return`temp_${Date.now()}_${++this.tempNodeIdCounter}`}getColorString(e){return e>=1&&e<=6?e.toString():void 0}addWordToMemoryCache(e,i){let t=this.definitions.get(e);t||(t=[],this.definitions.set(e,t));let r=t.findIndex(a=>a.word===i.word);r>=0?t[r]=i:t.push(i),this.wordDefinitionCache.set(i.word,i),i.aliases&&i.aliases.forEach(a=>{this.wordDefinitionCache.set(a,i)}),this.cacheValid=!1}updateWordInMemoryCache(e,i,t){let r=this.definitions.get(e);if(!r){console.warn(`\u672A\u627E\u5230\u4E66\u672C: ${e}`);return}let a=r.findIndex(s=>s.nodeId===i);if(a>=0){let s=r[a];this.wordDefinitionCache.delete(s.word),s.aliases&&s.aliases.forEach(o=>{this.wordDefinitionCache.delete(o)}),r[a]=t,this.wordDefinitionCache.set(t.word,t),t.aliases&&t.aliases.forEach(o=>{this.wordDefinitionCache.set(o,t)}),this.cacheValid=!1}else console.warn(`\u672A\u627E\u5230\u8282\u70B9ID: ${i}`)}scheduleCanvasSync(e,i){let t=this.syncTimeouts.get(e);t&&clearTimeout(t),this.pendingSyncWords.has(e)||this.pendingSyncWords.set(e,[]),this.pendingSyncWords.get(e).push(i);let r=setTimeout(()=>{this.syncPendingWords(e)},1e3);this.syncTimeouts.set(e,r)}async syncPendingWords(e){let i=this.pendingSyncWords.get(e);if(!(!i||i.length===0))try{for(let t of i)await this.canvasEditor.addWordToCanvas(e,t.word,t.definition,t.color?this.getColorNumber(t.color):void 0,t.aliases)&&(t.nodeId=`node_${Date.now()}_${Math.random().toString(36).substr(2,9)}`);this.pendingSyncWords.delete(e),this.syncTimeouts.delete(e)}catch(t){console.error("Failed to sync words to canvas:",t)}}getColorNumber(e){let i=parseInt(e,10);return i>=1&&i<=6?i:0}invalidateCacheForBook(e){let i=this.definitions.get(e);i&&i.forEach(t=>{this.wordDefinitionCache.delete(t.word),t.aliases&&t.aliases.forEach(r=>{this.wordDefinitionCache.delete(r)})}),this.cacheValid=!1}async deleteWordFromCanvas(e,i){try{return await this.canvasEditor.deleteWordFromCanvas(e,i)?(this.deleteWordFromMemoryCache(e,i),this.rebuildCache(),!0):!1}catch(t){return console.error("Failed to delete word from canvas:",t),!1}}deleteWordFromMemoryCache(e,i){let t=this.definitions.get(e);if(!t){console.warn(`\u672A\u627E\u5230\u4E66\u672C: ${e}`);return}let r=t.findIndex(a=>a.nodeId===i);if(r>=0){let a=t[r];this.wordDefinitionCache.delete(a.word),a.aliases&&a.aliases.forEach(o=>{this.wordDefinitionCache.delete(o)}),t.splice(r,1);let s=this.memoryOnlyWords.get(e);if(s){let o=s.findIndex(l=>l.nodeId===i);o>=0&&(s.splice(o,1),s.length===0&&this.memoryOnlyWords.delete(e))}this.cacheValid=!1}else console.warn(`\u672A\u627E\u5230\u8282\u70B9ID: ${i}`)}destroy(){this.syncTimeouts.forEach(e=>clearTimeout(e)),this.syncTimeouts.clear(),this.definitions.clear(),this.wordDefinitionCache.clear(),this.allWordsCache=[],this.bookWordsCache.clear(),this.memoryOnlyWords.clear(),this.pendingSyncWords.clear()}async getWordDefinitionByNodeId(e,i){let t=this.definitions.get(e);return t&&t.find(a=>a.nodeId===i)||null}async updateWordDefinition(e,i,t){let r=this.definitions.get(e);if(!r)return!1;let a=r.findIndex(o=>o.nodeId===i);if(a===-1)return!1;let s=r[a];r[a]=t,this.wordDefinitionCache.delete(s.word),s.aliases&&s.aliases.forEach(o=>this.wordDefinitionCache.delete(o)),this.wordDefinitionCache.set(t.word,t),t.aliases&&t.aliases.forEach(o=>this.wordDefinitionCache.set(o,t)),this.cacheValid=!1;try{await this.saveWordDefinitionToCanvas(e,i,t)}catch(o){console.error("\u4FDD\u5B58\u5355\u8BCD\u5B9A\u4E49\u5230 Canvas \u5931\u8D25:",o)}return!0}async saveWordDefinitionToCanvas(e,i,t){let r=this.app.vault.getAbstractFileByPath(e);if(!(r instanceof ue.TFile))throw new Error(`Canvas \u6587\u4EF6\u4E0D\u5B58\u5728: ${e}`);try{let a=await this.app.vault.read(r),s=JSON.parse(a),o=s.nodes.find(n=>n.id===t.nodeId);if(!o)throw new Error(`\u627E\u4E0D\u5230\u8282\u70B9 ID: ${t.nodeId}`);let l=t.word;t.aliases&&t.aliases.length>0&&(l+=`
*${t.aliases.join(", ")}*`),t.definition&&(l+=`
`+t.definition),o.text=l,await this.app.vault.modify(r,JSON.stringify(s))}catch(a){throw console.error("\u4FDD\u5B58 Canvas \u6587\u4EF6\u5931\u8D25:",a),a}}async getAllWordDefinitions(){let e=[];for(let i of this.definitions.values())e.push(...i);for(let i of this.memoryOnlyWords.values())e.push(...i);return e}async getWordDefinitionsByBook(e){let i=this.definitions.get(e)||[],t=this.memoryOnlyWords.get(e)||[];return[...i,...t]}async getUnmasteredWords(){this.cacheValid||this.rebuildCache();let e=[];for(let i of this.allWordsCache){let t=this.wordDefinitionCache.get(i);t&&!t.mastered&&e.push(i)}return e}async getMasteredWords(){this.cacheValid||this.rebuildCache();let e=[];for(let i of this.allWordsCache){let t=this.wordDefinitionCache.get(i);t&&t.mastered&&e.push(i)}return e}isWordMastered(e){let i=this.wordDefinitionCache.get(e.toLowerCase());return(i==null?void 0:i.mastered)===!0}};var N=require("obsidian");var ve={plugin_name:"HiWords",settings:{vocabulary_books:"Word books",add_vocabulary_book:"Add word book",remove_vocabulary_book:"Remove",show_definition_on_hover:"Show definition on hover",show_definition_on_hover_desc:"Show word definition when hovering over highlighted words",enable_auto_highlight:"Enable auto highlight",enable_auto_highlight_desc:"Automatically highlight words from vocabulary books while reading",highlight_style:"Highlight style",highlight_style_desc:"Choose how words are highlighted in text",style_underline:"Underline",style_background:"Background",style_bold:"Bold",style_dotted:"Dotted underline",style_wavy:"Wavy underline",save_settings:"Save settings",no_vocabulary_books:"No vocabulary books yet. Please add a Canvas file as a vocabulary book.",path:"Path",reload_book:"Reload this word book",statistics:"Statistics",total_books:"Total word books: {0}",enabled_books:"Enabled word books: {0}",total_words:"Total words: {0}",enable_mastered_feature:"Enable mastered feature",enable_mastered_feature_desc:"Mark mastered words to stop highlighting them. Sidebar shows grouped words",blur_definitions:"Blur content",blur_definitions_desc:"Blur content by default, reveal on hover. Great for learning\u2014recall before seeing the answer",tts_template:"TTS URL template",tts_template_desc:"Use {{word}} as placeholder, e.g. https://dict.youdao.com/dictvoice?audio={{word}}&type=2",auto_layout:"Canvas auto layout",enable_auto_layout:"Enable auto layout",enable_auto_layout_desc:"Automatically normalize layout after add/update/delete and group changes",card_size:"Card size (left area)",card_size_desc:"Width/height of cards for non-group nodes on the left",grid_gaps:"Grid gaps",grid_gaps_desc:"Horizontal/vertical gaps for the left grid",left_padding:"Left padding & min X",left_padding_desc:"Left padding from Mastered group and minimum X for the left area",columns_auto:"Auto columns",columns_auto_desc:"Auto determine columns (bounded by max columns)",columns:"Fixed columns / Max columns",columns_desc:"Specify fixed columns and max columns (effective when auto columns off)",group_inner_layout:"Group inner layout",group_inner_layout_desc:"Inner padding, gaps and columns for nodes inside groups"},sidebar:{title:"HiWords",empty_state:"No words found. Add words to your vocabulary books to see them here.",source_prefix:"From: ",found:"Found",words:"words",no_definition:"No definition available.",vocabulary_book:"Words",mastered:"Mastered",no_learning_words:"No words to learn",no_mastered_words:"No mastered words"},commands:{refresh_vocabulary:"Refresh vocabulary",add_word:"HiWords: Add word",edit_word:"HiWords: Edit word",show_sidebar:"Show HiWords sidebar"},notices:{vocabulary_refreshed:"Vocabulary books refreshed",word_added:"Word added to vocabulary book",word_exists:"Word already exists in vocabulary book",error_adding_word:"Error adding word to vocabulary book",select_book_required:"Please select a vocabulary book",adding_word:"Adding word to vocabulary book...",updating_word:"Updating word...",word_added_success:'Word "{0}" successfully added to vocabulary book',word_updated_success:'Word "{0}" successfully updated',add_word_failed:"Failed to add word, please check the vocabulary book file",update_word_failed:"Failed to update word, please check the vocabulary book file",error_processing_word:"Error processing word",no_canvas_files:"No Canvas files found",book_already_exists:"This vocabulary book already exists",invalid_canvas_file:"Invalid Canvas file",book_added:"Added vocabulary book: {0}",book_reloaded:"Reloaded vocabulary book: {0}",book_removed:"Removed vocabulary book: {0}",deleting_word:"Deleting word...",word_deleted:"Word deleted",delete_word_failed:"Failed to delete word, please check the vocabulary book file",error_deleting_word:"Error occurred while deleting word",mastered_feature_disabled:"Mastered feature is not enabled",update_word_status_failed:"Failed to update word status",move_to_mastered_group_failed:"Failed to move to mastered group",word_marked_as_mastered:'"{0}" marked as mastered',mark_mastered_failed:"Failed to mark as mastered, please try again",remove_from_mastered_group_failed:"Failed to remove from mastered group",word_unmarked_as_mastered:'"{0}" unmarked as mastered',unmark_mastered_failed:"Failed to unmark as mastered, please try again",batch_marked_success:"Successfully marked {0} words as mastered"},modals:{add_word_title:"Add ",edit_word_title:"Edit ",word_label:"Word",definition_label:"Definition",book_label:"Vocabulary book",select_book:"Select a vocabulary book",color_label:"Card color",color_gray:"Gray",color_red:"Red",color_orange:"Orange",color_yellow:"Yellow",color_green:"Green",color_blue:"Blue",color_purple:"Purple",aliases_label:"Aliases (optional, comma separated)",aliases_placeholder:"e.g.: doing, done, did",definition_placeholder:"Enter word definition...",add_button:"Add",save_button:"Save",cancel_button:"Cancel",select_canvas_file:"Select vocabulary book file",delete_confirmation:`Are you sure you want to delete the word "{0}"?
This action cannot be undone.`}};var be={plugin_name:"HiWords",settings:{vocabulary_books:"\u5355\u8BCD\u672C",add_vocabulary_book:"\u6DFB\u52A0\u5355\u8BCD\u672C",remove_vocabulary_book:"\u79FB\u9664",show_definition_on_hover:"\u60AC\u505C\u663E\u793A\u91CA\u4E49",show_definition_on_hover_desc:"\u9F20\u6807\u60AC\u505C\u5728\u9AD8\u4EAE\u8BCD\u6C47\u4E0A\u65F6\u663E\u793A\u5B9A\u4E49",enable_auto_highlight:"\u542F\u7528\u81EA\u52A8\u9AD8\u4EAE",enable_auto_highlight_desc:"\u5728\u9605\u8BFB\u65F6\u81EA\u52A8\u9AD8\u4EAE\u751F\u8BCD\u672C\u4E2D\u7684\u8BCD\u6C47",highlight_style:"\u9AD8\u4EAE\u6837\u5F0F",highlight_style_desc:"\u9009\u62E9\u5355\u8BCD\u5728\u6587\u672C\u4E2D\u7684\u9AD8\u4EAE\u663E\u793A\u65B9\u5F0F",style_underline:"\u4E0B\u5212\u7EBF",style_background:"\u80CC\u666F\u9AD8\u4EAE",style_bold:"\u7C97\u4F53",style_dotted:"\u70B9\u72B6\u4E0B\u5212\u7EBF",style_wavy:"\u6CE2\u6D6A\u7EBF",save_settings:"\u4FDD\u5B58\u8BBE\u7F6E",no_vocabulary_books:"\u6682\u65E0\u5355\u8BCD\u672C\uFF0C\u8BF7\u6DFB\u52A0 Canvas \u6587\u4EF6\u4F5C\u4E3A\u5355\u8BCD\u672C",path:"\u8DEF\u5F84",reload_book:"\u91CD\u65B0\u89E3\u6790\u8BE5\u5355\u8BCD\u672C",statistics:"\u7EDF\u8BA1\u4FE1\u606F",total_books:"\u603B\u5355\u8BCD\u672C\u6570\u91CF: {0}",enabled_books:"\u5DF2\u542F\u7528\u5355\u8BCD\u672C: {0}",total_words:"\u603B\u8BCD\u6C47\u6570\u91CF: {0}",enable_mastered_feature:"\u542F\u7528\u5DF2\u638C\u63E1\u529F\u80FD",enable_mastered_feature_desc:"\u6807\u8BB0\u5DF2\u638C\u63E1\u5355\u8BCD\u4EE5\u505C\u6B62\u9AD8\u4EAE\u663E\u793A\u3002\u4FA7\u8FB9\u680F\u663E\u793A\u5206\u7EC4\u5355\u8BCD",blur_definitions:"\u6A21\u7CCA\u5185\u5BB9",blur_definitions_desc:"\u9ED8\u8BA4\u6A21\u7CCA\u663E\u793A\u5185\u5BB9\uFF0C\u9F20\u6807\u60AC\u505C\u65F6\u663E\u793A\u6E05\u6670\u5185\u5BB9\u3002\u9002\u5408\u5B66\u4E60\u65F6\u5148\u56DE\u5FC6\u518D\u67E5\u770B\u7B54\u6848",tts_template:"\u53D1\u97F3\u5730\u5740\u6A21\u677F",tts_template_desc:"\u4F7F\u7528 {{word}} \u4F5C\u4E3A\u5360\u4F4D\u7B26\uFF0C\u4F8B\u5982\uFF1Ahttps://dict.youdao.com/dictvoice?audio={{word}}&type=2",auto_layout:"\u767D\u677F\u81EA\u52A8\u5E03\u5C40",enable_auto_layout:"\u542F\u7528\u81EA\u52A8\u5E03\u5C40",enable_auto_layout_desc:"\u5728\u6DFB\u52A0/\u66F4\u65B0/\u5220\u9664\u8282\u70B9\u548C\u5206\u7EC4\u53D8\u66F4\u540E\u81EA\u52A8\u89C4\u8303\u5316\u5E03\u5C40",card_size:"\u5361\u7247\u5C3A\u5BF8\uFF08\u5DE6\u4FA7\u533A\u57DF\uFF09",card_size_desc:"\u7528\u4E8E\u5DE6\u4FA7\u975E\u5206\u7EC4\u8282\u70B9\u7684\u5361\u7247\u5BBD/\u9AD8",grid_gaps:"\u7F51\u683C\u95F4\u8DDD",grid_gaps_desc:"\u5DE6\u4FA7\u533A\u57DF\u7F51\u683C\u7684\u6C34\u5E73/\u5782\u76F4\u95F4\u8DDD",left_padding:"\u5DE6\u4FA7\u7559\u767D\u4E0E\u6700\u5C0FX",left_padding_desc:"Mastered \u5206\u7EC4\u5DE6\u4FA7\u7684\u7559\u767D\u4E0E\u5DE6\u4FA7\u533A\u57DF\u7684\u6700\u5C0F X \u4F4D\u7F6E",columns_auto:"\u81EA\u52A8\u5217\u6570",columns_auto_desc:"\u6839\u636E\u5185\u5BB9\u81EA\u9002\u5E94\u5217\u6570\uFF08\u53D7\u6700\u5927\u5217\u6570\u9650\u5236\uFF09",columns:"\u56FA\u5B9A\u5217\u6570/\u6700\u5927\u5217\u6570",columns_desc:"\u6307\u5B9A\u56FA\u5B9A\u5217\u6570\u4E0E\u6700\u5927\u5217\u6570\uFF08\u5F53\u5173\u95ED\u81EA\u52A8\u5217\u6570\u65F6\u751F\u6548\uFF09",group_inner_layout:"\u5206\u7EC4\u5185\u5E03\u5C40",group_inner_layout_desc:"\u5206\u7EC4\u5185\u90E8\u7684\u5185\u8FB9\u8DDD\u3001\u95F4\u8DDD\u4E0E\u5217\u6570\u8BBE\u7F6E"},sidebar:{title:"HiWords",empty_state:"\u672A\u627E\u5230\u5355\u8BCD\u3002\u6DFB\u52A0\u5355\u8BCD\u5230\u60A8\u7684\u751F\u8BCD\u672C\u4EE5\u5728\u6B64\u5904\u67E5\u770B\u3002",source_prefix:"\u6765\u81EA: ",found:"\u53D1\u73B0",words:"\u4E2A\u751F\u8BCD",no_definition:"\u6682\u65E0\u5B9A\u4E49",vocabulary_book:"\u8BCD\u6C47",mastered:"\u5DF2\u638C\u63E1",no_learning_words:"\u6CA1\u6709\u5F85\u5B66\u4E60\u7684\u5355\u8BCD",no_mastered_words:"\u6CA1\u6709\u5DF2\u638C\u63E1\u7684\u5355\u8BCD"},commands:{refresh_vocabulary:"\u5237\u65B0\u751F\u8BCD\u672C",add_word:"HiWords: \u6DFB\u52A0\u5355\u8BCD",edit_word:"HiWords: \u7F16\u8F91\u5355\u8BCD",show_sidebar:"\u663E\u793A HiWords \u4FA7\u8FB9\u680F"},notices:{vocabulary_refreshed:"\u751F\u8BCD\u672C\u5DF2\u5237\u65B0",word_added:"\u5355\u8BCD\u5DF2\u6DFB\u52A0\u5230\u751F\u8BCD\u672C",word_exists:"\u5355\u8BCD\u5DF2\u5B58\u5728\u4E8E\u751F\u8BCD\u672C\u4E2D",error_adding_word:"\u6DFB\u52A0\u5355\u8BCD\u5230\u751F\u8BCD\u672C\u65F6\u51FA\u9519",select_book_required:"\u8BF7\u9009\u62E9\u751F\u8BCD\u672C",adding_word:"\u6B63\u5728\u6DFB\u52A0\u8BCD\u6C47\u5230\u751F\u8BCD\u672C...",updating_word:"\u6B63\u5728\u66F4\u65B0\u8BCD\u6C47...",word_added_success:'\u8BCD\u6C47 "{0}" \u5DF2\u6210\u529F\u6DFB\u52A0\u5230\u751F\u8BCD\u672C',word_updated_success:'\u8BCD\u6C47 "{0}" \u5DF2\u6210\u529F\u66F4\u65B0',add_word_failed:"\u6DFB\u52A0\u8BCD\u6C47\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u751F\u8BCD\u672C\u6587\u4EF6",update_word_failed:"\u66F4\u65B0\u8BCD\u6C47\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u751F\u8BCD\u672C\u6587\u4EF6",error_processing_word:"\u5904\u7406\u8BCD\u6C47\u65F6\u51FA\u9519",no_canvas_files:"\u672A\u627E\u5230 Canvas \u6587\u4EF6",book_already_exists:"\u8BE5\u751F\u8BCD\u672C\u5DF2\u5B58\u5728",invalid_canvas_file:"\u65E0\u6548\u7684 Canvas \u6587\u4EF6",book_added:"\u5DF2\u6DFB\u52A0\u751F\u8BCD\u672C: {0}",book_reloaded:"\u5DF2\u91CD\u65B0\u52A0\u8F7D: {0}",book_removed:"\u5DF2\u5220\u9664\u751F\u8BCD\u672C: {0}",deleting_word:"\u6B63\u5728\u5220\u9664\u8BCD\u6C47...",word_deleted:"\u8BCD\u6C47\u5DF2\u5220\u9664",delete_word_failed:"\u5220\u9664\u8BCD\u6C47\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u751F\u8BCD\u672C\u6587\u4EF6",error_deleting_word:"\u5220\u9664\u8BCD\u6C47\u65F6\u53D1\u751F\u9519\u8BEF",mastered_feature_disabled:"\u5DF2\u638C\u63E1\u529F\u80FD\u672A\u542F\u7528",update_word_status_failed:"\u66F4\u65B0\u5355\u8BCD\u72B6\u6001\u5931\u8D25",move_to_mastered_group_failed:"\u79FB\u52A8\u5230\u5DF2\u638C\u63E1\u5206\u7EC4\u5931\u8D25",word_marked_as_mastered:'"{0}"\u5DF2\u6807\u8BB0\u4E3A\u5DF2\u638C\u63E1',mark_mastered_failed:"\u6807\u8BB0\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5",remove_from_mastered_group_failed:"\u4ECE\u5DF2\u638C\u63E1\u5206\u7EC4\u79FB\u9664\u5931\u8D25",word_unmarked_as_mastered:'"{0}"\u5DF2\u53D6\u6D88\u5DF2\u638C\u63E1\u6807\u8BB0',unmark_mastered_failed:"\u53D6\u6D88\u6807\u8BB0\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5",batch_marked_success:"\u6210\u529F\u6807\u8BB0 {0} \u4E2A\u5355\u8BCD\u4E3A\u5DF2\u638C\u63E1"},modals:{add_word_title:"\u6DFB\u52A0 ",edit_word_title:"\u7F16\u8F91 ",word_label:"\u5355\u8BCD",definition_label:"\u91CA\u4E49",book_label:"\u5355\u8BCD\u672C",select_book:"\u9009\u62E9\u5355\u8BCD\u672C",color_label:"\u5361\u7247\u989C\u8272",color_gray:"\u7070\u8272",color_red:"\u7EA2\u8272",color_orange:"\u6A59\u8272",color_yellow:"\u9EC4\u8272",color_green:"\u7EFF\u8272",color_blue:"\u84DD\u8272",color_purple:"\u7D2B\u8272",aliases_label:"\u522B\u540D\uFF08\u53EF\u9009\uFF0C\u7528\u9017\u53F7\u5206\u9694\uFF09",aliases_placeholder:"\u4F8B\u5982\uFF1Adoing, done, did",definition_placeholder:"\u8F93\u5165\u8BCD\u6C47\u91CA\u4E49...",add_button:"\u6DFB\u52A0",save_button:"\u4FDD\u5B58",cancel_button:"\u53D6\u6D88",select_canvas_file:"\u9009\u62E9 Canvas \u6587\u4EF6",delete_confirmation:`\u786E\u5B9A\u8981\u5220\u9664\u8BCD\u6C47 "{0}" \u5417\uFF1F
\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`}};var we={plugin_name:"HiWords",settings:{vocabulary_books:"Libros de palabras",add_vocabulary_book:"Agregar libro de palabras",remove_vocabulary_book:"Eliminar",show_definition_on_hover:"Mostrar definici\xF3n al pasar el cursor",show_definition_on_hover_desc:"Mostrar la definici\xF3n al pasar el cursor sobre palabras resaltadas",enable_auto_highlight:"Habilitar resaltado autom\xE1tico",enable_auto_highlight_desc:"Resaltar autom\xE1ticamente palabras de los libros mientras lees",highlight_style:"Estilo de resaltado",highlight_style_desc:"Elige c\xF3mo se resaltan las palabras en el texto",style_underline:"Subrayado",style_background:"Fondo",style_bold:"Negrita",style_dotted:"Subrayado punteado",style_wavy:"Subrayado ondulado",save_settings:"Guardar ajustes",no_vocabulary_books:"A\xFAn no hay libros. Agrega un archivo Canvas como libro de palabras.",path:"Ruta",reload_book:"Recargar este libro",statistics:"Estad\xEDsticas",total_books:"Libros totales: {0}",enabled_books:"Libros habilitados: {0}",total_words:"Palabras totales: {0}",enable_mastered_feature:"Habilitar funci\xF3n de dominadas",enable_mastered_feature_desc:"Marca palabras dominadas para dejar de resaltarlas. La barra lateral muestra grupos",blur_definitions:"Difuminar contenido",blur_definitions_desc:"Difuminar por defecto, mostrar al pasar el cursor. Ideal para recordar antes de ver la respuesta",auto_layout:"Auto Layout",enable_auto_layout:"Habilitar auto layout",enable_auto_layout_desc:"Normaliza autom\xE1ticamente el dise\xF1o tras a\xF1adir/actualizar/eliminar y cambios de grupos",card_size:"Tama\xF1o de tarjeta (\xE1rea izquierda)",card_size_desc:"Ancho/alto de tarjetas para nodos sin grupo a la izquierda",grid_gaps:"Espacios de la cuadr\xEDcula",grid_gaps_desc:"Espacios horizontal/vertical para la cuadr\xEDcula izquierda",left_padding:"Relleno izquierdo y X m\xEDnima",left_padding_desc:"Relleno izquierdo desde el grupo Mastered y X m\xEDnima para el \xE1rea izquierda",columns_auto:"Columnas autom\xE1ticas",columns_auto_desc:"Determinar columnas autom\xE1ticamente (limitado por columnas m\xE1ximas)",columns:"Columnas fijas / M\xE1ximo de columnas",columns_desc:"Especificar columnas fijas y m\xE1ximo de columnas (efectivo cuando auto est\xE1 desactivado)",group_inner_layout:"Dise\xF1o interno del grupo",group_inner_layout_desc:"Relleno interno, espacios y columnas para nodos dentro de grupos"},sidebar:{title:"HiWords",empty_state:"No se encontraron palabras. Agrega palabras a tus libros para verlas aqu\xED.",source_prefix:"De: ",found:"Encontradas",words:"palabras",no_definition:"Sin definici\xF3n disponible.",vocabulary_book:"Palabras",mastered:"Dominadas",no_learning_words:"No hay palabras para aprender",no_mastered_words:"No hay palabras dominadas"},commands:{refresh_vocabulary:"Actualizar vocabulario",add_word:"HiWords: Agregar palabra",edit_word:"HiWords: Editar palabra",show_sidebar:"Mostrar barra lateral de HiWords"},notices:{vocabulary_refreshed:"Libros actualizados",word_added:"Palabra agregada al libro",word_exists:"La palabra ya existe en el libro",error_adding_word:"Error al agregar palabra al libro",select_book_required:"Selecciona un libro de palabras",adding_word:"Agregando palabra al libro...",updating_word:"Actualizando palabra...",word_added_success:'La palabra "{0}" se agreg\xF3 correctamente',word_updated_success:'La palabra "{0}" se actualiz\xF3 correctamente',add_word_failed:"No se pudo agregar la palabra, revisa el archivo del libro",update_word_failed:"No se pudo actualizar la palabra, revisa el archivo del libro",error_processing_word:"Error al procesar la palabra",no_canvas_files:"No se encontraron archivos Canvas",book_already_exists:"Este libro ya existe",invalid_canvas_file:"Archivo Canvas no v\xE1lido",book_added:"Libro agregado: {0}",book_reloaded:"Libro recargado: {0}",book_removed:"Libro eliminado: {0}",deleting_word:"Eliminando palabra...",word_deleted:"Palabra eliminada",delete_word_failed:"No se pudo eliminar la palabra, revisa el archivo del libro",error_deleting_word:"Ocurri\xF3 un error al eliminar la palabra",mastered_feature_disabled:"La funci\xF3n de dominadas no est\xE1 habilitada",update_word_status_failed:"No se pudo actualizar el estado de la palabra",move_to_mastered_group_failed:"No se pudo mover al grupo de dominadas",word_marked_as_mastered:'"{0}" marcada como dominada',mark_mastered_failed:"No se pudo marcar como dominada, int\xE9ntalo de nuevo",remove_from_mastered_group_failed:"No se pudo quitar del grupo de dominadas",word_unmarked_as_mastered:'"{0}" desmarcada como dominada',unmark_mastered_failed:"No se pudo desmarcar, int\xE9ntalo de nuevo",batch_marked_success:"Se marcaron correctamente {0} palabras como dominadas"},modals:{add_word_title:"Agregar ",edit_word_title:"Editar ",word_label:"Palabra",definition_label:"Definici\xF3n",book_label:"Libro de palabras",select_book:"Selecciona un libro",color_label:"Color de tarjeta",color_gray:"Gris",color_red:"Rojo",color_orange:"Naranja",color_yellow:"Amarillo",color_green:"Verde",color_blue:"Azul",color_purple:"P\xFArpura",aliases_label:"Alias (opcional, separados por comas)",aliases_placeholder:"p. ej.: doing, done, did",definition_placeholder:"Introduce la definici\xF3n...",add_button:"Agregar",save_button:"Guardar",cancel_button:"Cancelar",select_canvas_file:"Seleccionar archivo del libro",delete_confirmation:`\xBFSeguro que deseas eliminar la palabra "{0}"?
Esta acci\xF3n no se puede deshacer.`}};var ye={plugin_name:"HiWords",settings:{vocabulary_books:"Livres de mots",add_vocabulary_book:"Ajouter un livre",remove_vocabulary_book:"Supprimer",show_definition_on_hover:"Afficher la d\xE9finition au survol",show_definition_on_hover_desc:"Afficher la d\xE9finition en survolant les mots surlign\xE9s",enable_auto_highlight:"Activer le surlignage auto",enable_auto_highlight_desc:"Surligner automatiquement les mots des livres pendant la lecture",highlight_style:"Style de surlignage",highlight_style_desc:"Choisissez la fa\xE7on dont les mots sont surlign\xE9s",style_underline:"Soulign\xE9",style_background:"Fond",style_bold:"Gras",style_dotted:"Soulign\xE9 en pointill\xE9s",style_wavy:"Soulign\xE9 ondul\xE9",save_settings:"Enregistrer les r\xE9glages",no_vocabulary_books:"Aucun livre pour l'instant. Ajoutez un fichier Canvas comme livre de mots.",path:"Chemin",reload_book:"Recharger ce livre",statistics:"Statistiques",total_books:"Livres au total : {0}",enabled_books:"Livres activ\xE9s : {0}",total_words:"Mots au total : {0}",enable_mastered_feature:"Activer la fonction ma\xEEtris\xE9",enable_mastered_feature_desc:"Marquez les mots ma\xEEtris\xE9s pour ne plus les surligner. La barre lat\xE9rale affiche des groupes",blur_definitions:"Flouter le contenu",blur_definitions_desc:"Flouter par d\xE9faut, r\xE9v\xE9ler au survol. Id\xE9al pour m\xE9moriser avant de voir la r\xE9ponse",auto_layout:"Disposition auto",enable_auto_layout:"Activer disposition auto",enable_auto_layout_desc:"Normaliser automatiquement la disposition apr\xE8s ajout/mise \xE0 jour/suppression et changements de groupes",card_size:"Taille de carte (zone gauche)",card_size_desc:"Largeur/hauteur des cartes pour les n\u0153uds non group\xE9s \xE0 gauche",grid_gaps:"Espacement de la grille",grid_gaps_desc:"Espacement horizontal/vertical pour la grille de gauche",left_padding:"Marge gauche et X min",left_padding_desc:"Marge gauche depuis le groupe Mastered et X minimale pour la zone gauche",columns_auto:"Colonnes auto",columns_auto_desc:"D\xE9terminer automatiquement les colonnes (limit\xE9 par le max)",columns:"Colonnes fixes / Colonnes max",columns_desc:"Sp\xE9cifier colonnes fixes et max (quand auto est d\xE9sactiv\xE9)",group_inner_layout:"Disposition interne du groupe",group_inner_layout_desc:"Marge interne, espacements et colonnes pour les n\u0153uds dans les groupes"},sidebar:{title:"HiWords",empty_state:"Aucun mot trouv\xE9. Ajoutez des mots \xE0 vos livres pour les voir ici.",source_prefix:"De : ",found:"Trouv\xE9s",words:"mots",no_definition:"Aucune d\xE9finition disponible.",vocabulary_book:"Mots",mastered:"Ma\xEEtris\xE9s",no_learning_words:"Aucun mot \xE0 apprendre",no_mastered_words:"Aucun mot ma\xEEtris\xE9"},commands:{refresh_vocabulary:"Actualiser le vocabulaire",add_word:"HiWords : Ajouter un mot",edit_word:"HiWords : \xC9diter un mot",show_sidebar:"Afficher la barre lat\xE9rale HiWords"},notices:{vocabulary_refreshed:"Livres actualis\xE9s",word_added:"Mot ajout\xE9 au livre",word_exists:"Le mot existe d\xE9j\xE0 dans le livre",error_adding_word:"Erreur lors de l'ajout du mot au livre",select_book_required:"Veuillez s\xE9lectionner un livre de mots",adding_word:"Ajout du mot au livre...",updating_word:"Mise \xE0 jour du mot...",word_added_success:'Le mot "{0}" a \xE9t\xE9 ajout\xE9 avec succ\xE8s',word_updated_success:'Le mot "{0}" a \xE9t\xE9 mis \xE0 jour avec succ\xE8s',add_word_failed:"\xC9chec de l'ajout du mot, v\xE9rifiez le fichier du livre",update_word_failed:"\xC9chec de la mise \xE0 jour, v\xE9rifiez le fichier du livre",error_processing_word:"Erreur lors du traitement du mot",no_canvas_files:"Aucun fichier Canvas trouv\xE9",book_already_exists:"Ce livre existe d\xE9j\xE0",invalid_canvas_file:"Fichier Canvas invalide",book_added:"Livre ajout\xE9 : {0}",book_reloaded:"Livre recharg\xE9 : {0}",book_removed:"Livre supprim\xE9 : {0}",deleting_word:"Suppression du mot...",word_deleted:"Mot supprim\xE9",delete_word_failed:"\xC9chec de la suppression du mot, v\xE9rifiez le fichier du livre",error_deleting_word:"Une erreur est survenue lors de la suppression du mot",mastered_feature_disabled:"La fonction ma\xEEtris\xE9 n'est pas activ\xE9e",update_word_status_failed:"\xC9chec de la mise \xE0 jour du statut du mot",move_to_mastered_group_failed:"\xC9chec du d\xE9placement vers le groupe ma\xEEtris\xE9",word_marked_as_mastered:'"{0}" marqu\xE9 comme ma\xEEtris\xE9',mark_mastered_failed:"\xC9chec du marquage, veuillez r\xE9essayer",remove_from_mastered_group_failed:"\xC9chec du retrait du groupe ma\xEEtris\xE9",word_unmarked_as_mastered:'"{0}" retir\xE9 du statut ma\xEEtris\xE9',unmark_mastered_failed:"\xC9chec du retrait du statut, veuillez r\xE9essayer",batch_marked_success:"{0} mots marqu\xE9s comme ma\xEEtris\xE9s avec succ\xE8s"},modals:{add_word_title:"Ajouter ",edit_word_title:"\xC9diter ",word_label:"Mot",definition_label:"D\xE9finition",book_label:"Livre de mots",select_book:"S\xE9lectionnez un livre",color_label:"Couleur de la carte",color_gray:"Gris",color_red:"Rouge",color_orange:"Orange",color_yellow:"Jaune",color_green:"Vert",color_blue:"Bleu",color_purple:"Violet",aliases_label:"Alias (facultatif, s\xE9par\xE9s par des virgules)",aliases_placeholder:"ex. : doing, done, did",definition_placeholder:"Saisissez la d\xE9finition...",add_button:"Ajouter",save_button:"Enregistrer",cancel_button:"Annuler",select_canvas_file:"S\xE9lectionner le fichier du livre",delete_confirmation:`Voulez-vous vraiment supprimer le mot "{0}" ?
Cette action est irr\xE9versible.`}};var We={plugin_name:"HiWords",settings:{vocabulary_books:"W\xF6rterb\xFCcher",add_vocabulary_book:"W\xF6rterbuch hinzuf\xFCgen",remove_vocabulary_book:"Entfernen",show_definition_on_hover:"Definition beim Hover anzeigen",show_definition_on_hover_desc:"Definition anzeigen, wenn der Mauszeiger \xFCber hervorgehobene W\xF6rter f\xE4hrt",enable_auto_highlight:"Automatisches Hervorheben aktivieren",enable_auto_highlight_desc:"W\xF6rter aus den W\xF6rterb\xFCchern beim Lesen automatisch hervorheben",highlight_style:"Hervorhebungsstil",highlight_style_desc:"W\xE4hlen Sie, wie W\xF6rter im Text hervorgehoben werden",style_underline:"Unterstreichen",style_background:"Hintergrund",style_bold:"Fett",style_dotted:"Gepunktete Unterstreichung",style_wavy:"Wellenf\xF6rmige Unterstreichung",save_settings:"Einstellungen speichern",no_vocabulary_books:"Noch keine W\xF6rterb\xFCcher. F\xFCgen Sie eine Canvas-Datei als W\xF6rterbuch hinzu.",path:"Pfad",reload_book:"Dieses W\xF6rterbuch neu laden",statistics:"Statistiken",total_books:"Gesamtzahl der W\xF6rterb\xFCcher: {0}",enabled_books:"Aktivierte W\xF6rterb\xFCcher: {0}",total_words:"Gesamtzahl der W\xF6rter: {0}",enable_mastered_feature:"Funktion 'Gemeistert' aktivieren",enable_mastered_feature_desc:"Gemeisterte W\xF6rter markieren, um sie nicht mehr hervorzuheben. Seitenleiste zeigt Gruppen",blur_definitions:"Inhalt verwischen",blur_definitions_desc:"Standardm\xE4\xDFig verwischen, beim Hover anzeigen. Ideal zum Lernen \u2013 erinnern vor der Antwort",auto_layout:"Automatisches Layout",enable_auto_layout:"Automatisches Layout aktivieren",enable_auto_layout_desc:"Layout nach Hinzuf\xFCgen/Aktualisieren/L\xF6schen und Gruppen\xE4nderungen automatisch normalisieren",card_size:"Kartengr\xF6\xDFe (linker Bereich)",card_size_desc:"Breite/H\xF6he der Karten f\xFCr nicht gruppierte Knoten links",grid_gaps:"Gitterabst\xE4nde",grid_gaps_desc:"Horizontale/vertikale Abst\xE4nde f\xFCr das linke Gitter",left_padding:"Linker Innenabstand & min. X",left_padding_desc:"Linker Abstand zur Gruppe 'Mastered' und minimale X-Position f\xFCr den linken Bereich",columns_auto:"Automatische Spalten",columns_auto_desc:"Spalten automatisch bestimmen (begrenzt durch maximale Spalten)",columns:"Feste Spalten / Maximale Spalten",columns_desc:"Feste Spalten und Maximalspalten angeben (wirksam, wenn auto aus)",group_inner_layout:"Inneres Gruppenlayout",group_inner_layout_desc:"Innenabstand, Abst\xE4nde und Spalten f\xFCr Knoten in Gruppen"},sidebar:{title:"HiWords",empty_state:"Keine W\xF6rter gefunden. F\xFCgen Sie W\xF6rter zu Ihren W\xF6rterb\xFCchern hinzu, um sie hier zu sehen.",source_prefix:"Von: ",found:"Gefunden",words:"W\xF6rter",no_definition:"Keine Definition verf\xFCgbar.",vocabulary_book:"W\xF6rter",mastered:"Gemeistert",no_learning_words:"Keine zu lernenden W\xF6rter",no_mastered_words:"Keine gemeisterten W\xF6rter"},commands:{refresh_vocabulary:"Vokabular aktualisieren",add_word:"HiWords: Wort hinzuf\xFCgen",edit_word:"HiWords: Wort bearbeiten",show_sidebar:"HiWords-Seitenleiste anzeigen"},notices:{vocabulary_refreshed:"W\xF6rterb\xFCcher aktualisiert",word_added:"Wort zum W\xF6rterbuch hinzugef\xFCgt",word_exists:"Wort existiert bereits im W\xF6rterbuch",error_adding_word:"Fehler beim Hinzuf\xFCgen des Wortes zum W\xF6rterbuch",select_book_required:"Bitte w\xE4hlen Sie ein W\xF6rterbuch aus",adding_word:"Wort wird zum W\xF6rterbuch hinzugef\xFCgt...",updating_word:"Wort wird aktualisiert...",word_added_success:'Wort "{0}" erfolgreich hinzugef\xFCgt',word_updated_success:'Wort "{0}" erfolgreich aktualisiert',add_word_failed:"Hinzuf\xFCgen des Wortes fehlgeschlagen, pr\xFCfen Sie die Datei",update_word_failed:"Aktualisieren des Wortes fehlgeschlagen, pr\xFCfen Sie die Datei",error_processing_word:"Fehler bei der Verarbeitung des Wortes",no_canvas_files:"Keine Canvas-Dateien gefunden",book_already_exists:"Dieses W\xF6rterbuch existiert bereits",invalid_canvas_file:"Ung\xFCltige Canvas-Datei",book_added:"W\xF6rterbuch hinzugef\xFCgt: {0}",book_reloaded:"W\xF6rterbuch neu geladen: {0}",book_removed:"W\xF6rterbuch entfernt: {0}",deleting_word:"Wort wird gel\xF6scht...",word_deleted:"Wort gel\xF6scht",delete_word_failed:"L\xF6schen des Wortes fehlgeschlagen, pr\xFCfen Sie die Datei",error_deleting_word:"Beim L\xF6schen des Wortes ist ein Fehler aufgetreten",mastered_feature_disabled:"Funktion 'Gemeistert' ist nicht aktiviert",update_word_status_failed:"Aktualisieren des Wortstatus fehlgeschlagen",move_to_mastered_group_failed:"Verschieben in die Gruppe 'Gemeistert' fehlgeschlagen",word_marked_as_mastered:'"{0}" als gemeistert markiert',mark_mastered_failed:"Als gemeistert markieren fehlgeschlagen, bitte erneut versuchen",remove_from_mastered_group_failed:"Entfernen aus der Gruppe 'Gemeistert' fehlgeschlagen",word_unmarked_as_mastered:'"{0}" nicht mehr als gemeistert markiert',unmark_mastered_failed:"Markierung aufheben fehlgeschlagen, bitte erneut versuchen",batch_marked_success:"{0} W\xF6rter erfolgreich als gemeistert markiert"},modals:{add_word_title:"Hinzuf\xFCgen ",edit_word_title:"Bearbeiten ",word_label:"Wort",definition_label:"Definition",book_label:"W\xF6rterbuch",select_book:"W\xF6rterbuch ausw\xE4hlen",color_label:"Kartenfarbe",color_gray:"Grau",color_red:"Rot",color_orange:"Orange",color_yellow:"Gelb",color_green:"Gr\xFCn",color_blue:"Blau",color_purple:"Lila",aliases_label:"Aliasse (optional, durch Kommas getrennt)",aliases_placeholder:"z. B.: doing, done, did",definition_placeholder:"Definition eingeben...",add_button:"Hinzuf\xFCgen",save_button:"Speichern",cancel_button:"Abbrechen",select_canvas_file:"Datei des W\xF6rterbuchs ausw\xE4hlen",delete_confirmation:`M\xF6chten Sie das Wort "{0}" wirklich l\xF6schen?
Diese Aktion kann nicht r\xFCckg\xE4ngig gemacht werden.`}};var ke={plugin_name:"HiWords",settings:{vocabulary_books:"\u5358\u8A9E\u5E33",add_vocabulary_book:"\u5358\u8A9E\u5E33\u3092\u8FFD\u52A0",remove_vocabulary_book:"\u524A\u9664",show_definition_on_hover:"\u30DB\u30D0\u30FC\u3067\u5B9A\u7FA9\u3092\u8868\u793A",show_definition_on_hover_desc:"\u5F37\u8ABF\u8868\u793A\u3055\u308C\u305F\u5358\u8A9E\u306B\u30DE\u30A6\u30B9\u3092\u4E57\u305B\u308B\u3068\u5B9A\u7FA9\u3092\u8868\u793A\u3057\u307E\u3059",enable_auto_highlight:"\u81EA\u52D5\u30CF\u30A4\u30E9\u30A4\u30C8\u3092\u6709\u52B9\u5316",enable_auto_highlight_desc:"\u8AAD\u66F8\u4E2D\u306B\u5358\u8A9E\u5E33\u306E\u5358\u8A9E\u3092\u81EA\u52D5\u7684\u306B\u30CF\u30A4\u30E9\u30A4\u30C8\u3057\u307E\u3059",highlight_style:"\u30CF\u30A4\u30E9\u30A4\u30C8\u30B9\u30BF\u30A4\u30EB",highlight_style_desc:"\u30C6\u30AD\u30B9\u30C8\u4E2D\u306E\u5358\u8A9E\u306E\u30CF\u30A4\u30E9\u30A4\u30C8\u65B9\u6CD5\u3092\u9078\u629E",style_underline:"\u4E0B\u7DDA",style_background:"\u80CC\u666F",style_bold:"\u592A\u5B57",style_dotted:"\u70B9\u7DDA\u306E\u4E0B\u7DDA",style_wavy:"\u6CE2\u7DDA\u306E\u4E0B\u7DDA",save_settings:"\u8A2D\u5B9A\u3092\u4FDD\u5B58",no_vocabulary_books:"\u5358\u8A9E\u5E33\u304C\u307E\u3060\u3042\u308A\u307E\u305B\u3093\u3002Canvas \u30D5\u30A1\u30A4\u30EB\u3092\u5358\u8A9E\u5E33\u3068\u3057\u3066\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044\u3002",path:"\u30D1\u30B9",reload_book:"\u3053\u306E\u5358\u8A9E\u5E33\u3092\u518D\u8AAD\u307F\u8FBC\u307F",statistics:"\u7D71\u8A08",total_books:"\u5358\u8A9E\u5E33\u306E\u5408\u8A08: {0}",enabled_books:"\u6709\u52B9\u306A\u5358\u8A9E\u5E33: {0}",total_words:"\u5358\u8A9E\u306E\u5408\u8A08: {0}",enable_mastered_feature:"\u7FD2\u5F97\u6E08\u307F\u6A5F\u80FD\u3092\u6709\u52B9\u5316",enable_mastered_feature_desc:"\u7FD2\u5F97\u6E08\u307F\u306E\u5358\u8A9E\u3092\u30DE\u30FC\u30AF\u3057\u3066\u30CF\u30A4\u30E9\u30A4\u30C8\u3092\u505C\u6B62\u3002\u30B5\u30A4\u30C9\u30D0\u30FC\u306B\u30B0\u30EB\u30FC\u30D7\u8868\u793A",blur_definitions:"\u5185\u5BB9\u3092\u307C\u304B\u3059",blur_definitions_desc:"\u30C7\u30D5\u30A9\u30EB\u30C8\u3067\u307C\u304B\u3057\u3001\u30DB\u30D0\u30FC\u3067\u8868\u793A\u3002\u7B54\u3048\u3092\u898B\u308B\u524D\u306E\u60F3\u8D77\u306B\u6700\u9069",auto_layout:"\u81EA\u52D5\u30EC\u30A4\u30A2\u30A6\u30C8",enable_auto_layout:"\u81EA\u52D5\u30EC\u30A4\u30A2\u30A6\u30C8\u3092\u6709\u52B9\u5316",enable_auto_layout_desc:"\u8FFD\u52A0/\u66F4\u65B0/\u524A\u9664\u3084\u30B0\u30EB\u30FC\u30D7\u5909\u66F4\u5F8C\u306B\u30EC\u30A4\u30A2\u30A6\u30C8\u3092\u81EA\u52D5\u6B63\u898F\u5316",card_size:"\u30AB\u30FC\u30C9\u30B5\u30A4\u30BA\uFF08\u5DE6\u30A8\u30EA\u30A2\uFF09",card_size_desc:"\u5DE6\u5074\u306E\u975E\u30B0\u30EB\u30FC\u30D7\u30CE\u30FC\u30C9\u306E\u30AB\u30FC\u30C9\u5E45/\u9AD8\u3055",grid_gaps:"\u30B0\u30EA\u30C3\u30C9\u9593\u9694",grid_gaps_desc:"\u5DE6\u30B0\u30EA\u30C3\u30C9\u306E\u6C34\u5E73/\u5782\u76F4\u9593\u9694",left_padding:"\u5DE6\u4F59\u767D\u3068\u6700\u5C0F X",left_padding_desc:"Mastered \u30B0\u30EB\u30FC\u30D7\u304B\u3089\u306E\u5DE6\u4F59\u767D\u3068\u5DE6\u30A8\u30EA\u30A2\u306E\u6700\u5C0F X",columns_auto:"\u81EA\u52D5\u30AB\u30E9\u30E0",columns_auto_desc:"\u30AB\u30E9\u30E0\u6570\u3092\u81EA\u52D5\u6C7A\u5B9A\uFF08\u6700\u5927\u30AB\u30E9\u30E0\u6570\u3067\u5236\u9650\uFF09",columns:"\u56FA\u5B9A\u30AB\u30E9\u30E0 / \u6700\u5927\u30AB\u30E9\u30E0",columns_desc:"\u56FA\u5B9A\u30AB\u30E9\u30E0\u3068\u6700\u5927\u30AB\u30E9\u30E0\u3092\u6307\u5B9A\uFF08\u81EA\u52D5\u304C\u30AA\u30D5\u306E\u6642\u306B\u6709\u52B9\uFF09",group_inner_layout:"\u30B0\u30EB\u30FC\u30D7\u5185\u90E8\u30EC\u30A4\u30A2\u30A6\u30C8",group_inner_layout_desc:"\u30B0\u30EB\u30FC\u30D7\u5185\u30CE\u30FC\u30C9\u306E\u5185\u5074\u4F59\u767D\u3001\u9593\u9694\u3001\u30AB\u30E9\u30E0\u8A2D\u5B9A"},sidebar:{title:"HiWords",empty_state:"\u5358\u8A9E\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002\u5358\u8A9E\u5E33\u306B\u8FFD\u52A0\u3059\u308B\u3068\u3053\u3053\u306B\u8868\u793A\u3055\u308C\u307E\u3059\u3002",source_prefix:"\u51FA\u5178: ",found:"\u898B\u3064\u304B\u3063\u305F",words:"\u5358\u8A9E",no_definition:"\u5B9A\u7FA9\u306F\u3042\u308A\u307E\u305B\u3093\u3002",vocabulary_book:"\u5358\u8A9E",mastered:"\u7FD2\u5F97\u6E08\u307F",no_learning_words:"\u5B66\u7FD2\u3059\u308B\u5358\u8A9E\u306F\u3042\u308A\u307E\u305B\u3093",no_mastered_words:"\u7FD2\u5F97\u6E08\u307F\u306E\u5358\u8A9E\u306F\u3042\u308A\u307E\u305B\u3093"},commands:{refresh_vocabulary:"\u5358\u8A9E\u5E33\u3092\u66F4\u65B0",add_word:"HiWords: \u5358\u8A9E\u3092\u8FFD\u52A0",edit_word:"HiWords: \u5358\u8A9E\u3092\u7DE8\u96C6",show_sidebar:"HiWords \u30B5\u30A4\u30C9\u30D0\u30FC\u3092\u8868\u793A"},notices:{vocabulary_refreshed:"\u5358\u8A9E\u5E33\u3092\u66F4\u65B0\u3057\u307E\u3057\u305F",word_added:"\u5358\u8A9E\u3092\u5358\u8A9E\u5E33\u306B\u8FFD\u52A0\u3057\u307E\u3057\u305F",word_exists:"\u5358\u8A9E\u306F\u3059\u3067\u306B\u5358\u8A9E\u5E33\u306B\u5B58\u5728\u3057\u307E\u3059",error_adding_word:"\u5358\u8A9E\u306E\u8FFD\u52A0\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F",select_book_required:"\u5358\u8A9E\u5E33\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044",adding_word:"\u5358\u8A9E\u3092\u8FFD\u52A0\u4E2D...",updating_word:"\u5358\u8A9E\u3092\u66F4\u65B0\u4E2D...",word_added_success:'\u5358\u8A9E "{0}" \u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F',word_updated_success:'\u5358\u8A9E "{0}" \u3092\u66F4\u65B0\u3057\u307E\u3057\u305F',add_word_failed:"\u5358\u8A9E\u3092\u8FFD\u52A0\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u5358\u8A9E\u5E33\u30D5\u30A1\u30A4\u30EB\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044",update_word_failed:"\u5358\u8A9E\u3092\u66F4\u65B0\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u5358\u8A9E\u5E33\u30D5\u30A1\u30A4\u30EB\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044",error_processing_word:"\u5358\u8A9E\u306E\u51E6\u7406\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F",no_canvas_files:"Canvas \u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093",book_already_exists:"\u3053\u306E\u5358\u8A9E\u5E33\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059",invalid_canvas_file:"\u7121\u52B9\u306A Canvas \u30D5\u30A1\u30A4\u30EB\u3067\u3059",book_added:"\u5358\u8A9E\u5E33\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F: {0}",book_reloaded:"\u5358\u8A9E\u5E33\u3092\u518D\u8AAD\u307F\u8FBC\u307F\u3057\u307E\u3057\u305F: {0}",book_removed:"\u5358\u8A9E\u5E33\u3092\u524A\u9664\u3057\u307E\u3057\u305F: {0}",deleting_word:"\u5358\u8A9E\u3092\u524A\u9664\u4E2D...",word_deleted:"\u5358\u8A9E\u3092\u524A\u9664\u3057\u307E\u3057\u305F",delete_word_failed:"\u5358\u8A9E\u3092\u524A\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u30D5\u30A1\u30A4\u30EB\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044",error_deleting_word:"\u524A\u9664\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F",mastered_feature_disabled:"\u7FD2\u5F97\u6E08\u307F\u6A5F\u80FD\u306F\u6709\u52B9\u306B\u306A\u3063\u3066\u3044\u307E\u305B\u3093",update_word_status_failed:"\u5358\u8A9E\u306E\u30B9\u30C6\u30FC\u30BF\u30B9\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F",move_to_mastered_group_failed:"\u7FD2\u5F97\u6E08\u307F\u30B0\u30EB\u30FC\u30D7\u3078\u306E\u79FB\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F",word_marked_as_mastered:'"{0}" \u3092\u7FD2\u5F97\u6E08\u307F\u306B\u8A2D\u5B9A\u3057\u307E\u3057\u305F',mark_mastered_failed:"\u7FD2\u5F97\u6E08\u307F\u3078\u306E\u8A2D\u5B9A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044",remove_from_mastered_group_failed:"\u7FD2\u5F97\u6E08\u307F\u30B0\u30EB\u30FC\u30D7\u304B\u3089\u306E\u524A\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F",word_unmarked_as_mastered:'"{0}" \u306E\u7FD2\u5F97\u6E08\u307F\u3092\u89E3\u9664\u3057\u307E\u3057\u305F',unmark_mastered_failed:"\u89E3\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044",batch_marked_success:"{0} \u4EF6\u306E\u5358\u8A9E\u3092\u7FD2\u5F97\u6E08\u307F\u306B\u8A2D\u5B9A\u3057\u307E\u3057\u305F"},modals:{add_word_title:"\u8FFD\u52A0 ",edit_word_title:"\u7DE8\u96C6 ",word_label:"\u5358\u8A9E",definition_label:"\u5B9A\u7FA9",book_label:"\u5358\u8A9E\u5E33",select_book:"\u5358\u8A9E\u5E33\u3092\u9078\u629E",color_label:"\u30AB\u30FC\u30C9\u306E\u8272",color_gray:"\u30B0\u30EC\u30FC",color_red:"\u8D64",color_orange:"\u30AA\u30EC\u30F3\u30B8",color_yellow:"\u9EC4\u8272",color_green:"\u7DD1",color_blue:"\u9752",color_purple:"\u7D2B",aliases_label:"\u5225\u540D\uFF08\u4EFB\u610F\u3001\u30AB\u30F3\u30DE\u533A\u5207\u308A\uFF09",aliases_placeholder:"\u4F8B: doing, done, did",definition_placeholder:"\u5B9A\u7FA9\u3092\u5165\u529B...",add_button:"\u8FFD\u52A0",save_button:"\u4FDD\u5B58",cancel_button:"\u30AD\u30E3\u30F3\u30BB\u30EB",select_canvas_file:"\u5358\u8A9E\u5E33\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E",delete_confirmation:`\u5358\u8A9E "{0}" \u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F
\u3053\u306E\u64CD\u4F5C\u306F\u5143\u306B\u623B\u305B\u307E\u305B\u3093\u3002`}};var Le={en:ve,zh:be,es:we,fr:ye,de:We,ja:ke},he=class g{constructor(){this.app=null}static getInstance(){return g.instance||(g.instance=new g),g.instance}setApp(e){this.app=e}getCurrentLocale(){let e=window.localStorage.getItem("language")||"en";return e.startsWith("zh")?"zh":e.startsWith("es")?"es":e.startsWith("fr")?"fr":e.startsWith("de")?"de":e.startsWith("ja")||e.startsWith("jp")?"ja":"en"}t(e){let i=this.getCurrentLocale(),t=Le[i],r=e.split("."),a=t;for(let s of r)if(a&&a[s]!==void 0)a=a[s];else return console.warn(`\u7FFB\u8BD1\u952E ${e} \u4E0D\u5B58\u5728\u4E8E ${i} \u8BED\u8A00\u5305\u4E2D`),e;return a}},ge=he.getInstance(),d=g=>ge.t(g);var J=class{constructor(e,i){this.plugin=e,this.vocabularyManager=i,this.masteredGroupManager=new X(e.app,e.settings)}updateSettings(){this.masteredGroupManager.updateSettings(this.plugin.settings)}get isEnabled(){return this.plugin.settings.enableMasteredFeature}async markWordAsMastered(e,i,t){if(!this.isEnabled)return new N.Notice(d("notices.mastered_feature_disabled")),!1;try{return await this.updateWordMasteredStatus(e,i,!0)?await this.masteredGroupManager.moveToMasteredGroup(e,i)?(this.plugin.refreshHighlighter(),this.plugin.app.workspace.trigger("hi-words:mastered-changed"),new N.Notice(d("notices.word_marked_as_mastered").replace("{0}",t)),!0):(await this.updateWordMasteredStatus(e,i,!1),new N.Notice(d("notices.move_to_mastered_group_failed")),!1):(new N.Notice(d("notices.update_word_status_failed")),!1)}catch(r){return console.error("\u6807\u8BB0\u5DF2\u638C\u63E1\u5931\u8D25:",r),new N.Notice(d("notices.mark_mastered_failed")),!1}}async unmarkWordAsMastered(e,i,t){if(!this.isEnabled)return new N.Notice(d("notices.mastered_feature_disabled")),!1;try{return await this.updateWordMasteredStatus(e,i,!1)?await this.masteredGroupManager.removeFromMasteredGroup(e,i)?(this.plugin.refreshHighlighter(),this.plugin.app.workspace.trigger("hi-words:mastered-changed"),new N.Notice(d("notices.word_unmarked_as_mastered").replace("{0}",t)),!0):(await this.updateWordMasteredStatus(e,i,!0),new N.Notice(d("notices.remove_from_mastered_group_failed")),!1):(new N.Notice(d("notices.update_word_status_failed")),!1)}catch(r){return console.error("\u53D6\u6D88\u5DF2\u638C\u63E1\u6807\u8BB0\u5931\u8D25:",r),new N.Notice(d("notices.unmark_mastered_failed")),!1}}async isWordMastered(e,i){if(!this.isEnabled)return!1;try{let t=await this.vocabularyManager.getWordDefinitionByNodeId(e,i);return(t==null?void 0:t.mastered)===!0}catch(t){return console.error("\u68C0\u67E5\u5355\u8BCD\u638C\u63E1\u72B6\u6001\u5931\u8D25:",t),!1}}async getMasteredWords(e){if(!this.isEnabled)return[];try{return(await this.vocabularyManager.getAllWordDefinitions()).filter(t=>!(!t.mastered||e&&t.source!==e))}catch(i){return console.error("\u83B7\u53D6\u5DF2\u638C\u63E1\u5355\u8BCD\u5217\u8868\u5931\u8D25:",i),[]}}async getMasteredStats(){if(!this.isEnabled)return{totalMastered:0,totalWords:0,masteredPercentage:0,byBook:{}};try{let e=await this.vocabularyManager.getAllWordDefinitions(),i=e.filter(r=>r.mastered),t={};return e.forEach(r=>{t[r.source]||(t[r.source]={mastered:0,total:0}),t[r.source].total++,r.mastered&&t[r.source].mastered++}),{totalMastered:i.length,totalWords:e.length,masteredPercentage:e.length>0?i.length/e.length*100:0,byBook:t}}catch(e){return console.error("\u83B7\u53D6\u5DF2\u638C\u63E1\u7EDF\u8BA1\u4FE1\u606F\u5931\u8D25:",e),{totalMastered:0,totalWords:0,masteredPercentage:0,byBook:{}}}}async batchMarkAsMastered(e){if(!this.isEnabled)return 0;let i=0;for(let t of e)await this.markWordAsMastered(t.bookPath,t.nodeId,t.word)&&i++;return i>0&&new N.Notice(d("notices.batch_marked_success").replace("{0}",i.toString())),i}async updateWordMasteredStatus(e,i,t){try{let r=await this.vocabularyManager.getWordDefinitionByNodeId(e,i);return r?(r.mastered=t,await this.vocabularyManager.updateWordDefinition(e,i,r),!0):(console.error(`\u672A\u627E\u5230\u5355\u8BCD\u5B9A\u4E49: ${i}`),!1)}catch(r){return console.error("\u66F4\u65B0\u5355\u8BCD\u638C\u63E1\u72B6\u6001\u5931\u8D25:",r),!1}}async syncMasteredStatus(e){if(this.isEnabled)try{let i=await this.vocabularyManager.getWordDefinitionsByBook(e);for(let t of i){let r=await this.masteredGroupManager.isNodeInMasteredGroup(e,t.nodeId);t.mastered&&!r?await this.masteredGroupManager.moveToMasteredGroup(e,t.nodeId):!t.mastered&&r&&await this.masteredGroupManager.removeFromMasteredGroup(e,t.nodeId)}}catch(i){console.error("\u540C\u6B65\u5DF2\u638C\u63E1\u72B6\u6001\u5931\u8D25:",i)}}};var $=require("@codemirror/state"),B=require("@codemirror/view");var Z=class{constructor(){this.root=new Y}addWord(e,i){let t=this.root,r=e.toLowerCase();for(let a of r)t.children.has(a)||t.children.set(a,new Y),t=t.children.get(a);t.isEndOfWord=!0,t.payload=i,t.word=e}findAllMatches(e){let i=[],t=e.toLowerCase();for(let r=0;r<t.length;r++){let a=this.root,s=r;for(;s<t.length&&a.children.has(t[s]);)if(a=a.children.get(t[s]),s++,a.isEndOfWord){let o=r===0||!Ce(t[r-1]),l=s===t.length||!Ce(t[s]);o&&l&&i.push({word:a.word||t.substring(r,s),from:r,to:s,payload:a.payload})}}return i}clear(){this.root=new Y}},Y=class{constructor(){this.children=new Map,this.isEndOfWord=!1,this.payload=null,this.word=null}};function Ce(g){return/[a-z0-9]/i.test(g)}function Q(g,e="var(--color-accent)"){return g?{1:"var(--color-red)",2:"var(--color-orange)",3:"var(--color-yellow)",4:"var(--color-green)",5:"var(--color-cyan)",6:"var(--color-purple)",red:"var(--color-red)",orange:"var(--color-orange)",yellow:"var(--color-yellow)",green:"var(--color-green)",cyan:"var(--color-cyan)",blue:"var(--color-blue)",purple:"var(--color-purple)",pink:"var(--color-pink)",gray:"var(--color-base-60)",grey:"var(--color-base-60)",white:"var(--color-base-00)",black:"var(--color-base-100)"}[g.toLowerCase()]||g:e}function Se(g,e=.1){return g.startsWith("var(--color-")?`color-mix(in srgb, ${g} ${e*100}%, transparent)`:g.startsWith("#")||g.startsWith("rgb")||g.startsWith("hsl")?`color-mix(in srgb, ${g} ${e*100}%, transparent)`:g}var pe=null;function Ve(g,e){if(!g||!e)return null;let i=encodeURIComponent(e.trim());return g.split("{{word}}").join(i)}async function ae(g,e){let i=Ve(g.settings.ttsTemplate,e);if(i)try{pe||(pe=new Audio);let t=pe;t.src=i,await t.play()}catch(t){console.warn("HiWords TTS play failed:",t)}}var Pe=300;var Ee=$.StateEffect.define(),me=class g{constructor(){this.highlighters=new Set}static getInstance(){return g.instance||(g.instance=new g),g.instance}register(e){this.highlighters.add(e)}unregister(e){this.highlighters.delete(e)}refreshAll(){this.highlighters.forEach(e=>{try{e.forceUpdate()}catch(i){console.error("\u5237\u65B0\u9AD8\u4EAE\u5668\u5931\u8D25:",i)}})}clear(){this.highlighters.clear()}},z=me.getInstance(),Ie=$.StateField.define({create(){return B.Decoration.none},update(g,e){g=g.map(e.changes);for(let i of e.effects)if(i.is(Ee))return B.Decoration.none;return g},provide:g=>B.EditorView.decorations.from(g)}),se=class{constructor(e,i){this.debounceTimer=null;this.lastRanges=[];this.cachedMatches=new Map;this.editorView=e,this.vocabularyManager=i,this.wordTrie=new Z,this.buildWordTrie(),this.decorations=this.buildDecorations(e),z.register(this)}buildWordTrie(){let e=performance.now();this.wordTrie.clear();let i=this.vocabularyManager.getAllWordsForHighlight();for(let t of i){let r=this.vocabularyManager.getDefinition(t);r&&this.wordTrie.addWord(t,r)}}update(e){(e.docChanged||e.viewportChanged||e.focusChanged)&&this.debouncedUpdate(e.view)}forceUpdate(){this.buildWordTrie(),this.cachedMatches.clear(),this.decorations=this.buildDecorations(this.editorView),this.editorView.dispatch({effects:Ee.of(!0)})}debouncedUpdate(e){this.debounceTimer&&window.clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.decorations=this.buildDecorations(e),this.debounceTimer=null},Pe)}buildDecorations(e){let i=performance.now(),t=new $.RangeSetBuilder,r=[],a=e.visibleRanges,s=this.haveRangesChanged(a),o=a.map(n=>`${n.from}-${n.to}`).join(",");if(!s&&this.cachedMatches.has(o)){let n=this.cachedMatches.get(o);return this.applyDecorations(t,n),t.finish()}this.lastRanges=a.map(n=>({from:n.from,to:n.to}));for(let{from:n,to:c}of e.visibleRanges){let u=e.state.sliceDoc(n,c);r.push(...this.findWordMatches(u,n))}r.sort((n,c)=>n.from-c.from);let l=this.removeOverlaps(r);return this.cachedMatches.set(o,l),this.applyDecorations(t,l),t.finish()}applyDecorations(e,i){let t=this.vocabularyManager.getSettings().highlightStyle||"underline";i.forEach(r=>{let a=Q(r.definition.color,"var(--color-base-60)");e.add(r.from,r.to,B.Decoration.mark({class:"hi-words-highlight",attributes:{"data-word":r.word,"data-definition":r.definition.definition,"data-color":a,"data-style":t,style:`--word-highlight-color: ${a};`}}))})}haveRangesChanged(e){if(this.lastRanges.length!==e.length)return!0;for(let i=0;i<e.length;i++)if(e[i].from!==this.lastRanges[i].from||e[i].to!==this.lastRanges[i].to)return!0;return!1}findWordMatches(e,i){let t=performance.now(),r=[];try{let a=this.wordTrie.findAllMatches(e);for(let s of a){let o=s.payload;o&&r.push({word:s.word,definition:o,from:i+s.from,to:i+s.to,color:Q(o.color,"var(--color-accent)")})}}catch(a){console.error("\u5728 findWordMatches \u4E2D\u53D1\u751F\u9519\u8BEF:",a)}return r}removeOverlaps(e){return e}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}destroy(){this.debounceTimer&&(window.clearTimeout(this.debounceTimer),this.debounceTimer=null),this.cachedMatches.clear(),this.wordTrie.clear(),z.unregister(this)}};function fe(g){let e={decorations:t=>t.decorations};class i extends se{constructor(r){super(r,g)}}return[Ie,B.ViewPlugin.fromClass(i,e)]}var A=require("obsidian");var O="hi-words-sidebar",ee=class extends A.ItemView{constructor(i,t){super(i);this.currentWords=[];this.activeTab="learning";this.currentFile=null;this.lastActiveMarkdownView=null;this.firstLoadForFile=!1;this.plugin=t}getViewType(){return O}getDisplayText(){return d("sidebar.title")}getIcon(){return"book-open"}async onOpen(){let i=this.containerEl.children[1];i.empty(),i.addClass("hi-words-sidebar"),this.updateView(),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateView()})),this.registerEvent(this.app.workspace.on("editor-change",()=>{setTimeout(()=>this.updateView(),500)})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof A.TFile&&t.extension==="canvas"&&setTimeout(()=>this.updateView(),200)})),this.registerEvent(this.app.workspace.on("hi-words:mastered-changed",()=>{this.updateView()})),this.registerEvent(this.app.workspace.on("hi-words:settings-changed",()=>{this.updateView()}))}async onClose(){}async updateView(){let i=this.app.workspace.getActiveFile();if(!i||i.extension!=="md"){this.showEmptyState("\u8BF7\u6253\u5F00\u4E00\u4E2A Markdown \u6587\u6863");return}let t=this.app.workspace.getActiveViewOfType(A.MarkdownView);if(t&&(this.lastActiveMarkdownView=t),i===this.currentFile&&this.currentWords.length>0)return;let r=i!==this.currentFile;this.currentFile=i,r&&(this.firstLoadForFile=!0),await this.scanCurrentDocument(),this.renderWordList()}async scanCurrentDocument(){if(this.currentFile)try{let i=await this.app.vault.read(this.currentFile),t=await this.plugin.vocabularyManager.getAllWordDefinitions(),r=[];for(let a of t){let s=this.buildSearchRegex(a.word),o=s.exec(i),l=o?o.index:-1;if(l===-1&&a.aliases){for(let n of a.aliases)if(s=this.buildSearchRegex(n),o=s.exec(i),o){l=o.index;break}}l!==-1&&(r.some(n=>n.wordDef.nodeId===a.nodeId)||r.push({wordDef:a,position:l}))}r.sort((a,s)=>a.position-s.position),this.currentWords=r.map(a=>a.wordDef)}catch(i){console.error("Failed to scan document:",i),this.currentWords=[]}}renderWordList(){let i=this.containerEl.querySelector(".hi-words-sidebar");if(!i)return;if(i.empty(),this.currentWords.length===0){this.showEmptyState(d("sidebar.empty_state"));return}let t=this.currentWords.filter(a=>!a.mastered),r=this.currentWords.filter(a=>a.mastered);this.firstLoadForFile&&this.activeTab==="learning"&&t.length===0&&r.length>0&&(this.activeTab="mastered"),this.firstLoadForFile=!1,this.createTabNavigation(i,t.length,r.length),this.createTabContent(i,t,r)}createTabNavigation(i,t,r){let a=i.createEl("div",{cls:"hi-words-tab-nav"}),s=a.createEl("div",{cls:`hi-words-tab ${this.activeTab==="learning"?"active":""}`,attr:{"data-tab":"learning"}});if(s.createEl("span",{text:`${d("sidebar.vocabulary_book")} (${t})`}),this.plugin.settings.enableMasteredFeature){let o=a.createEl("div",{cls:`hi-words-tab ${this.activeTab==="mastered"?"active":""}`,attr:{"data-tab":"mastered"}});o.createEl("span",{text:`${d("sidebar.mastered")} (${r})`}),o.addEventListener("click",()=>{this.switchTab("mastered")})}s.addEventListener("click",()=>{this.switchTab("learning")})}createTabContent(i,t,r){this.activeTab==="learning"?t.length>0?this.createWordList(i,t,!1):this.createEmptyState(i,d("sidebar.no_learning_words")):this.activeTab==="mastered"&&(r.length>0?this.createWordList(i,r,!0):this.createEmptyState(i,d("sidebar.no_mastered_words")))}switchTab(i){this.activeTab!==i&&(this.activeTab=i,this.renderWordList())}createWordList(i,t,r){let a=i.createEl("div",{cls:"hi-words-word-list"});t.forEach(s=>{this.createWordCard(a,s,r)})}createWordSection(i,t,r,a,s){let o=i.createEl("div",{cls:s?"hi-words-mastered-section":"hi-words-section"}),l=o.createEl("div",{cls:"hi-words-section-title"}),n=l.createEl("span",{cls:"hi-words-section-icon"});(0,A.setIcon)(n,a),l.createEl("span",{text:`${t} (${r.length})`,cls:"hi-words-section-text"});let c=o.createEl("div",{cls:"hi-words-word-list"});r.forEach(u=>{this.createWordCard(c,u,s)})}createWordCard(i,t,r=!1){let a=i.createEl("div",{cls:"hi-words-word-card"}),s=Q(t.color,"var(--color-base-60)");if(a.style.borderLeftColor=s,t.color){a.style.setProperty("--word-card-accent-color",s);let u=Se(s,.1);a.style.setProperty("--word-card-bg-color",u)}let o=a.createEl("div",{cls:"hi-words-word-title"}),l=o.createEl("span",{text:t.word,cls:"hi-words-word-text"});if(l.style.cursor="pointer",l.title="\u70B9\u51FB\u53D1\u97F3",l.addEventListener("click",async u=>{u.stopPropagation(),await ae(this.plugin,t.word)}),this.plugin.settings.enableMasteredFeature&&this.plugin.masteredService){let u=o.createEl("div",{cls:"hi-words-title-mastered-button",attr:{"aria-label":r?"\u5FD8\u8BB0\u4E86":"\u5DF2\u638C\u63E1"}});(0,A.setIcon)(u,r?"frown":"smile"),u.addEventListener("click",async h=>{h.stopPropagation();try{r?await this.plugin.masteredService.unmarkWordAsMastered(t.source,t.nodeId,t.word):await this.plugin.masteredService.markWordAsMastered(t.source,t.nodeId,t.word),setTimeout(()=>this.updateView(),100)}catch(p){console.error("\u5207\u6362\u5DF2\u638C\u63E1\u72B6\u6001\u5931\u8D25:",p)}})}if(t.definition&&t.definition.trim()){let h=a.createEl("div",{cls:"hi-words-word-definition"}).createEl("div",{cls:this.plugin.settings.blurDefinitions?"hi-words-definition blur-enabled":"hi-words-definition"});try{let p=this.app.workspace.getActiveViewOfType(A.MarkdownView)||this.lastActiveMarkdownView;p&&p.file?A.MarkdownRenderer.renderMarkdown(t.definition,h,p.file.path,p):h.textContent=t.definition}catch(p){console.error("Markdown \u6E32\u67D3\u5931\u8D25:",p),h.textContent=t.definition}}let n=a.createEl("div",{cls:"hi-words-word-source"}),c=this.getBookNameFromPath(t.source);n.createEl("span",{text:`${d("sidebar.source_prefix")}${c}`,cls:"hi-words-source-text"}),n.style.cursor="pointer",n.addEventListener("click",u=>{u.stopPropagation(),this.navigateToSource(t)}),r&&a.addClass("hi-words-word-card-mastered")}createEmptyState(i,t){i.createEl("div",{cls:"hi-words-empty-state"}).createEl("div",{text:t,cls:"hi-words-empty-text"})}showEmptyState(i){let t=this.containerEl.querySelector(".hi-words-sidebar");if(!t)return;t.empty(),t.createEl("div",{cls:"hi-words-empty-state"}).createEl("div",{text:i,cls:"hi-words-empty-text"})}getBookNameFromPath(i){var r;let t=this.plugin.settings.vocabularyBooks.find(a=>a.path===i);return t?t.name:((r=i.split("/").pop())==null?void 0:r.replace(".canvas",""))||"\u672A\u77E5"}truncateText(i,t){return i.length<=t?i:i.substring(0,t).trim()}escapeRegExp(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}buildSearchRegex(i){let t=this.escapeRegExp(i),r=/[\p{Script=Han}\p{Script=Hiragana}\p{Script=Katakana}]/u.test(i),a=r?`${t}`:`\\b${t}\\b`,s=r?"giu":"gi";return new RegExp(a,s)}async navigateToSource(i){try{let t=this.app.vault.getAbstractFileByPath(i.source);t instanceof A.TFile&&(t.extension==="canvas"?await this.app.workspace.openLinkText(t.path,""):(await this.app.workspace.openLinkText(t.path,""),setTimeout(()=>{var a;let r=this.app.workspace.getActiveViewOfType(A.MarkdownView);if(r&&((a=r.file)==null?void 0:a.path)===t.path){let s=r.editor,l=s.getValue().toLowerCase().indexOf(i.word.toLowerCase());if(l!==-1){let n=s.offsetToPos(l);s.setCursor(n),s.scrollIntoView({from:n,to:n},!0)}}},100)))}catch(t){console.error("\u5BFC\u822A\u5230\u6E90\u6587\u4EF6\u5931\u8D25:",t)}}async openVocabularyBook(i){let t=this.app.vault.getAbstractFileByPath(i.source);t instanceof A.TFile&&await this.app.workspace.openLinkText(t.path,"")}refresh(){this.currentFile=null,this.updateView()}};var I=require("obsidian");var te=class{constructor(e){this.activeTooltip=null;this.vocabularyManager=null;this.masteredService=null;this.eventHandlers={};this.app=e.app,this.plugin=e,this.eventHandlers={mouseover:this.handleMouseOver.bind(this),mouseout:this.handleMouseOut.bind(this)},this.registerEvents()}simpleMarkdownToHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/^### (.*?)$/gm,"<h3>$1</h3>").replace(/^## (.*?)$/gm,"<h2>$1</h2>").replace(/^# (.*?)$/gm,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/__(.*?)__/g,"<strong>$1</strong>").replace(/_(.*?)_/g,"<em>$1</em>").replace(/\[([^\]]+)\]\(([^\)]+)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/^\* (.*?)$/gm,"<li>$1</li>").replace(/^\d+\. (.*?)$/gm,"<li>$1</li>").replace(/^> (.*?)$/gm,"<blockquote>$1</blockquote>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>"):""}setContentSafely(e,i){for(;e.firstChild;)e.removeChild(e.firstChild);let t=s=>{let o=s.match(/^(#{1,3}) (.+)$/gm);return o&&o.forEach(l=>{let[n,c,u]=l.match(/^(#{1,3}) (.+)$/)||[];if(c&&u){let h=c.length,p=document.createElement(`h${h}`);p.textContent=u,e.appendChild(p),s=s.replace(l,"")}}),s},r=s=>{if(!s.trim())return;s=s.replace(/\*\*(.*?)\*\*/g,(l,n)=>`[STRONG]${n}[/STRONG]`),s=s.replace(/\*(.*?)\*/g,(l,n)=>`[EM]${n}[/EM]`),s=s.replace(/\[([^\]]+)\]\(([^\)]+)\)/g,(l,n,c)=>`[LINK:${c}]${n}[/LINK]`),s=s.replace(/`(.*?)`/g,(l,n)=>`[CODE]${n}[/CODE]`),s.split(`
`).forEach(l=>{if(!l.trim())return;let n=document.createElement("p"),c=l;c=c.replace(/\[STRONG\](.*?)\[\/STRONG\]/g,(u,h)=>{let p=document.createElement("strong");return p.textContent=h,n.appendChild(p),""}),c=c.replace(/\[EM\](.*?)\[\/EM\]/g,(u,h)=>{let p=document.createElement("em");return p.textContent=h,n.appendChild(p),""}),c=c.replace(/\[LINK:(.*?)\](.*?)\[\/LINK\]/g,(u,h,p)=>{let v=document.createElement("a");return v.href=h,v.textContent=p,v.target="_blank",n.appendChild(v),""}),c=c.replace(/\[CODE\](.*?)\[\/CODE\]/g,(u,h)=>{let p=document.createElement("code");return p.textContent=h,n.appendChild(p),""}),c.trim()&&n.appendChild(document.createTextNode(c)),n.hasChildNodes()&&e.appendChild(n)})},a=t(i);r(a)}setVocabularyManager(e){this.vocabularyManager=e}setMasteredService(e){this.masteredService=e}registerEvents(){document.addEventListener("mouseover",this.eventHandlers.mouseover),document.addEventListener("mouseout",this.eventHandlers.mouseout)}handleMouseOut(e){clearTimeout(this.tooltipHideTimeout);let i=e.target,t=e.relatedTarget;t&&this.activeTooltip&&(t===this.activeTooltip||this.activeTooltip.contains(t))||i&&t&&i.classList.contains("hi-words-highlight")&&t.classList.contains("hi-words-highlight")||i&&this.activeTooltip&&this.activeTooltip.contains(i)&&t&&t.classList.contains("hi-words-highlight")||(this.tooltipHideTimeout=window.setTimeout(()=>{this.removeTooltip()},80))}handleMouseOver(e){let i=e.target;if(i&&i.classList.contains("hi-words-highlight")){let t=i.getAttribute("data-word"),r=i.getAttribute("data-definition");t&&r&&this.createTooltip(i,t,r)}}createTooltip(e,i,t){this.removeTooltip();let r=document.createElement("div");r.className="hi-words-tooltip";let a=document.createElement("div");a.className="hi-words-tooltip-title-container";let s=document.createElement("div");s.className="hi-words-tooltip-title",s.textContent=i,a.appendChild(s),s.style.cursor="pointer",s.title="\u70B9\u51FB\u53D1\u97F3",s.addEventListener("click",async u=>{u.stopPropagation(),await ae(this.plugin,i)}),r.appendChild(a);let o=document.createElement("div");if(o.className="hi-words-tooltip-content",this.plugin.settings.blurDefinitions?o.classList.add("hi-words-definition","blur-enabled"):o.classList.add("hi-words-definition"),!t||t.trim()==="")o.textContent=d("sidebar.no_definition");else try{let u=this.app.workspace.getActiveViewOfType(I.MarkdownView);if(u&&u.file)I.MarkdownRenderer.renderMarkdown(t,o,u.file.path,u);else{let h=this.simpleMarkdownToHtml(t);this.setContentSafely(o,h)}}catch(u){console.error("Markdown \u6E32\u67D3\u5931\u8D25:",u),o.textContent=t}if(r.appendChild(o),this.vocabularyManager){let u=this.vocabularyManager.getDefinition(i);if(u&&u.source){if(this.masteredService&&this.masteredService.isEnabled){let y=document.createElement("div");y.className="hi-words-tooltip-title-mastered-button",(0,I.setIcon)(y,u.mastered?"frown":"smile"),y.addEventListener("click",async C=>{C.stopPropagation();try{u.mastered?await this.masteredService.unmarkWordAsMastered(u.source,u.nodeId,u.word):await this.masteredService.markWordAsMastered(u.source,u.nodeId,u.word),this.removeTooltip()}catch(W){console.error("\u5207\u6362\u5DF2\u638C\u63E1\u72B6\u6001\u5931\u8D25:",W)}}),a.appendChild(y)}let h=document.createElement("div");h.className="hi-words-tooltip-source";let p=u.source.split("/").pop()||"",v=p.endsWith(".canvas")?p.slice(0,-7):p;h.textContent=`${d("sidebar.source_prefix")}${v}`,h.style.cursor="pointer",h.addEventListener("click",y=>{y.stopPropagation(),this.navigateToSource(u),this.removeTooltip()}),r.appendChild(h)}}document.body.appendChild(r);let l=e.getBoundingClientRect(),n=window.pageYOffset||document.documentElement.scrollTop,c=window.pageXOffset||document.documentElement.scrollLeft;r.style.left=l.left+c+"px",r.style.top=l.bottom+n+5+"px",setTimeout(()=>{let u=r.getBoundingClientRect(),h=window.innerWidth;if(u.right>h-10){let p=u.right-h+10;r.style.left=parseFloat(r.style.left)-p+"px"}},0),r.addEventListener("mouseleave",u=>{this.removeTooltip()}),this.activeTooltip=r}removeTooltip(){clearTimeout(this.tooltipHideTimeout),this.activeTooltip&&this.activeTooltip.parentNode&&(this.activeTooltip.parentNode.removeChild(this.activeTooltip),this.activeTooltip=null)}async navigateToSource(e){try{let i=this.app.vault.getAbstractFileByPath(e.source);i instanceof I.TFile&&(i.extension==="canvas"?await this.app.workspace.openLinkText(i.path,""):(await this.app.workspace.openLinkText(i.path,""),setTimeout(()=>{var r;let t=this.app.workspace.getActiveViewOfType(I.MarkdownView);if(t&&((r=t.file)==null?void 0:r.path)===i.path){let a=t.editor,o=a.getValue().toLowerCase().indexOf(e.word.toLowerCase());if(o!==-1){let l=a.offsetToPos(o);a.setCursor(l),a.scrollIntoView({from:l,to:l},!0)}}},100)))}catch(i){console.error("\u5BFC\u822A\u5230\u6E90\u6587\u4EF6\u5931\u8D25:",i)}}unload(){document.removeEventListener("mouseover",this.eventHandlers.mouseover),document.removeEventListener("mouseout",this.eventHandlers.mouseout),this.removeTooltip()}};var M=require("obsidian");var R=class extends M.Modal{constructor(e,i,t,r=!1){super(e),this.plugin=i,this.word=t,this.isEditMode=r,r?this.definition=this.plugin.vocabularyManager.getDefinition(t):this.definition=null}onOpen(){let{contentEl:e}=this;e.empty();let i=this.isEditMode?"modals.edit_word_title":"modals.add_word_title";e.createEl("h2",{text:`${d(i)} "${this.word}"`});let t=e.createDiv({cls:"form-item"});t.createEl("label",{text:d("modals.book_label"),cls:"form-item-label"});let r=t.createEl("select",{cls:"dropdown"});r.createEl("option",{text:d("modals.select_book"),value:""}),this.plugin.settings.vocabularyBooks.forEach(b=>{if(b.enabled){let f=r.createEl("option",{text:b.name,value:b.path});this.isEditMode&&this.definition&&this.definition.source===b.path&&(f.selected=!0)}}),this.isEditMode&&this.definition&&(r.disabled=!0);let a=e.createDiv({cls:"form-item"});a.createEl("label",{text:d("modals.color_label"),cls:"form-item-label"});let s=a.createEl("select",{cls:"dropdown setting-item-select"});s.createEl("option",{text:d("modals.color_gray"),value:""}),[{name:d("modals.color_red"),value:"1"},{name:d("modals.color_orange"),value:"2"},{name:d("modals.color_yellow"),value:"3"},{name:d("modals.color_green"),value:"4"},{name:d("modals.color_blue"),value:"5"},{name:d("modals.color_purple"),value:"6"}].forEach(b=>{let f=s.createEl("option",{text:b.name,value:b.value});this.isEditMode&&this.definition&&this.definition.color===b.value&&(f.selected=!0)});let l=e.createDiv({cls:"form-item"});l.createEl("label",{text:d("modals.aliases_label"),cls:"form-item-label"});let n=l.createEl("input",{type:"text",placeholder:d("modals.aliases_placeholder"),cls:"setting-item-input word-aliases-input"});this.isEditMode&&this.definition&&this.definition.aliases&&this.definition.aliases.length>0&&(n.value=this.definition.aliases.join(", "));let c=e.createDiv({cls:"form-item"});c.createEl("label",{text:d("modals.definition_label"),cls:"form-item-label"});let u=c.createEl("textarea",{placeholder:d("modals.definition_placeholder"),cls:"setting-item-input word-definition-input"});u.rows=5,this.isEditMode&&this.definition&&this.definition.definition&&(u.value=this.definition.definition);let h=e.createDiv({cls:"modal-button-container"}),p=h.createDiv({cls:"button-group-left"});if(this.isEditMode&&this.definition){let b=p.createEl("button",{cls:"delete-word-button"});(0,M.setIcon)(b,"trash"),b.onclick=async()=>{if(!await this.showDeleteConfirmation())return;let _=new M.Notice(d("notices.deleting_word"),0);try{let D=await this.plugin.vocabularyManager.deleteWordFromCanvas(this.definition.source,this.definition.nodeId);_.hide(),D?(new M.Notice(d("notices.word_deleted")),this.plugin.refreshHighlighter(),this.close()):new M.Notice(d("notices.delete_word_failed"))}catch(D){_.hide(),console.error("\u5220\u9664\u8BCD\u6C47\u65F6\u53D1\u751F\u9519\u8BEF:",D),new M.Notice(d("notices.error_deleting_word"))}}}let v=h.createDiv({cls:"button-group-right"}),y=v.createEl("button",{text:d("modals.cancel_button")});y.onclick=()=>this.close();let C=this.isEditMode?"modals.save_button":"modals.add_button",W=v.createEl("button",{text:d(C),cls:"mod-cta"});W.onclick=async()=>{let b=r.value,f=u.value,_=s.value?parseInt(s.value):void 0,D=n.value.trim(),E;if(D&&(E=D.split(",").map(S=>S.trim().toLowerCase()),E=E.filter(S=>S.length>0),E.length===0&&(E=void 0)),!b){new M.Notice(d("notices.select_book_required"));return}let P=this.isEditMode?new M.Notice(d("notices.updating_word"),0):new M.Notice(d("notices.adding_word"),0);try{let S=!1;if(this.isEditMode&&this.definition)if(S=await this.plugin.vocabularyManager.updateWordInCanvas(this.definition.source,this.definition.nodeId,this.word,f,_,E),P.hide(),S){let L=d("notices.word_updated_success").replace("{0}",this.word);new M.Notice(L),this.plugin.refreshHighlighter(),this.close()}else new M.Notice(d("notices.update_word_failed"));else if(S=await this.plugin.vocabularyManager.addWordToCanvas(b,this.word,f,_,E),P.hide(),S){let L=d("notices.word_added_success").replace("{0}",this.word);new M.Notice(L),this.plugin.refreshHighlighter(),this.close()}else new M.Notice(d("notices.add_word_failed"))}catch(S){P.hide(),console.error("Failed to add/update word:",S),new M.Notice(d("notices.error_processing_word"))}}}async showDeleteConfirmation(){return window.confirm(d("modals.delete_confirmation").replace("{0}",this.word))}onClose(){let{contentEl:e}=this;e.empty()}};var w=require("obsidian");var ie=class extends w.PluginSettingTab{constructor(e,i){super(e,i),this.plugin=i}addAutoLayoutSettings(){var s;let{containerEl:e}=this;new w.Setting(e).setName(d("settings.auto_layout")).setHeading(),new w.Setting(e).setName(d("settings.enable_auto_layout")).setDesc(d("settings.enable_auto_layout_desc")).addToggle(o=>{var l;return o.setValue((l=this.plugin.settings.autoLayoutEnabled)!=null?l:!0).onChange(async n=>{this.plugin.settings.autoLayoutEnabled=n,await this.plugin.saveSettings()})});let i=new w.Setting(e).setName(d("settings.card_size")).setDesc(d("settings.card_size_desc"));i.addText(o=>{var l;return o.setPlaceholder("width").setValue(String((l=this.plugin.settings.cardWidth)!=null?l:260)).onChange(async n=>{let c=parseInt(n,10);!isNaN(c)&&c>60&&(this.plugin.settings.cardWidth=c,await this.plugin.saveSettings())})}),i.addText(o=>{var l;return o.setPlaceholder("height").setValue(String((l=this.plugin.settings.cardHeight)!=null?l:120)).onChange(async n=>{let c=parseInt(n,10);!isNaN(c)&&c>40&&(this.plugin.settings.cardHeight=c,await this.plugin.saveSettings())})});let t=new w.Setting(e).setName(d("settings.grid_gaps")).setDesc(d("settings.grid_gaps_desc"));t.addText(o=>{var l;return o.setPlaceholder("horizontal").setValue(String((l=this.plugin.settings.horizontalGap)!=null?l:24)).onChange(async n=>{let c=parseInt(n,10);!isNaN(c)&&c>=0&&(this.plugin.settings.horizontalGap=c,await this.plugin.saveSettings())})}),t.addText(o=>{var l;return o.setPlaceholder("vertical").setValue(String((l=this.plugin.settings.verticalGap)!=null?l:16)).onChange(async n=>{let c=parseInt(n,10);!isNaN(c)&&c>=0&&(this.plugin.settings.verticalGap=c,await this.plugin.saveSettings())})});let r=new w.Setting(e).setName(d("settings.left_padding")).setDesc(d("settings.left_padding_desc"));if(r.addText(o=>{var l;return o.setPlaceholder("leftPadding").setValue(String((l=this.plugin.settings.leftPadding)!=null?l:24)).onChange(async n=>{let c=parseInt(n,10);!isNaN(c)&&c>=0&&(this.plugin.settings.leftPadding=c,await this.plugin.saveSettings())})}),r.addText(o=>{var l;return o.setPlaceholder("minLeftX").setValue(String((l=this.plugin.settings.minLeftX)!=null?l:0)).onChange(async n=>{let c=parseInt(n,10);isNaN(c)||(this.plugin.settings.minLeftX=c,await this.plugin.saveSettings())})}),new w.Setting(e).setName(d("settings.columns_auto")).setDesc(d("settings.columns_auto_desc")).addToggle(o=>{var l;return o.setValue((l=this.plugin.settings.columnsAuto)!=null?l:!0).onChange(async n=>{this.plugin.settings.columnsAuto=n,await this.plugin.saveSettings(),this.display()})}),!((s=this.plugin.settings.columnsAuto)==null||s)){let o=new w.Setting(e).setName(d("settings.columns")).setDesc(d("settings.columns_desc"));o.addText(l=>{var n;return l.setPlaceholder("columns").setValue(String((n=this.plugin.settings.columns)!=null?n:3)).onChange(async c=>{let u=parseInt(c,10);!isNaN(u)&&u>0&&(this.plugin.settings.columns=u,await this.plugin.saveSettings())})}),o.addText(l=>{var n;return l.setPlaceholder("maxColumns").setValue(String((n=this.plugin.settings.maxColumns)!=null?n:6)).onChange(async c=>{let u=parseInt(c,10);!isNaN(u)&&u>0&&(this.plugin.settings.maxColumns=u,await this.plugin.saveSettings())})})}let a=new w.Setting(e).setName(d("settings.group_inner_layout")).setDesc(d("settings.group_inner_layout_desc"));a.addText(o=>{var l;return o.setPlaceholder("innerPadding").setValue(String((l=this.plugin.settings.groupInnerPadding)!=null?l:24)).onChange(async n=>{let c=parseInt(n,10);!isNaN(c)&&c>=0&&(this.plugin.settings.groupInnerPadding=c,await this.plugin.saveSettings())})}),a.addText(o=>{var l;return o.setPlaceholder("innerGap").setValue(String((l=this.plugin.settings.groupInnerGap)!=null?l:12)).onChange(async n=>{let c=parseInt(n,10);!isNaN(c)&&c>=0&&(this.plugin.settings.groupInnerGap=c,await this.plugin.saveSettings())})}),a.addText(o=>{var l;return o.setPlaceholder("innerColumns").setValue(String((l=this.plugin.settings.groupInnerColumns)!=null?l:2)).onChange(async n=>{let c=parseInt(n,10);!isNaN(c)&&c>0&&(this.plugin.settings.groupInnerColumns=c,await this.plugin.saveSettings())})})}display(){let{containerEl:e}=this;e.empty(),this.addBasicSettings(),this.addVocabularyBooksSection(),this.addAutoLayoutSettings()}addBasicSettings(){let{containerEl:e}=this;new w.Setting(e).setName(d("settings.enable_auto_highlight")).setDesc(d("settings.enable_auto_highlight_desc")).addToggle(i=>i.setValue(this.plugin.settings.enableAutoHighlight).onChange(async t=>{this.plugin.settings.enableAutoHighlight=t,await this.plugin.saveSettings(),this.plugin.refreshHighlighter()})),new w.Setting(e).setName(d("settings.show_definition_on_hover")).setDesc(d("settings.show_definition_on_hover_desc")).addToggle(i=>i.setValue(this.plugin.settings.showDefinitionOnHover).onChange(async t=>{this.plugin.settings.showDefinitionOnHover=t,await this.plugin.saveSettings()})),new w.Setting(e).setName(d("settings.highlight_style")).setDesc(d("settings.highlight_style_desc")).addDropdown(i=>i.addOption("underline",d("settings.style_underline")).addOption("background",d("settings.style_background")).addOption("bold",d("settings.style_bold")).addOption("dotted",d("settings.style_dotted")).addOption("wavy",d("settings.style_wavy")).setValue(this.plugin.settings.highlightStyle).onChange(async t=>{this.plugin.settings.highlightStyle=t,await this.plugin.saveSettings(),this.plugin.refreshHighlighter()})),new w.Setting(e).setName(d("settings.enable_mastered_feature")).setDesc(d("settings.enable_mastered_feature_desc")).addToggle(i=>i.setValue(this.plugin.settings.enableMasteredFeature).onChange(async t=>{this.plugin.settings.enableMasteredFeature=t,this.plugin.settings.showMasteredInSidebar=t,await this.plugin.saveSettings(),this.plugin.refreshHighlighter(),this.plugin.app.workspace.trigger("hi-words:mastered-changed")})),new w.Setting(e).setName(d("settings.blur_definitions")).setDesc(d("settings.blur_definitions_desc")).addToggle(i=>i.setValue(this.plugin.settings.blurDefinitions).onChange(async t=>{this.plugin.settings.blurDefinitions=t,await this.plugin.saveSettings(),this.plugin.app.workspace.trigger("hi-words:settings-changed")})),new w.Setting(e).setName(d("settings.tts_template")||"TTS template").setDesc(d("settings.tts_template_desc")||"Use {{word}} as placeholder, e.g. https://dict.youdao.com/dictvoice?audio={{word}}&type=2").addText(i=>i.setPlaceholder("https://...{{word}}...").setValue(this.plugin.settings.ttsTemplate||"https://dict.youdao.com/dictvoice?audio={{word}}&type=2").onChange(async t=>{this.plugin.settings.ttsTemplate=t.trim(),await this.plugin.saveSettings()}))}addVocabularyBooksSection(){let{containerEl:e}=this;new w.Setting(e).setName(d("settings.vocabulary_books")).setHeading(),new w.Setting(e).setName(d("settings.add_vocabulary_book")).setDesc("").addButton(i=>i.setIcon("plus-circle").setTooltip(d("settings.add_vocabulary_book")).onClick(()=>this.showCanvasFilePicker())),this.displayVocabularyBooks(),this.displayStats()}async showCanvasFilePicker(){let e=this.app.vault.getFiles().filter(t=>t.extension==="canvas");if(e.length===0){new w.Notice(d("notices.no_canvas_files"));return}new _e(this.app,e,async t=>{await this.addVocabularyBook(t)}).open()}async addVocabularyBook(e){if(this.plugin.settings.vocabularyBooks.some(s=>s.path===e.path)){new w.Notice(d("notices.book_already_exists"));return}if(!await new x(this.app).validateCanvasFile(e)){new w.Notice(d("notices.invalid_canvas_file"));return}let a={path:e.path,name:e.basename,enabled:!0};this.plugin.settings.vocabularyBooks.push(a),await this.plugin.saveSettings(),await this.plugin.vocabularyManager.loadVocabularyBook(a),this.plugin.refreshHighlighter(),new w.Notice(d("notices.book_added").replace("{0}",a.name)),this.display()}displayVocabularyBooks(){let{containerEl:e}=this;if(this.plugin.settings.vocabularyBooks.length===0){e.createEl("p",{text:d("settings.no_vocabulary_books"),cls:"setting-item-description"});return}this.plugin.settings.vocabularyBooks.forEach((i,t)=>{let r=new w.Setting(e).setName(i.name).setDesc(`${d("settings.path")}: ${i.path}`);r.addButton(a=>a.setIcon("refresh-cw").setTooltip(d("settings.reload_book")).onClick(async()=>{await this.plugin.vocabularyManager.reloadVocabularyBook(i.path),this.plugin.refreshHighlighter(),new w.Notice(d("notices.book_reloaded").replace("{0}",i.name))})),r.addButton(a=>a.setIcon("trash").setTooltip(d("settings.remove_vocabulary_book")).setWarning().onClick(async()=>{this.plugin.settings.vocabularyBooks.splice(t,1),await this.plugin.saveSettings(),await this.plugin.vocabularyManager.loadAllVocabularyBooks(),this.plugin.refreshHighlighter(),new w.Notice(d("notices.book_removed").replace("{0}",i.name)),this.display()})),r.addToggle(a=>a.setValue(i.enabled).onChange(async s=>{i.enabled=s,await this.plugin.saveSettings(),s?await this.plugin.vocabularyManager.loadVocabularyBook(i):await this.plugin.vocabularyManager.loadAllVocabularyBooks(),this.plugin.refreshHighlighter()}))})}displayStats(){let{containerEl:e}=this,i=this.plugin.vocabularyManager.getStats();new w.Setting(e).setName(d("settings.statistics")).setHeading();let t=e.createEl("div",{cls:"hi-words-stats"}),r=t.createEl("div",{cls:"stat-item"});r.createEl("div",{cls:"stat-value",text:i.totalBooks.toString()}),r.createEl("div",{cls:"stat-label",text:d("settings.total_books").split(":")[0]});let a=t.createEl("div",{cls:"stat-item"});a.createEl("div",{cls:"stat-value",text:i.enabledBooks.toString()}),a.createEl("div",{cls:"stat-label",text:d("settings.enabled_books").split(":")[0]});let s=t.createEl("div",{cls:"stat-item"});s.createEl("div",{cls:"stat-value",text:i.totalWords.toString()}),s.createEl("div",{cls:"stat-label",text:d("settings.total_words").split(":")[0]})}},_e=class extends w.Modal{constructor(e,i,t){super(e),this.files=i,this.onSelect=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:d("modals.select_canvas_file")}),this.files.forEach(i=>{let t=e.createEl("div",{cls:"canvas-picker-item"}),r=t.createEl("div",{text:i.basename,cls:"canvas-picker-name"}),a=t.createEl("div",{text:i.path,cls:"canvas-picker-path"});t.addEventListener("click",()=>{this.onSelect(i),this.close()})})}onClose(){let{contentEl:e}=this;e.empty()}};var Fe={vocabularyBooks:[],showDefinitionOnHover:!0,enableAutoHighlight:!0,highlightStyle:"underline",enableMasteredFeature:!0,showMasteredInSidebar:!0,blurDefinitions:!1,ttsTemplate:"https://dict.youdao.com/dictvoice?audio={{word}}&type=2",autoLayoutEnabled:!0,cardWidth:260,cardHeight:120,horizontalGap:24,verticalGap:16,leftPadding:24,columnsAuto:!0,columns:3,minLeftX:0,maxColumns:6,groupInnerPadding:24,groupInnerColumns:2,groupInnerGap:12},oe=class extends j.Plugin{constructor(){super(...arguments);this.editorExtensions=[];this.highlighterInstance=null;this.sidebarView=null;this.isSidebarInitialized=!1}async onload(){await this.loadSettings(),ge.setApp(this.app),this.vocabularyManager=new K(this.app,this.settings),this.masteredService=new J(this,this.vocabularyManager),this.definitionPopover=new te(this),this.definitionPopover.setVocabularyManager(this.vocabularyManager),this.definitionPopover.setMasteredService(this.masteredService),await this.vocabularyManager.loadAllVocabularyBooks(),this.registerView(O,i=>(this.sidebarView=new ee(i,this),this.sidebarView)),this.setupEditorExtensions(),this.registerCommands(),this.registerEvents(),this.addSettingTab(new ie(this.app,this)),this.initializeSidebar(),this.app.workspace.onLayoutReady(async()=>{await this.vocabularyManager.loadAllVocabularyBooks(),this.refreshHighlighter()})}setupEditorExtensions(){if(this.settings.enableAutoHighlight){let i=fe(this.vocabularyManager);this.editorExtensions=[i],this.registerEditorExtension(this.editorExtensions)}}registerCommands(){this.addCommand({id:"refresh-vocabulary",name:d("commands.refresh_vocabulary"),callback:async()=>{await this.vocabularyManager.loadAllVocabularyBooks(),this.refreshHighlighter(),new j.Notice(d("notices.vocabulary_refreshed"))}}),this.addCommand({id:"open-vocabulary-sidebar",name:d("commands.show_sidebar"),callback:()=>{this.activateSidebarView()}})}registerEvents(){let i=new Set,t=null;this.registerEvent(this.app.vault.on("modify",r=>{r instanceof j.TFile&&r.extension==="canvas"&&this.settings.vocabularyBooks.some(s=>s.path===r.path)&&i.add(r.path)})),this.registerEvent(this.app.workspace.on("active-leaf-change",async r=>{let a=this.app.workspace.getActiveFile();if(t&&i.has(t)&&(!a||a.path!==t)&&(await this.vocabularyManager.reloadVocabularyBook(t),this.refreshHighlighter(),i.delete(t)),a&&a.extension==="canvas")t=a.path;else if(t=null,i.size>0){let s=Array.from(i);i.clear();for(let o of s)await this.vocabularyManager.reloadVocabularyBook(o);this.refreshHighlighter()}else setTimeout(()=>this.refreshHighlighter(),100)})),this.registerEvent(this.app.workspace.on("editor-menu",(r,a)=>{let s=a.getSelection();if(s&&s.trim()){let o=s.trim(),l=this.vocabularyManager.hasWord(o);r.addItem(n=>{let c=l?"commands.edit_word":"commands.add_word";n.setTitle(d(c)).onClick(()=>{this.addOrEditWord(o)})})}}))}refreshHighlighter(){this.settings.enableAutoHighlight&&z.refreshAll(),this.sidebarView&&this.sidebarView.refresh()}async initializeSidebar(){this.isSidebarInitialized||this.app.workspace.onLayoutReady(()=>{this.isSidebarInitialized=!0})}async activateSidebarView(){let{workspace:i}=this.app,t=null,r=i.getLeavesOfType(O);r.length>0?t=r[0]:(t=i.getRightLeaf(!1),t&&await t.setViewState({type:O,active:!0})),t&&i.revealLeaf(t)}async loadSettings(){this.settings=Object.assign({},Fe,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.vocabularyManager.updateSettings(this.settings),this.masteredService&&this.masteredService.updateSettings&&this.masteredService.updateSettings()}addOrEditWord(i){this.vocabularyManager.hasWord(i)?new R(this.app,this,i,!0).open():new R(this.app,this,i).open()}onunload(){this.definitionPopover.unload(),this.vocabularyManager.clear(),this.vocabularyManager.destroy&&this.vocabularyManager.destroy(),z.clear()}};
